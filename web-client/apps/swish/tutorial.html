<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Web Prolog Tutorial</title>
    <meta name="description" content="">
    <meta name="author" content="Torbjörn Lager">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSS -->
    <!--
    <link rel="stylesheet" href="../../www/vendor/bootstrap/css/bootstrap.min.css">
    <style>
        #tutorial {
            margin: 50px;
            padding: 16px;
            display: block;
        }
        .collapse {
            display: block;
        }
    </style>
    -->
    <style>   
        .table-of-contents {

        }
        .table-of-contents ul {
          padding: 0 20px;
        }
        .table-of-contents li {
          margin: 0 0 0.25em 0;
        }
        .table-of-contents a {
          text-decoration: none;
        }
        .table-of-contents a:hover,
        .table-of-contents a:active {
          text-decoration: underline;
        }

        h2:target {
          animation: highlight 1s ease;
        }

        @keyframes highlight {
          from { background: yellow; }
          to { background: white; }
        }


        h1 {font-size: 36px; color:darkblue;}
        h2 {font-size: 24px; margin-top:48px; color:navy;}
        h3 {font-size: 20px; margin-top:24px; color:maroon;}

        em {
            font-weight: bold;
            font-style: normal;
        }

        pre {
            font-size: 12px;
        }
        
        blockquote p {
            font-size: 12px;
        }
        blockquote {
            margin-top: 12px;
        }
        
    </style>   
</head>
<body>
<div id="tutorial">

<div class="page-header">
    <h1>Web Prolog &ndash; a tutorial</h1>
</div>

<div id="smarttoc_wrapper">
  <div id="smarttoc" >
    <h2>
      Table of contents
    </h2>
      <ul id="mozToc">
        <li><a href="#mozTocId134955">Introduction</a>
        <li><a href="#mozTocId134955">Your shell, your pengine and your node</a>
          <ul>
            <li><a href="#mozTocId26860">Your shell</a></li>
            <li><a href="#mozTocId937044">Your pengine</a></li>
            <li><a href="#mozTocId757554">Your node</a></li>
          </ul>
        </li>
        <li><a href="#mozTocId217984">Web Prolog is a dialect of Prolog</a>
          <ul>
            <li><a href="#mozTocId566602">Running append in two different modes</a></li>
            <li><a href="#mozTocId449378">Reasoning with a node-resident
                program</a></li>
            <li><a href="#mozTocId817916">An expert system
                meta-interpreter</a></li>
            <li><a href="#mozTocId915723">Parsing and generating with a
                DCG</a></li>
          </ul>
        </li>
        <li><a href="#mozTocId756281">Web Prolog is a dialect of Erlang</a>
          <ul>
            <li><a href="#mozTocId808850">Spawning, sending and
                receiving</a></li>
            <li><a href="#mozTocId151341">Messages deferred</a></li>
            <li><a href="#mozTocId151141">A priority queue example</a></li>
            <li><a href="#mozTocId613991">Some actors are servers</a></li>
            <li><a href="#mozTocId248390">Node-resident actor processes</a></li>
            <li><a href="#mozTocId917799">A fridge simulation example</a></li>
            <li><a href="#mozTocId892014">Using all-solutions predicates</a></li>
            <li><a href="#mozTocId399093">Links, monitors and two kinds
                of exits</a></li>
            <li><a href="#mozTocId940000">A publish-subscribe service</a></li>
            <li><a href="#mozTocId764900">Actors playing ping-pong</a></li>
            <li><a href="#mozTocId886116">Porting Erlang programs to Web
                Prolog</a></li>
          </ul>
        </li>
        <li><a href="#mozTocId171340">Web Prolog is a hybrid of Prolog
            and Erlang</a>
          <ul>
            <li><a href="#mozTocId322171">A dynamic database fridge</a></li>
            <li><a href="#mozTocId123263">Controlling backtracking</a></li>
            <li><a href="#mozTocId516722">A generic encapsulated search
                procedure</a></li>
            <li><a href="#mozTocId855082">The pengine behaviour</a></li>
            <li><a href="#mozTocId940396">Pengines deferring messages</a></li>
            <li><a href="#mozTocId853271">Pengines and options</a></li>
            <li><a href="#mozTocId549999">Pengines and input/output</a></li>
          </ul>
        </li>
        <li><a href="#mozTocId521435">Remote procedure calls</a>
          <ul>
            <li><a href="#mozTocId799454">Non-deterministic RPC</a></li>
            <li><a href="#mozTocId452131">Promises (asynchronous RPC)</a></li>
          </ul>
        </li>
        <li><a href="#mozTocId697650">Using the Web APIs</a>
          <ul>
            <li><a href="#mozTocId585333">Using the WebSocket API</a></li>
            <li><a href="#mozTocId347219">Using the HTTP ask API</a></li>
            <li><a href="#mozTocId548283">Using the HTTP send API</a></li>
          </ul>
        </li>
        <li><a href="#mozTocId805578">What should we use for
            distribution?</a></li>
        <li><a href="#mozTocId548181">Web Prolog and the programmable
            Prolog Web</a></li>
        <li><a href="#mozTocId997026">How the shell works</a></li>
        <li><a href="#mozTocId73360">Questionnaire</a></li>
     </ul>
  </div>
</div>



<h2>Introduction</h2>

<p>
    We intend this tutorial to be used online.
</p>

<div class="alert alert-danger">
  <strong>BUG!</strong> You are hopefully not using it online yet?! It's not ready for this, since security features haven't 
  been implemented.
</div>

<p>
    Well, it's not really a programming language tutorial, to be honest, since its purpose isn't to teach an already established programming language, but to present a proposal for a <i>new</i> language called <em>Web Prolog</em>. By showing simple tutorial-style examples a feel for a language can be given, and this is exactly why we choose to present it in the form of a tutorial. In an appendix the examples are complemented by the documentation of the most important Web Prolog built-in predicates, web APIs, etc. Please remember, though, that it's just a proposal and nothing is set in stone yet. Your comments will matter. 
</p>

<p>
    To be honest (again), the language isn't new either, but a hybrid of two rather old and mature languages &ndash; Prolog and Erlang &ndash; and of two programming models &ndash; logic programming and actor-based programming.  When it comes to the <i>purpose</i> of Web Prolog, another inspiration has been JavaScript &ndash; a <i>scripting language</i> for the Web that is usually <i>embedded</i> in other programming systems and where processes must be <i>sandboxed</i> in order to allow the execution of untrusted code. Similar to JavaScript, Web Prolog is an embedded and sandboxed <i>web programming language</i>, but in contrast to JavaScript, Web Prolog is a web <i>logic</i> programming language &ndash; a language for scripting the Web with logic programs.
</p>


<p>
    The Web Prolog programming language may not be to everyone's liking, but we hope that by showing it first of all to a bunch of Prolog and Erlang programmers we can avoid (at this stage) largely irrelevant negative criticism such as "it's bad because..." followed by "...it has the same syntax as Erlang" or "...it's just as impure as Prolog" or "...it's not object oriented". We actually like the syntax since it's so close to both Prolog and Erlang (and to Prolog in particular), and we have since long come to peace with some of the Prolog impurities while others have found remedies through research in the field of logic programming. And interestingly, Joe Armstrong (one of the inventors of Erlang) as well as Alan Kay (the inventor of Smalltalk) seem to have suggested that Erlang is in fact object-oriented.
</p>

<p>   
    We hasten to add that we would love to receive <i>constructive</i> criticism, and think that an audience consisting of Erlang and Prolog programmers will be able to deliver exactly that.
</p>

<p>
    We believe that Prolog programmers will quickly realise that with Web Prolog they will be able to do things not easily done with traditional Prolog, and that Erlang programmers will realise that Web Prolog offers capabilities that are not present in Erlang. 
</p>

<p>
    We believe that Erlang technology might have something to contribute to Prolog, and, of course, that Prolog technology has something to contribute to Erlang (and by that we mean <i>more</i> than it has already contributed by having inspired Erlang). Nowadays, there isn't much contact between the Prolog community and the Erlang community. In the best of worlds, the language of Web Prolog would serve to open a line of communication between (subsets of) the two communities.
</p>

<p>
    Sooner or later, we ought to target also front-end programmers and JavaScript aficionados with no previous exposure to Prolog or Erlang. This requires a different kind of tutorial, however, one that starts from the basics of both logic programming à la Prolog and actor-based programming à la Erlang.
</p>


<h2>The mission</h2>

<p>
    Let's make an attempt to explain the language's mission. With Web Prolog we hope to be able to introduce a dialect of Prolog that:    
</p>

<ul>
    <li>is simpler and less bloated than most existing Prolog systems,</li>
    <li>provides some of the concurrent power of Erlang,</li>
    <li>provides the distributed power of Erlang,</li>
    <li>is suitable for scripting purposes on the Web,</li>
    <li>supports interoperability between different Prolog systems,</li>
    <li>supports interoperability with Erlang,</li>
    <li>supports porting Erlang to Web Prolog,</li>
    <li>provides a better support for interaction programming than traditional Prolog,</li>
    <li>supports the Prolog Web,</li>
    <li>can possibly be standardised.</li>
</ul>


<h2>Your shell, your pengine and your node</h2>

<h3>Your shell</h3>

<p>
    If everything works as it should, the area to the right is showing what is a more or less traditional Prolog shell. Working with an interactive shell is a vital part of using dynamic programming languages such as Erlang and Prolog. It’s useful for testing all kinds of code and programs. Here it's used to offer you some tutorial-style hands-on experience with Web Prolog.
</p>

<h3>Your pengine</h3>

<p>
    Your shell is talking to a <em>pengine</em> (which is short for <i>Prolog engine</i>). A pengine is a programming abstraction modelled on the top-level of Prolog. A pengine can be created and accessed from Prolog as well as from other programming languages, and if you want, you can run two or more in parallel. Alternatively, a pengine can be seen as an encapsulated Prolog session, or as a compute server for Prolog programming tasks. The pengine is all yours, you have almost total control over it.</p>

<p>
    Your pengine is named <code>{{pengine}}</code>. That's its short name. (It has a long name too &ndash; we'll come to that.)
</p>

<p>
    Your pengine is an actor. Pengines are great, but the fundamental unit of computation in Web Prolog isn't the pengine, but the <em>actor</em>. An actor is a <em>process</em> with a <em>mailbox</em> which dequeues and processes <em>messages</em> individually. The actor process contains all the logic for processing messages, and the behaviour can range from storing a message in an internal queue to ignoring the message entirely. We'll see examples of many kinds of actors in this tutorial. Not all of them are pengines.
</p>

<p>
    A pengine is merely a special <i>kind</i> of actor, and can be distinguished from other kinds of actors by the protocol that it adheres to. 
</p>


<h3>Your node</h3>

<p>
    Your pengine is running on a <em>node</em> running on a computer somewhere. The purpose of a node is to host pengines and other actors. The node running your pengine is identified by the URI <code>'{{host}}'</code>. This means that your pengine also has a long name: <code>{{pengine}}@'{{host}}'</code>.</p>

<p>
    Your node isn't only yours. Other people may be using shells talking to other pengines running on the same node as your pengine. They are isolated from each other. [Node-resident programs and actors]
</p>

<p>
    Your node may not be the only node. Or so we hope. The <em>Prolog Web</em>...
</p>


<div class="alert alert-info">
  <strong>Tip!</strong> We are writing a book about Web Prolog. Here's the first paragraph in the introduction:
  <blockquote>
    <p>
        In this report, we describe a programming language called <i>Web Prolog</i>. We think of it as a <i>web programming language</i>, or, more specifically, as a web <i>logic</i> programming language. it's based on Prolog, with a pinch of Erlang sprinkled in. We stay really, really close to traditional Prolog, indeed so close that the vast majority of example programs in Prolog text books will run without modification. Towards Erlang we are less faithful, picking only those features from Erlang that we regard as useful in a web programming language. In particular, we pick the features that make Erlang into an <i>actor programming language</i>, and on top of these we define the concept a <i>pengine</i> &ndash; a programming abstraction in the form of a special kind of actor which closely mirrors the behaviour of a Prolog top-level. However, Erlang hasn't been the only inspiration. When it comes to the <i>purpose</i> of Web Prolog, the inspiration has been JavaScript &ndash; a scripting language for the Web that is usually embedded in other programming systems and where processes must be sandboxed in order to allow the execution of untrusted code.
    </p>
  </blockquote>
  <p>What's more in the book?. [Prolog Web. Semantic Web. Standardisation.]</p>
  <p>The draft manuscript can be downloaded from <a target="_blank" href="">here</a> [but not just yet].</p>
</div>

<div class="alert alert-success">
  <strong>Web Prolog is built on top of SWI-Prolog</strong> and uses engines, also known as interactors. The idea is due to Paul Tarau (2011). An engine is a Prolog virtual machine that has its own stacks and (virtual) machine state. Unlike normal Prolog threads though, they are not associated with an operating system thread. For distribution, Web Prolog uses the WebSocket protocol rather than TCP/IP.
</div>


<h2>Web Prolog is a dialect of Prolog</h2>

<p>
    Prolog can be characterised as a logic programming language with imperative and procedural features added to ensure its usefulness as a general purpose programming language. Some highlights of Prolog include: built-in backtracking depth-first search, unification, logic-based knowledge representation, reasoning, meta-programming, and Definite Clause Grammar (DCG). These are concepts that Erlang doesn't support.
</p>

<p>
    In this section we'll introduce some of these concepts by way of examples.
</p>

<div class="alert alert-info">
  <strong>Tip!</strong> If you are an experienced Prolog programmer, you may want to skip the following four subsections where we just want to show Erlang programmers a couple of things that are easy and natural in Prolog, but not so in Erlang. 
</div>

<h3>Running append in two different modes</h3>

<p>
    In our first example, we're running the built-in predicate <code>append/3</code> in the deterministic mode. Clicking the Enter button below binds <code>Xs</code> to the first and only solution that this query has:
</p>

<pre id="append1">
?- append([a],[b,c],Xs).
</pre>

<p>
  <button onclick='enter("#append1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<div class="alert alert-info">
  <strong>Tip!</strong> Want to try the same query but with different input lists? Use the up arrow key to insert the most recent
    query at the prompt. Edit it to your heart's delight and hit Return when you are done.
</div>

<p>
    In our second example, we're running <code>append/3</code> in the non-deterministic mode &ndash; running it backwards (so to speak) in the way peculiar to a relational language such as Prolog. Clicking the Enter button gives us the first solution:
</p>

<pre id="append2">
?- append(Xs,Ys,[a,b,c]).
</pre>

<p>
  <button onclick='enter("#append2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    To force the search for more solutions, press the semicolon (;) key on your keyboard. Hit return to stop looking for more solutions.
</p>

<p>
    As those who have tried Prolog before will surely recognise, this is how a Prolog shell usually works.
</p>

<div class="alert alert-info">
  <strong>Tip!</strong> Instead of the semicolon (;) you can also use the space bar.
</div>

<div class="alert alert-info">
  <strong>Tip!</strong> Ctrl-C can be used to abort a running computation.
</div>

<div class="alert alert-danger">
  <strong>BUG!</strong> Ctrl-C doesn't always work. When this happens, you simply need to reload the page.
</div>



<h3>Reasoning with a node-resident program</h3>

<p>
    Crucially, a node may host a Web Prolog <i>program</i> &ndash; a database, an expert system, a game engine, a digital assistent, a home control system, or another kind of program. If it does, a pengine running on the node has access to the predicates defined by this program. The program is typically maintained by the owner of the node. 
</p>

<p>For the purpose of this tutorial, we, as the owners of the node, have installed a small number of such <em>node-resident programs</em>. Here's the first one, a so called ancestor database:</p>
                                                                
<pre id="a">
ancestor_decendant(X, Y) :- parent_child(X, Y).
ancestor_decendant(X, Z) :- parent_child(X, Y), ancestor_decendant(Y, Z).

parent_child(X, Y) :- mother_child(X, Y).
parent_child(X, Y) :- father_child(X, Y).

mother_child(trude, sally).

father_child(tom, sally).
father_child(tom, erica).
father_child(mike, tom).
</pre>

<p>
    Who are decendants of Mike? To find out, here's how to call <code>ancestor_decendant/2</code>:
</p>

<pre id="ancestor1">
?- ancestor_decendant(mike, Who).
</pre>

<p>
  <button onclick='enter("#ancestor1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Unless clients are authorised they are not able to make any changes to node-resident code, only the owner is allowed to do so. However, by using code injection in the workspace of their pengine, clients are able to <i>complement</i> the hosted program with source code that they themselves have written. For example, <code>assert/1</code> can be used for this purpose:
</p>

<pre id="ancestor2">
?- assert((siblings(_X, _Y) :- 
               parent_child(_Z, _X),
               parent_child(_Z, _Y), 
               _X @&lt; _Y)).
</pre>

<p>
  <button onclick='enter("#ancestor2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Here's how to call <code>siblings/2</code>:
</p>

<pre id="ancestor3">
?- siblings(X, Y).
</pre>

<p>
  <button onclick='enter("#ancestor3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>


<p>
    Sometimes <code>consult_text/1</code> is a better alternative. This is the counterpart of <code>consult/1</code> in traditional Prolog, which, since it loads clauses from a file, cannot be permitted in Web Prolog. 
</p>

<pre id="ancestor4">
?- consult_text("siblings(X, Y) :- 
                     parent_child(Z, X),
                     parent_child(Z, Y), 
                     X @&lt; Y.").
</pre>

<p>
  <button onclick='enter("#ancestor4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Here's how to call <code>siblings/2</code>:
</p>

<pre id="ancestor5">
?- siblings(X, Y).
</pre>

<p>
  <button onclick='enter("#ancestor5")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>


<div class="alert alert-info">
  <strong>Tip!</strong> You want to be able to make changes to the node-resident code as well? If so, you need to download the implementation of the present node from at its <a target="_blank" href="https://github.com/JanWielemaker/swi-erlang">GitHub repo</a>, install it locally and run you own private node. Instructions in the README [but just not yet].
</div>


<h3>An expert system meta-interpreter</h3>

<p>
    There was a time when expert systems was a big thing. There's even a Prolog text book that focuses on this. But expert systems never really went anywhere, so expert systems in Prolog, using the quite elegant meta-interpreter approach, never really went anywhere either. Nevertheless, it's worth presenting as an example. Here's a meta-interpreter implementing a tiny expert-system featuring a query-the-user facility which in interaction with the system allows you to determine if Tweety is a good pet. Before you use it, you have to consult it by clicking the Consult button located just below the code listing:
</p>
                                                   
<pre id="expert1">
prove(true) :- !.
prove((B, Bs)) :- !,
    prove(B),
    prove(Bs).
prove(H) :-
    clause(H, B),
    prove(B).
prove(H) :-
    askable(H),
    format(atom(Q), '~q?', [H]),
    pengine_input(Q, Answer),
    Answer == yes.


good_pet(X) :- bird(X), small(X).
good_pet(X) :- cuddly(X), yellow(X).

bird(X) :- has_feathers(X), tweets(X).

yellow(tweety).

askable(tweets(_)).
askable(small(_)).
askable(cuddly(_)).
askable(has_feathers(_)).
</pre>

<p>
  <button onclick='consult("#expert1")' class="btn btn-xs btn-primary" type="button">Consult</button>
</p>

<p>Here's how to use it. You'll need to answer "yes" or "no" and the system's verdict will be either <code>true</code> (meaning that yes, Tweety is a good pet) or <code>false</code> (meaning no, Tweety isn't a good pet).</p>

<pre id="expert2">
?- prove(good_pet(tweety)).
</pre>

<p>
  <button onclick='enter("#expert2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<h3>Parsing and generating with a DCG</h3>

<p>
    In a logic programming language such as Web Prolog, Definite Clause Grammar (DCG) can be used to write grammars for natural or formal languages which can be used for parsing and/or generation. Here's a simple DCG for a tiny fragment of English:
</p>

<pre id="dcg1">
s(s(NP,VP)) --&gt; np(NP, Num), vp(VP, Num).

np(NP, Num) --&gt; pn(NP, Num).
np(np(Det,N), Num) --&gt; det(Det, Num), n(N, Num).
np(np(Det,N,PP), Num) --&gt; det(Det, Num), n(N, Num), pp(PP).

vp(vp(V,NP), Num) --&gt; v(V, Num), np(NP, _).
vp(vp(V,NP,PP), Num) --&gt; v(V, Num), np(NP, _), pp(PP).

pp(pp(P,NP)) --&gt; p(P), np(NP, _).

det(det(a), sg) --&gt; [a].
det(det(the), _) --&gt; [the].

pn(pn(john), sg) --&gt; [john].

n(n(man), sg) --&gt; [man].
n(n(men), pl) --&gt; [men].
n(n(telescope), sg) --&gt; [telescope].

v(v(sees), sg) --&gt; [sees].
v(v(see), pl) --&gt; [see].
v(v(saw), _) --&gt; [saw].

p(p(with)) --&gt; [with].
</pre>

<p>
  <button onclick='consult("#dcg1")' class="btn btn-xs btn-primary" type="button">Consult</button>
</p>

<p>
    Below we show how to use the grammar for parsing. A solution is given the form of a parse tree represented as a Prolog term. Note that since the sentence that we parse is ambigous, we get two solutions:
</p>

<pre id="dcg2">
?- phrase(s(Tree), [john,saw,a,man,with,a,telescope]).
</pre>

<p>
  <button onclick='enter("#dcg2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<div class="alert alert-info">
  <strong>Tip!</strong> Wouldn't it be nice if a goal such as the one above could print a graphical parse tree? Since we are dealing with a shell written in HTML, CSS and JavaScript, this can be arranged in the future. <strong>Tip in tip!</strong> SWISH can do it &ndash; see <a target="_blank" href="https://swish.swi-prolog.org/example/grammar.pl">here</a> and click the Run button.
</div>

<p>
    A DCG can be used for generation too. Here's a way to generate all sentences no longer than 8 words long that are covered by the grammar. (The language covered by the grammar is infinite, and that's why we need to restrict the length of the sentences that we want to generate):
</p>

<pre id="dcg3">
?- forall((between(1,8,_N), length(_S,_N), phrase(s(_),_S)), io:writeln(_S)).
</pre>

<p>
  <button onclick='enter("#dcg3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<div class="alert alert-info">
  <strong>Tip!</strong> At this point, you may want to clear the shell. There are two ways to do this: either select Clear from the Shell menu or use your keyboard to produce a Ctrl-L.
</div>


<h2>Web Prolog is a dialect of Erlang</h2>

<p>
    We admit that this may be stretching the notion of a "dialect" a bit too far, but given that we may see Web Prolog as a variant of the Erlang language where we have "plugged out" its sequential part and "plugged in" sequential Prolog instead, it deserves at least a thought. Alternatively &ndash; and this will be our choice &ndash; what we want to do can be described as an attempt to <i>extend</i> Prolog with constructs such as spawn, send and receive. We will keep everything that core Prolog has to offer, and extend it with a number of those primitives that make Erlang such a great language for programming message-based concurrency. The choice between extending Prolog with Erlang-ish constructs and extending Erlang with Prolog-ish constructs is easy to make, and a lot has to do with syntax. Provided we can accept using a syntax which is relational rather than functional, precluding the nesting of function calls, it should be clear by now that the surface syntax of Prolog can easily be adapted to express the needed Erlang-ish primitives ("adapted" is perhaps too much to say, since all we need is two infix operators that can be declared using <code>op/3</code>). It is arguably a lot harder to express Prolog rules and other constructs using the syntax of Erlang.
</p>

<div class="alert alert-success">
  <h5>Where Prolog and Erlang are similar:</h5> 
  <ul>
      <li>Erlang and Prolog are both dynamically typed languages.</li>
      <li>Most data types map cleanly between the two languages. Atoms are the same in Erlang and Prolog, and the same goes for integers and floating point numbers.</li>
      <li>Erlang tuples are close to Prolog terms.</li>
      <li>Lists look and behave the same in Prolog and Erlang.</li>
      <li>Variables are assign-once variables in both languages.</li>
      <li>In both languages, pattern matching is the dominant way to select clauses and pass values.</li>
      <li>Loops are normally implemented by means of recursion.</li>
  </ul>
  <h5>Where Prolog and Erlang are different:</h5> 
  <ul>
      <li>Prolog is relational, whereas Erlang is functional. This isn't a dramatic difference, however, since formally a function is just a special case of a relation. </li>
      <li>In Erlang pattern matching is one-way, whereas Prolog uses full unification.</li>
      <li>Prolog is a logic programming language, whereas Erlang is an actor programming language.</li>
  </ul>
</div>

<p>
    The Web Prolog primitives for spawning and messaging are borrowed straight from Erlang. Thus, Web Prolog is an actor programming language, just like Erlang, while it <i>also</i> retains it's logic programming heritage. 
</p>

<p>
    An important similarity between Erlang and Web Prolog is that spawning and sending
work also in a distributed setting. Processes (or "actors" as we prefer to call them) may be created on remote nodes, and communication with them is transparent in the sense that communication with remote actors works exactly as communication with local actors.
</p>

<p>
    Here's a significant difference: The Erlang distribution mechanism is implemented using raw TCP/IP sockets whereas Web Prolog uses WebSockets. Not only does the use of WebSockets save us from having to implement our own message based protocol on top of TCP/IP, it also allows communication to pass through firewalls, and implements various security-related features such as methods for authentication, secure WebSockets over HTTPS and <a target="_blank" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS (Cross-Origin Request Sharing)</a>.
</p>

<p>
    Both Erlang and Prolog have found a sweet spot on the scale between purity and practical usefulness. Web Prolog is looking for a still sweet but slightly different spot in the domain of web programming.
</p>
                            

<h3>Spawning, sending and receiving</h3>

<p>
    There are three primitives required for concurrency in Web Prolog: spawning new processes, 
    sending messages, and receiving messages. They borrow most of their semantics from Erlang and are implemented by the predicates <code>spawn/1-3</code>, <code>!/2</code>
    and <code>receive/1-2</code>, respectively.
</p>

<p>
  	In the following example <code>spawn/1</code> is used to spawn a new actor process running a goal 
	that will solve the query <code>?-length([a,b,c],_N)</code> and send the value of <code>_N</code>
	back to the calling process identified as <code>Self</code> where it will be received by 
	<code>receive/1</code>:
</p>

<pre id="spawning1">
?- self(Self), 
   spawn((length([a,b,c],_N), Self ! _N)), 
   receive({_M -> io:write(_M)}).
</pre>

<pre id="spawning2" class="collapse">
1> Self = self(), 
   spawn(fun() -> Self ! length([a,b,c]) end), 
   receive M -> io:write(M) end.
   
% A little bit of unnesting makes the similarities even clearer:

2> Self = self(), 
   spawn(fun() -> N = length([a,b,c]), Self ! N end), 
   receive M -> io:write(M) end.
</pre>

<p>
  <button onclick='enter("#spawning1")' class="btn btn-xs btn-primary" type="button">Enter</button>
  &nbsp;&nbsp;<input type='checkbox' data-toggle="collapse" data-target="#spawning2">&nbsp;Compare with Erlang</input>
</p>

<p>
    Yep, this example was kind of silly. The spawned process terminated almost immediately and <code>!/2</code> was only used to send the value of a variable to the top-level process. We'll look at more realistic examples further down in the text.
</p>

<div class="alert alert-info">
  <strong>Tip!</strong> Did you notice the Compare with Erlang checkbox? Selecting it will show the Erlang way of writing the example.
</div>


<h3>Messages deferred</h3>

<p>
    If an invocation of <code>receive/1-2</code> cannot match a message in the mailbox, the message is <i>deferred</i>, possibly to be handled later in the control flow of the process. The receive is still running, waiting for more messages to arrive, and for one that would match. This behaviour is particularly useful if we expect two messages, <code>hello</code> and <code>goodbye</code>, but are not sure which one will arrive first. If we insist on processing <code>hello</code> before <code>goodbye</code>, we can easily do that with receive:
</p>

<pre id="deferred1">
wait_hello :-
    receive({
        hello ->
            io:write('Got hello!'),
            wait_goodbye
    }).

wait_goodbye :-
    receive({
        goodbye ->
            io:write('Got goodbye!')
    }).
</pre>

<p>
  <button onclick='consult("#deferred1")' class="btn btn-xs btn-primary" type="button">Consult</button>
</p> 

<p>
    To see what happens, let's put <code>goodbye</code> before <code>hello</code> in the top-level mailbox queue and then call <code>wait_hello/0</code>:
</p>

<pre id="deferred2">
?- self(_Self), 
   _Self ! goodbye, 
   _Self ! hello,
   wait_hello.
</pre>

<p>
  <button onclick='enter("#deferred2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>


<h3>A priority queue example</h3>

<p> 
    Just like in Erlang, a receive clause in Web Prolog can have a <em>guard</em> in the form of a goal placed just after the <code>when</code> operator and before the arrow <code>-></code>. In contrast to Erlang, any kind of goal may serve as a guard.
</p>

<p> 
    As a way to demonstrate the use of a guard, as well as the use of two 
    <code>receive/2</code> options that causes a goal to be run on timeout, here's a priority queue 
    example borrowed from <a target="_blank" href="http://learnyousomeerlang.com">http://learnyousomeerlang.com</a>. 
	Calling <code>important/1</code> will build a list of all messages with those with a priority 
	above 10 coming first: 
</p>
    
<pre id="priority1">
important(Messages) :-
    receive({
        Priority-Message when Priority > 10 ->
            Messages = [Message|MoreMessages],
            important(MoreMessages);
    	after(0) -> 
            normal(Messages)
    }).

normal(Messages) :-
    receive({
        _-Message ->
            Messages = [Message|MoreMessages],
            normal(MoreMessages);
    	after(0) -> 
            Messages = []
    }).  
</pre>

<pre id="priority4" class="collapse">
important() ->
    receive
        {Priority, Message} when Priority > 10 ->
            [Message | important()]
    after 0 ->
        normal()
    end.
 
normal() ->
    receive
        {_, Message} ->
            [Message | normal()]
    after 0 ->
        []
    end.
</pre>

<p>
  <button onclick='consult("#priority1")' class="btn btn-xs btn-primary" type="button">Consult</button>
  &nbsp;&nbsp;<input type='checkbox' data-toggle="collapse" data-target="#priority4">&nbsp;Compare with Erlang</input>
</p> 

<p>
    To test our program, we use a combination of <code>self/1</code> and the send operator <code>!/2</code> to send four messages to the mailbox of the 
    top-level pengine.
</p>

<pre id="priority2">
?- self(S), S ! 15-high, S ! 7-low, S ! 1-low, S ! 17-high.
</pre>

<p>
  <button onclick='enter("#priority2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Finally, to compute a list where all the important messages appear
    before the less important ones we call <code>important/1</code>:
</p>

<pre id="priority3">
?- important(Messages).
</pre>

<p>
  <button onclick='enter("#priority3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>


<h3>Some actors are servers</h3>
    
<p>
    A typical use of <code>spawn/1-3</code> is to call a locally or remotely defined Web Prolog procedure that specifies the (usually longtime) behaviour of the actor process thus created &ndash; the kind of messages it will listen for (using <code>receive/1-2</code>), and what kind of messages will be returned (by means of <code>!/2</code>). In the Erlang community, such actors are usually referred to as <em>servers</em>. It's common to distinguish between two kinds of servers, those that are <i>stateless</i>, and those that are <i>stateful</i>.
</p>

<p> 
    Let's start by writing a stateless server. Using the primitives for spawning, sending and receiving, we can easily write a program that will respond with a <code>pong</code> message to any client that sends it a <code>ping</code> message. The pid of the client must be included in the <code>ping</code> message so that the server knows where to send the <code>pong</code>. First, let's consult the following source code:
</p> 
    
<pre id="server1">
pong_server :-
    receive({
        ping(From) ->
            From ! pong,
            pong_server
    }).
</pre>

<p>
  <button onclick='consult("#server1")' class="btn btn-xs btn-primary" type="button">Consult</button>
</p> 

<p>
    Here's how to spawn the server process:
</p>

<pre id="server2">
?- spawn(pong_server, Pid, [
       src_predicates([pong_server/0])
   ]).
</pre>

<p>
  <button onclick='enter("#server2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    The option <code>src_predicates</code> is one of several options that can be used to inject 
    source code into the actor process to be created.  As shown above, it takes a list of predicate indicators. (Other options that can be used for the purpose of injecting code are <code>src_text</code>, <code>src_list</code> and <code>src_uri</code>. Their uses will be demonstrated further down in the text.)
</p>

<p>
    We also need to determine the identity of our top-level pengine:
</p>

<pre id="server3">
?- self(Self).
</pre>

<p>
  <button onclick='enter("#server3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    We use the operator <code>!/2</code> to send messages to the mailbox of the 
    spawned process. Note also the use of a shell utility feature borrowed from SWI-Prolog, allowing us
	to reuse bindings resulting from the successful execution of a top-level goal in future
	top-level goals as <code>$Var</code>:
</p>

<pre id="server4">
?- $Pid ! ping($Self).
</pre>

<p>
  <button onclick='enter("#server4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Web Prolog has a feature, borrowed from Erlang, in the form of a predicate <code>flush/0</code> 
    that will print (and remove) any messages in the mailbox belonging to the top-level pengine. Let's
    call it:
</p>

<pre id="server5">
?- flush.
</pre>

<p>
  <button onclick='enter("#server5")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p> 
    So far, the similarity with Erlang has turned out to be rather striking. But Web Prolog also allows us to define such a server in another way, using a repeat-fail loop rather than a recursive loop. This isn't possible in Erlang.
</p>
    
<pre id="server6">
repeat_fail_pong_server :-
    repeat,
    receive({
        ping(From) ->
            From ! pong,
            fail
    }).
</pre>

<p>
  <button onclick='consult("#server6")' class="btn btn-xs btn-primary" type="button">Consult</button>
</p> 

<p>
    In Prolog, repeat-fail loops (or the more general concept of failure-driven loops) form the basis of the all-solutions predicates and predicates such as <code>forall/2</code>. However, most Prolog programmers like to keep them hidden as far under the hood as possible. We agree with this, so we like the server with the recursive loop better.
</p>

<p>
    Let's start the new server and send ping messages to it. For a change, we use <code>receive/1</code> instead of 
	<code>flush/0</code> to capture response messages. We send a ping twice, and wait for a pong response twice, and this time we'll do it all in a single call:
</p>

<pre id="server7">
?- spawn(repeat_fail_pong_server, _Pid, [
       src_predicates([repeat_fail_pong_server/0])
   ]),
   self(_Self),
   _Pid ! ping(_Self),
   _Pid ! ping(_Self),
   receive({Msg1 -> true}),
   receive({Msg2 -> true}).
</pre>

<p>
  <button onclick='enter("#server7")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<div class="alert alert-success">
<p>
    <strong>Surprised?</strong> For an Erlang programmer the above use of <code>receive/1</code> may indeed come as a surprise. After all, the Prolog notions of <i>failure</i>, <i>backtracking</i> and the use of failure to force backtracking are foreign to Erlang. Prolog programmers may recognise a behaviour due to the fact that <code>receive/1-2</code> is a <i>semi-deterministic</i> predicate, i.e. a predicate that either fails or succeeds exactly once. We may want to compare <code>receive/1</code> with <code>read/1</code> in traditional Prolog, which is also semi-deterministic, and also serves the purpose of receiving data from the environment. But whereas <code>read/1</code> fails if the pattern (consisting of any term) in the argument doesn't unify with the term that is read, the only way that <code>receive/1-2</code> will fail is if the goal in the <i>body</i> of one of its receive clauses fails. After all, what else could it possibly mean if the goal in the body of a receive clause fails? We would argue that letting the whole call fail gives us the only reasonable semantics of <code>receive/1-2</code>.
</p>
</div>

<div class="alert alert-info">
  <strong>Tip!</strong> Most examples from the tutorial can be edited in an editor that will fill the space that this tutorial currently occupies. Select various examples from the Examples menu.
</div>


<h3>Node-resident actor processes</h3>

<p>
    As we saw in an earlier example, the owner of a node may install node-resident programs, i.e. source code for predicates that can be accessed by any client to this node, as if those predicates were built-in. In addition, the owner may install <em>node-resident actor processes</em> &ndash; long-lived processes that can be accessed by any client. We show an example below, installed for the purpose of this tutorial, that uses <code>register/2</code> to give the process a mnemonic name. 
</p>

<pre>
count_server(Count0) :-
    Count is Count0 + 1,
    receive({
        count(From) ->
            From ! Count,
            count_server(Count)
    }).
    
:- spawn(count_server(0), Pid),
   register(counter, Pid).   
</pre>

<p>
    Note that this also happens to be our first example of a <i>stateful</i> server, as it uses the argument in <code>count_server/1</code> to carry around the state of the counter, i.e. the count itself.
</p>

<p>
    The registered name can be used instead of the pid when sending to the process:
</p>

<pre id="node-res-actor">
?- self(_Self),
   counter ! count(_Self),
   receive({Count -> true}).
</pre>

<p>
  <button onclick='enter("#node-res-actor")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Did you receive a count greater than 1 when you clicked Enter? If so, it just means that someone else, running this tutorial somewhere else in the world, has clicked the Enter button before you did. Contrary to the state of a server that is spawned from your pengine, the state of a node-resident server is accessible from any client to the node that knows the registered name of the server.
</p>


<h3>A fridge simulation example</h3>

<p>
    As a tastier example of how a process can be made to hold an updatable state during
    a conversation, and for the purpose of demonstrating a receive call that uses different
    receive clauses in order to listen for more than one kind of message, we have adapted a
    fridge simulation example from Fred Hebert's excellent book on Erlang, available at
	<a target="_blank" href="http://learnyousomeerlang.com">http://learnyousomeerlang.com</a>.
</p>

<p>
    Using <code>spawn/3</code>, the program creates a local process that simulates
    a fridge. The <code>src_text</code> option of <code>spawn/3</code> is used to pass the 
    program to the actor process to be created. 
</p>
    
<pre id="fridge1">
start(Pid) :-
    spawn(fridge([]), Pid, [
        src_text("
    
            fridge(FoodList0) :-
                receive({
                    store(From, Food) ->
                        From ! ok,
                        fridge([Food|FoodList0]);
                    take(From, Food) ->
                        (   select(Food, FoodList0, FoodList)
                        ->  From ! ok(Food),
                            fridge(FoodList)
                        ;   From ! not_found,
                            fridge(FoodList0)
                        );
                    terminate ->
                        true
                }).    
        ")
    ]).   
</pre>

<pre id="fridge2" class="collapse">
fridge(FoodList) ->
    receive
        {From, {store, Food}} ->
            From ! {self(), ok},
            fridge([Food|FoodList]);
        {From, {take, Food}} ->
            case lists:member(Food, FoodList) of
                true ->
                    From ! {self(), {ok, Food}},
                    fridge(lists:delete(Food, FoodList));
                false ->
                    From ! {self(), not_found},
                    fridge(FoodList)
            end;
        terminate ->
            ok
    end.
</pre>

<p>
  <button onclick='consult("#fridge1")' class="btn btn-xs btn-primary" type="button">Consult</button>
  &nbsp;&nbsp;<input type='checkbox' data-toggle="collapse" data-target="#fridge2">&nbsp;Compare with Erlang</input>
</p> 

<p>
    Let's try this by running the following goal ...
</p>

<pre id="fridge3">
?- start(Pid),
   self(Self),
   Pid ! store(Self, meat),
   Pid ! store(Self, cheese),
   Pid ! take(Self, meat),
   Pid ! take(Self, cheese),
   Pid ! take(Self, cheese).
   Pid ! terminate.
</pre>

<p>
  <button onclick='enter("#fridge3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    ... and then check the content of the top-level mailbox:
</p>

<pre id="fridge4">
?- flush.
</pre>

<p>
  <button onclick='enter("#fridge4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>


<div class="alert alert-info">
  <strong>Tip! (for prologers)</strong> Yep, Fred Hebert's book is awesome, and it's free. Read it online at <a target="_blank" href="http://learnyousomeerlang.com">http://learnyousomeerlang.com</a>. If you are a prologer you could probably start from <a target="_blank" href="http://learnyousomeerlang.com/the-hitchhikers-guide-to-concurrency">here</a>.
</div>


<h3>Using all-solutions predicates</h3>

<p>
    You can do it, they are there:
</p>

<pre id="findall1">
?- findall(_I, between(1, 10, _I), L).
</pre>

<p>
  <button onclick='enter("#findall1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    One thing that a top-level pengine can do, but that the traditional shell doesn't really take advantage of, is to generate batches of n solutions at a time. (The SWISH GUI is much better at this!)
</p>

<p>
    Not all is lost, however, since we can call <code>findnsols/3</code>:
</p>

<pre id="findnsols1">
?- findnsols(4, _I, between(1, 10, _I), L).
</pre>

<p>
  <button onclick='enter("#findnsols1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
   ...
</p>

<h3>Links, monitors and two kinds of exits</h3>

<p>
    In Erlang there are basically two ways to follow up what is going on with a process: <i>links</i> and <i>monitors</i>. Links causes linked processes to be shutdown together if one of them terminates abruptly. Monitors only notifies what happened to the other process.
</p>

<p>
    Links in Web Prolog are somewhat simpler than links in Erlang. The only kind of link 
    currently supported comes in the form of an option to <code>spawn/3</code>. In contrast to Erlang's bi-directional links, links in Web Prolog are uni-directional. As argued in \citep{conf/erlang/SvenssonFE10}, uni-directional links simplify things and don't harm expressivity. 
</p>

<p>
    Note that in Web Prolog an unauthorised user cannot spawn a process which is <i>not</i> linked to the process that spawned it. This is to avoid
leaving orphaned processes around. For the same reason, <code>unlink/1</code> isn't supported. 
</p>

<p>
    An obvious use of links is the following: when you leave (or reload) this tutorial, your top-level pengine as well as any actors that you may have spawned from the top-level must be forced to terminate. 
</p>

<p>
    Monitors in Web Prolog are also somewhat simpler than monitors in Erlang. The only kind of monitor 
    currently supported comes in the form of an option to <code>spawn/3</code>. The notion of a <i>monitor
    reference</i> isn't (yet) supported, and <i>demonitoring</i> isn't possible.
</p>


<div class="alert alert-danger">
  <strong>Strong warning!</strong> These may change in the future since we are not yet sure this is the right design. Comments are welcome!
</div>
    
<p>
    Just like Erlang, Web Prolog offers two ways to force the termination of an actor:
</p>

<ul>
    <li>
        <i>Internal exits</i> are triggered by calling the predicate <code>exit/1</code> which makes the 
        current process stop its execution. 
    </li>
    <li>
        <i>External exits</i> are called with <code>exit/2</code> and can be used to terminate any process. But only if you know its pid or its registered name (but only if you own it).
    </li>
</ul>

<p>Here's an example of the use of an internal exit and how it interacts with the <code>monitor</code> option:</p>

<pre id="exit1">
?- spawn(exit(hello), _, [
       monitor(true)
   ]).
</pre>

<p>
  <button onclick='enter("#exit1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Let's look in the top-level mailbox at what the monitoring produced:
</p>

<pre id="exit2">
?- flush.
</pre>

<p>
  <button onclick='enter("#exit2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>Here's an example of the use of an external exit:</p>

<pre id="exit3">
?- spawn(sleep(1), Pid, [
       monitor(true)
   ]),
   exit(Pid, goodbye).
</pre>

<p>
  <button onclick='enter("#exit3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Again, let's look at the result of monitoring the process:
</p>

<pre id="exit4">
?- flush.
</pre>

<p>
  <button onclick='enter("#exit4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>


<h3>A publish-subscribe service</h3>

<p>
     For the purpose of the tutorial, a node-resident actor implementing a simple publish-subscribe service has been installed on the node. Here's the source code:
</p>

<pre>
pubsub_service(Subscribers0) :-
    receive({
        publish(Message) ->
            forall(member(Pid, Subscribers0), Pid ! msg(Message)),
            pubsub_service(Subscribers0);
        subscribe(Pid) ->
            pubsub_service([Pid|Subscribers0]);
        unsubscribe(Pid) ->
            (   select(Pid, Subscribers0, Subscribers)
            ->  pubsub_service(Subscribers)
            ;   pubsub_service(Subscribers0)
            ).    
    }).

:- spawn(pubsub_service([]), Pid),
   register(pubsub_service, Pid).
</pre>

<p>
   In the following example we subscribe to the service, and (too lazy to write a recursive loop) invoke a repeat-fail loop waiting for messages to arrive from it: 
</p>

<pre id="pubsub1">
?- self(Self),
   pubsub_service ! subscribe(Self),
   repeat,
   io:write("Waiting for a message ..."),
   receive({
       msg(Message) ->
           io:format("Received: ~p", [Message]),
           fail
   }).
</pre>

<p>
  <button onclick='enter("#pubsub1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p> 

<p>
   The above call is blocking, so to see the effect of publishing a term to the service, you will either have to wait for someone else to publish to it, or (more realistically) open this tutorial in another page and do:
</p>

<pre id="pubsub2">
?- pubsub_service ! publish(hello).
</pre>

<p>
  <button onclick='enter("#pubsub2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p> 

<div class="alert alert-danger">
  <strong>BUG!</strong> Unfortunately, a bug stops you from aborting the blocking repeat-fail loop using Ctrl-C. Your only way out at this point is to reload the page.
</div>


<h3>Actors playing ping-pong</h3>

<p>
    Erlang-style asynchronous communication is key to the kind of concurrent programming that 
    Web Prolog's actor abstraction supports. In the following example, adapted from the example at <a target="_blank" href="http://erlang.org/doc/getting_started/conc_prog.html#id69544">http://erlang.org/doc/getting_started/conc_prog.html</a>, two processes are first
    created and then start sending messages to each other a specified number of times.
</p>

<pre id="pingpong1">
ping(0, Pong_Pid) :-
    Pong_Pid ! finished,
    io:format('Ping finished',[]).
ping(N, Pong_Pid) :-
    self(Self),
    Pong_Pid ! ping(Self),
    receive({
        pong ->
            io:format('Ping received pong',[])
    }),
    N1 is N - 1,
    ping(N1, Pong_Pid).
    
pong :-
    receive({
        ping(Ping_Pid) ->
            io:format('Pong received ping',[]),
            Ping_Pid ! pong,
            pong;
        finished ->
            io:format('Pong finished',[])
    }).
   
start(N) :-
    spawn(pong, Pong_Pid, [
        src_predicates([pong/0])
    ]),
    spawn(ping(N, Pong_Pid), _, [
        src_predicates([ping/2])
    ]).
</pre>


<pre id="pingpong3" class="collapse">
-module(tut15).

-export([start/0, ping/2, pong/0]).

ping(0, Pong_PID) ->
    Pong_PID ! finished,
    io:format("ping finished", []);

ping(N, Pong_PID) ->
    Pong_PID ! {ping, self()},
    receive
        pong ->
            io:format("Ping received pong", [])
    end,
    ping(N - 1, Pong_PID).

pong() ->
    receive
        finished ->
            io:format("Pong finished", []);
        {ping, Ping_PID} ->
            io:format("Pong received ping", []),
            Ping_PID ! pong,
            pong()
    end.

start() ->
    Pong_PID = spawn(tut15, pong, []),
    spawn(tut15, ping, [3, Pong_PID]).
</pre>

<p>
  <button onclick='consult("#pingpong1")' class="btn btn-xs btn-primary" type="button">Consult</button>
  &nbsp;&nbsp;<input type='checkbox' data-toggle="collapse" data-target="#pingpong3">&nbsp;Compare with Erlang</input>
</p>

<p>We call <code>start/1</code> to start the processes:</p>

<pre id="pingpong2">
?- start(3).
</pre>

<p>
  <button onclick='enter("#pingpong2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
   In our next example &ndash; our first example of distributed programming with actors  &ndash; we move the "ponger" to another node:
</p>

<pre id="pingpong4">
ping(0, Pong_Pid) :-
    Pong_Pid ! finished,
    io:format('Ping finished',[]).
ping(N, Pong_Pid) :-
    self(Self),
    Pong_Pid ! ping(Self),
    receive({
        pong ->
            io:format('Ping received pong',[])
    }),
    N1 is N - 1,
    ping(N1, Pong_Pid).
    
pong :-
    receive({
        ping(Ping_Pid) ->
            io:format('Pong received ping',[]),
            Ping_Pid ! pong,
            pong;
        finished ->
            io:format('Pong finished',[])
    }).
   
start(N) :-
    spawn(pong, Pong_Pid, [
        node('{{host}}'),   % This line is our only addition!
        src_predicates([pong/0])
    ]),
    spawn(ping(N, Pong_Pid), _, [
        src_predicates([ping/2])
    ]).
</pre>

<p>
  <button onclick='consult("#pingpong4")' class="btn btn-xs btn-primary" type="button">Consult</button>
</p>

<p>Again, we call <code>start/1</code> to start the process.</p>

<pre id="pingpong5">
?- start(3).
</pre>

<p>
  <button onclick='enter("#pingpong5")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
   So, why do we get the output of the "pinger" only, and not the output written by the "ponger"?
   The reason is that a shell can only receive and render output that is written from 
   actors that 1) live on the same node as the top-level pengine to which the shell is attached, and 2) are decendants of this top-level pengine. This 
   restriction may be lifted in the future.
</p>

<p>   
   You should also note that <code>pengine_input/2</code>
   <code>pengine_output/1</code> and <code>send/2</code> are the principal I/O predicates in Web Prolog
   (along with <code>io:read/1</code>). <code>io:write/1</code> should be considered a debugging tool).
</p>

<div class="alert alert-warning">
  <strong>Heads up!</strong> Note that we lie a little when we write that we moved the "ponger" process to another node. We are actually using the same node as the pinger is running on. This is so that we don't have to run more than one node for the purpose of this tutorial.
</div>

<h3>Porting Erlang programs to Web Prolog</h3>

<p>
    Below, we have ported  
    <a target="_blank" href="https://github.com/acmeism/RosettaCodeData/blob/master/Task/Dining-philosophers/Erlang/dining-philosophers.erl">
        an Erlang program</a> solving <a target="_blank" href="https://en.wikipedia.org/wiki/Dining_philosophers_problem">the Dining Philosophers problem</a> to Web Prolog.
</p>

<pre>
sleep :-
    Time is random_float/10,
    sleep(Time).

doForks(ForkList) :-
    receive({
        {grabforks, {Left, Right}} ->
            subtract(ForkList, [Left,Right], ForkList1),
            doForks(ForkList1);
        {releaseforks, {Left, Right}} -> 
            doForks([Left, Right| ForkList]);
        {available, {Left, Right}, Sender} ->
            (   member(Left, ForkList),
                member(Right, ForkList)
            ->  Bool = true
            ;   Bool = false
            ),
            Sender ! {areAvailable, Bool},
            doForks(ForkList);
        {die} -> 
            io:format("Forks put away.")
    }).

areAvailable(Forks, Have) :-
    self(Self),
    forks ! {available, Forks, Self},
    receive({
        {areAvailable, false} ->
            Have = false;
        {areAvailable, true} -> 
            Have = true
    }).

processWaitList([], false).
processWaitList([H|T], Result) :-
    {Client, Forks} = H,
    areAvailable(Forks, Have),
    (   Have == true
    ->  Client ! {served},
        Result = true
    ;   Have == false
    ->  processWaitList(T, Result)
    ).

doWaiter([], 0, 0, false) :-
    forks ! {die},
    io:format("Waiter is leaving."),
    diningRoom ! {allgone}.
doWaiter(WaitList, ClientCount, EatingCount, Busy) :-
    receive({
        {waiting, Client} ->
            WaitList1 = [Client|WaitList], % add to waiting list
            (   Busy == false,
                EatingCount&lt;2
            ->  processWaitList(WaitList1, Busy1)
            ;   Busy1 = Busy
            ),
            doWaiter(WaitList1, ClientCount, EatingCount, Busy1);
        {eating, Client} ->
            subtract(WaitList, [Client], WaitList1),
            EatingCount1 is EatingCount+1,
            doWaiter(WaitList1, ClientCount, EatingCount1, false);
        {finished} ->
            processWaitList(WaitList, R1),
            EatingCount1 is EatingCount-1,
            doWaiter(WaitList, ClientCount, EatingCount1, R1) ;
        {leaving} ->
            ClientCount1 is ClientCount - 1,
            flag(left_received, N, N+1),
            doWaiter(WaitList, ClientCount1, EatingCount, Busy)
    }).

philosopher(Name, _Forks, 0) :-
    io:format("~s is leaving.", [Name]),
    waiter ! {leaving},
    flag(left, N, N+1).
philosopher(Name, Forks, Cycle) :-
    self(Self),
    io:format("~s is thinking (cycle ~w).", [Name, Cycle]),
    sleep,
    io:format("~s is hungry (cycle ~w).", [Name, Cycle]),
    waiter ! {waiting, {Self, Forks}}, % sit at table
    receive({
        {served} -> 
            forks ! {grabforks, Forks}, % grab forks
            waiter ! {eating, {Self, Forks}}, % start eating
            io:format("~s is eating (cycle ~w).", [Name, Cycle])
    }),
    sleep,
    forks ! {releaseforks, Forks}, % put forks down
    waiter ! {finished},
    Cycle1 is Cycle - 1,
    philosopher(Name, Forks, Cycle1).

dining :-    
    AllForks = [1, 2, 3, 4, 5],
    Clients = 5,
    self(Self),
    register(diningRoom, Self),
    spawn(doForks(AllForks), ForksPid),
    register(forks, ForksPid),
    spawn(doWaiter([], Clients, 0, false), WaiterPid),
    register(waiter, WaiterPid),
    Life_span = 20,
    spawn(philosopher('Aristotle', {5, 1}, Life_span)),
    spawn(philosopher('Kant', {1, 2}, Life_span)),
    spawn(philosopher('Spinoza', {2, 3}, Life_span)),
    spawn(philosopher('Marx', {3, 4}, Life_span)),
    spawn(philosopher('Russel', {4, 5}, Life_span)),
    receive({
        {allgone} -> 
            io:format("Dining room closed.")
    }),
    unregister(diningRoom).   
</pre>

<p>Let's run it:</p>

<pre id="porting1">
?- dining.
</pre>

<p>
  <button onclick='enter("#porting1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Due to the many similarities between Erlang and Web Prolog, porting the code was fairly straightforward. We could even take advantage of the fact that an Erlang tuple such as <code>{grabforks,{Left,Right}}</code> is valid syntax in Prolog too, where it's not a tuple but a complex term of the form <code>{}((grabforks,{}((Left,Right))))</code>. 
</p>    
    
<div class="alert alert-info">
  <strong>Tip!</strong> In general, however, we recommend that (in a second pass) such terms are replaced by less complex ones. In this case, <code>grabforks(Left-Right)</code> would probably work just fine.
</div>

<div class="alert alert-success">
  <h5>Some open questions</h5> 
  <ul>
      <li>Would support for functional notation be useful when porting Erlang code to Web Prolog? (Such support can quite easily be provided.)</li>
      <li>Can (relevant parts) of the OTP be ported to Web Prolog?</li>
      <li>Can Prolog be used to parse Erlang programs?</li>
  </ul>
</div>

<h2>Web Prolog is a hybrid of Prolog and Erlang</h2>

<p>
    We have shown that most Prolog programs can be ported to Web Prolog (that's easy) and we have demonstrated that many Erlang programs can be ported as well (although that's somewhat trickier). Is all well and dandy then? Can Web Prolog be considered a reasonably hybrid between Prolog and Erlang? (A linguist would perhaps use the term <a target="_blank" href="https://en.wikipedia.org/wiki/Creole_language">creole language</a> here.)
</p>

<p>
    As we have seen, an actor is equipped with a <em>dynamic database</em> which is private to it. This isn't something that Erlang has, and we need to investigate whether this could lead to problems.
</p>

<p>
    It's probably wise to entertain a suspicion of unexpected interactions between language features and possible impedance mismatches between the two paradigms &ndash; between Prolog's relational, non-deterministic programming model and Erlang's functional and message passing model. How well do the Erlang-ish constructs mix with Prolog, with backtracking for example?
</p>

<h3>A dynamic database fridge</h3>

<p>
    As hinted at in the introduction, in Web Prolog every actor is equipped with its own private dynamic database. This database cannot be updated from the outside, and when updates are performed from the inside, they are not accessible from the outside. Thus, the dynamic database gives us an alternative way to maintain the state of an actor. Here's how the fridge simulation may be written in this style:
</p>

<pre id="dynamic1">
start(Pid) :-
    spawn(fridge, Pid, [
        src_text("
        
            :- dynamic food/1.
    
            fridge :-
                receive({
                    store(From, Food) ->
                        assert(food(Food)),
                        From ! ok,
                        fridge;
                    take(From, Food) ->
                        (   retract(food(Food))
                        ->  From ! ok(Food),
                            fridge
                        ;   From ! not_found,
                            fridge
                        );
                    terminate ->
                        true
                }).    
        ")
    ]).   
</pre>

<p>
  <button onclick='consult("#dynamic1")' class="btn btn-xs btn-primary" type="button">Consult</button>
</p> 

<p>
    Let's try this by running the following goal ...
</p>

<pre id="dynamic2">
?- start(Pid),
   self(Self),
   Pid ! store(Self, meat),
   Pid ! store(Self, cheese),
   Pid ! take(Self, meat),
   Pid ! take(Self, cheese),
   Pid ! take(Self, cheese).
   Pid ! terminate.
</pre>

<p>
  <button onclick='enter("#dynamic2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    ... and then check the content of the top-level mailbox:
</p>

<pre id="dynamic3">
?- flush.
</pre>

<p>
  <button onclick='enter("#dynamic3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    The <i>dynamic database</i> is a non-logical extension to Prolog and the use of it for managing state is usually frowned upon by Prolog programmers since changes to the database are not reverted on backtracking, and since clauses of dynamic predicates are like destructible global variables and therefore subject to all the common problems with such objects.
</p>

<p>
    In Erlang, each process has a local store called the <i>process dictionary</i> and Erlang support a handful of built-in functions for manipulating it. Erlang programmers are advised again using it since it destroys referential transparency and makes debugging difficult.
</p>



<h3>Controlling backtracking</h3>

<p>
    Let's turn to a tiny but illustrative example which seems to show that the mix is both sound and easy to understand as far as backtracking is concerned. Suppose the goal given in the first argument to <code>spawn/2</code> has more than one answer, a query such as <code>?-ancestor_decendant(mike, Who)</code> for example. Below, we call the goal, send the result back to the calling process, and then use <code>receive/1</code> to listen for a message of the form <code>next</code> or <code>stop</code> before terminating.
</p>

<pre id="pre-pengine1">
?- self(_Self),
   spawn(( ancestor_decendant(mike, _Who),
           _Self ! _Who,
           receive({
               next -> fail;
               stop -> 
                   _Self ! stopped
           })
        ), Pid).
</pre>

<p>
  <button onclick='enter("#pre-pengine1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>The first answer to the query should now be present in the mailbox of the top-level pengine and can be inspected if we call <code>flush/0</code>:</p>

<pre id="pre-pengine2">
?- flush.
</pre>

<p>
  <button onclick='enter("#pre-pengine2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    At this point, the receive call is blocking while waiting for messages to show up in the mailbox. To check if there are more solutions to our query we send a message <code>next</code> to the actor. This will cause the receive to fail and thus force the backtracking that will lead to the successful search for the next solution:
</p>

<pre id="pre-pengine3">
?- $Pid ! next.
</pre>

<p>
  <button onclick='enter("#pre-pengine3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Did we get the next solution?:
</p>

<pre id="pre-pengine4">
?- flush.
</pre>

<p>
  <button onclick='enter("#pre-pengine4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Sending <code>stop</code> will terminate the query:
</p>

<pre id="pre-pengine5">
?- $Pid ! stop.
</pre>

<p>
  <button onclick='enter("#pre-pengine5")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>        

<pre id="pre-pengine6">
?- flush.
</pre>


<p>
  <button onclick='enter("#pre-pengine6")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    This suggests that Prolog's backtracking mechanism is perfectly compatible with, and in fact 
    complements, the proposed Erlang-like mechanism for spawning actors and handling the communication
    between them. 
</p>

<p>
    We need to observe, however, that the goal to be solved in the above example is
    hard-coded into the program, and that the program handles neither failure of the spawned goal, nor
    exceptions thrown by it. 
</p>


<h3>A generic encapsulated search procedure</h3>

<p>
    Below, we define a generic encapsulated search predicate by using a meta-predicate <code>call_cleanup/2</code>
    and by specifying a small set of custom messages carrying answers
    that needs to be returned to the calling process. Note that <code>call_cleanup/2</code> is
    here used not only to call a goal, but also to check if any choice points remain after the goal
    has been called or backtracked into.
</p>

<pre id="encapsulated-search1">
search(Query, Pid) :-
    self(Self),
    spawn(query(Query, Pid, Self), Pid, [
        monitor(true),
        src_predicates([query/3])
    ]).
    
query(Query, Self, Parent) :-
    call_cleanup(Query, Det=true),
    (   var(Det)
    ->  Parent ! success(Self, Query, true),
        receive({
            next -> fail;
            stop -> true
        })
    ;   Parent ! success(Self, Query, false)
    ).
</pre>

<p>
  <button onclick='consult("#encapsulated-search1")' class="btn btn-xs btn-primary" type="button">Consult</button>
</p>

<p>
    Here's how to call <code>search/2</code> with a query:
</p>

<pre id="encapsulated-search2">
?- search(member(_X,[a,b,c]), Pid).
</pre>

<p>
  <button onclick='enter("#encapsulated-search2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>Let's flush to inspect the first solution:</p>

<pre id="encapsulated-search3">
?- flush.
</pre>

<p>
  <button onclick='enter("#encapsulated-search3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>Ask for the next solution, but now let's wait for the expected message using receive instead of doing the flush:</p>

<pre id="encapsulated-search4">
?- $Pid ! next,
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#encapsulated-search4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>


<p>Tell the actor to stop:</p>

<pre id="encapsulated-search6">
?- $Pid ! stop,
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#encapsulated-search6")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    What about failures and exceptions? Well, since we used a monitor the information provided in the <code>down</code> message tells us what we need to know. Try the following queries and see for yourself:
</p>

<pre id="encapsulated-search8">
?- search(false, _Pid),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#encapsulated-search8")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<pre id="encapsulated-search9">
?- search(not_defined, _Pid),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#encapsulated-search9")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    This section offered some insight into how encapsulated search works when understood as an actor that adheres to a particular protocol. Seemed tricky? Here's the good news: you don't need to build your own implementations of encapsulated search, but can rely on pengines &ndash; the special kind of actors introduced in the beginning of the tutorial. 
</p>

<h3>The pengine behaviour</h3>

<p>
    A pengine is like a first-class interactive Prolog top-level, accessible from Web Prolog as well as from other programming languages. (For example, recall that the shell running in the area to the right is an application written in HTML, CSS and JavaScript that is talking to a pengine.)
</p>

<p>
    Whereas encapsulated search (as implemented above) allows only one query per process created, a pengine allows a full <i>session</i> per process, possibly involving many queries. Indeed, we may want to refer to a pengine as an <i>encapsulated Prolog session</i>. That's an abstraction that ought to be able to make Prolog programmers feel right at home. (If you're a Prolog programmer, you do feel at home with the shell, don't you?)
</p>

<p>
    As we have already stated, a pengine is also an actor, a special <i>kind</i> of actor. Its behaviour differ from the behaviours of other kinds of actors in that it adheres to a communication protocol specific to pengines &ndash; the Pengine Communication Protocol (PCP).
</p>

<p>
    The statechart below depicts the PCP, a protocol for the communication between a client and a server (in the Erlang sense of these terms). The server is a pengine. The client can be any kind of process (including another pengine) capable of sending the messages and signals in bold to the server. The server is responsible for returning the messages with a leading / to the client.
</p>

<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   version="1.1"
   viewBox="0.0 0.0 624.0 331.501312335958"
   fill="none"
   stroke="none"
   stroke-linecap="square"
   stroke-miterlimit="10"
   id="svg249"
   sodipodi:docname="PLAP_statechart2.svg"
   inkscape:version="0.92.2 5c3e80d, 2017-08-06">
  <metadata
     id="metadata255">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <defs
     id="defs253" />
  <sodipodi:namedview
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1"
     objecttolerance="10"
     gridtolerance="10"
     guidetolerance="10"
     inkscape:pageopacity="0"
     inkscape:pageshadow="2"
     inkscape:window-width="1277"
     inkscape:window-height="813"
     id="namedview251"
     showgrid="false"
     inkscape:snap-text-baseline="false"
     inkscape:snap-global="false"
     inkscape:zoom="1.326252"
     inkscape:cx="277.05462"
     inkscape:cy="128.29286"
     inkscape:window-x="53"
     inkscape:window-y="0"
     inkscape:window-maximized="0"
     inkscape:current-layer="svg249" />
  <clipPath
     id="p.0">
    <path
       d="m0 0l624.0 0l0 331.5013l-624.0 0l0 -331.5013z"
       clip-rule="nonzero"
       id="path2" />
  </clipPath>
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path5"
     d="M 0,0 H 624 V 331.5013 H 0 Z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path7"
     d="m 42.624672,50.679825 v 0 c 0,-10.85582 8.800381,-19.656202 19.656204,-19.656202 H 501.11018 c 5.21316,0 10.21276,2.070913 13.89901,5.75717 3.68628,3.686252 5.7572,8.685883 5.7572,13.899033 V 287.39893 c 0,10.8558 -8.80038,19.65618 -19.65622,19.65618 H 62.280875 c -10.855824,0 -19.656204,-8.80038 -19.656204,-19.65618 z" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path9"
     d="m 42.624672,50.679825 v 0 c 0,-10.85582 8.800381,-19.656202 19.656204,-19.656202 H 501.11018 c 5.21316,0 10.21276,2.070913 13.89901,5.75717 3.68628,3.686252 5.7572,8.685883 5.7572,13.899033 V 287.39893 c 0,10.8558 -8.80038,19.65618 -19.65622,19.65618 H 62.280875 c -10.855824,0 -19.656204,-8.80038 -19.656204,-19.65618 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path11"
     d="m 362.81366,225.3327 v 0 c 0,-2.65561 2.15277,-4.80841 4.80838,-4.80841 h 95.26511 c 1.27527,0 2.49829,0.50661 3.40006,1.40836 0.90173,0.90174 1.40832,2.12478 1.40832,3.40005 v 19.2336 c 0,2.65559 -2.15277,4.80839 -4.80838,4.80839 h -95.26511 c -2.65561,0 -4.80838,-2.1528 -4.80838,-4.80839 z" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-output"
     d="m 362.81366,225.3327 v 0 c 0,-2.65561 2.15277,-4.80841 4.80838,-4.80841 h 95.26511 c 1.27527,0 2.49829,0.50661 3.40006,1.40836 0.90173,0.90174 1.40832,2.12478 1.40832,3.40005 v 19.2336 c 0,2.65559 -2.15277,4.80839 -4.80838,4.80839 h -95.26511 c -2.65561,0 -4.80838,-2.1528 -4.80838,-4.80839 z"
     inkscape:label="#path13" />
  <path
     style="fill:#000000;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path15"
     d="m 18.16187,31.334574 v 0 c 0,-3.600723 2.918962,-6.519684 6.519686,-6.519684 v 0 c 1.729128,0 3.387434,0.686892 4.610113,1.909571 1.222677,1.222677 1.90957,2.880985 1.90957,4.610113 v 0 c 0,3.600721 -2.918962,6.519685 -6.519684,6.519685 v 0 c -3.600723,0 -6.519685,-2.918964 -6.519685,-6.519685 z" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path17"
     d="m 18.16187,31.334574 v 0 c 0,-3.600723 2.918962,-6.519684 6.519686,-6.519684 v 0 c 1.729128,0 3.387434,0.686892 4.610113,1.909571 1.222677,1.222677 1.90957,2.880985 1.90957,4.610113 v 0 c 0,3.600721 -2.918962,6.519685 -6.519684,6.519685 v 0 c -3.600723,0 -6.519685,-2.918964 -6.519685,-6.519685 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path19"
     d="M 25.741367,37.241383 43.001209,54.501225" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path21"
     d="m 25.741367,37.241383 13.0172,13.017204" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path23"
     d="m 37.59062,51.426537 4.376869,2.040966 -2.040966,-4.376869 z" />
  <path
     style="fill:#ffffff;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="state-2"
     d="m 338.66934,81.90589 v 0 c 0,-3.766045 3.05298,-6.819031 6.81903,-6.819031 h 27.2753 v 0 c 1.80853,0 3.54297,0.71843 4.82181,1.997246 1.27881,1.278816 1.99722,3.013267 1.99722,4.821785 v 206.17297 c 0,3.76605 -3.05298,6.81903 -6.81903,6.81903 h -27.2753 c -3.76605,0 -6.81903,-3.05298 -6.81903,-6.81903 z"
     inkscape:label="#path25" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path27"
     d="m 338.66934,81.90589 v 0 c 0,-3.766045 3.05298,-6.819031 6.81903,-6.819031 h 27.2753 v 0 c 1.80853,0 3.54297,0.71843 4.82181,1.997246 1.27881,1.278816 1.99722,3.013267 1.99722,4.821785 v 206.17297 c 0,3.76605 -3.05298,6.81903 -6.81903,6.81903 h -27.2753 c -3.76605,0 -6.81903,-3.05298 -6.81903,-6.81903 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path29"
     d="m 394.1746,192.33089 h 58.2677 v 23.49606 h -58.2677 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path31"
     d="m 403.1746,212.9915 2.48437,-8.875 h 0.84375 l -2.48437,8.875 z m 3.74023,-3.25 q 0,-1.73438 0.95313,-2.5625 0.79687,-0.6875 1.95312,-0.6875 1.28125,0 2.09375,0.84375 0.82813,0.82812 0.82813,2.3125 0,1.20312 -0.35938,1.89062 -0.35937,0.6875 -1.0625,1.07813 -0.6875,0.375 -1.5,0.375 -1.29687,0 -2.10937,-0.82813 -0.79688,-0.84375 -0.79688,-2.42187 z m 1.07813,0 q 0,1.1875 0.51562,1.78125 0.53125,0.59375 1.3125,0.59375 0.79688,0 1.3125,-0.59375 0.51563,-0.59375 0.51563,-1.8125 0,-1.15625 -0.53125,-1.75 -0.51563,-0.59375 -1.29688,-0.59375 -0.78125,0 -1.3125,0.59375 -0.51562,0.57812 -0.51562,1.78125 z m 10.06445,3.10937 V 211.929 q -0.73437,1.0625 -1.98437,1.0625 -0.54688,0 -1.03125,-0.20313 -0.46875,-0.21875 -0.70313,-0.53125 -0.23437,-0.32812 -0.32812,-0.79687 -0.0625,-0.29688 -0.0625,-0.98438 v -3.84375 h 1.0625 v 3.45313 q 0,0.8125 0.0625,1.10937 0.0937,0.40625 0.40625,0.65625 0.32812,0.23438 0.8125,0.23438 0.46875,0 0.875,-0.23438 0.42187,-0.25 0.59375,-0.67187 0.1875,-0.42188 0.1875,-1.21875 v -3.32813 h 1.04687 v 6.21875 z m 4.89258,-0.9375 0.15625,0.92188 q -0.45312,0.0937 -0.79687,0.0937 -0.57813,0 -0.89063,-0.17188 -0.3125,-0.1875 -0.45312,-0.48437 -0.125,-0.29688 -0.125,-1.25 v -3.57813 h -0.76563 v -0.8125 h 0.76563 v -1.54687 l 1.04687,-0.625 v 2.17187 h 1.0625 v 0.8125 h -1.0625 v 3.64063 q 0,0.45312 0.0469,0.57812 0.0625,0.125 0.1875,0.20313 0.125,0.0781 0.35937,0.0781 0.1875,0 0.46875,-0.0312 z m 1.03711,3.32813 v -8.60938 h 0.95312 v 0.79688 q 0.34375,-0.46875 0.76563,-0.70313 0.4375,-0.23437 1.04687,-0.23437 0.79688,0 1.40625,0.40625 0.60938,0.40625 0.90625,1.15625 0.3125,0.75 0.3125,1.64062 0,0.95313 -0.34375,1.71875 -0.32812,0.76563 -0.98437,1.17188 -0.65625,0.40625 -1.375,0.40625 -0.53125,0 -0.95313,-0.21875 -0.42187,-0.23438 -0.6875,-0.5625 v 3.03125 z m 0.95312,-5.46875 q 0,1.20312 0.48438,1.78125 0.48437,0.5625 1.17187,0.5625 0.70313,0 1.20313,-0.59375 0.5,-0.59375 0.5,-1.84375 0,-1.1875 -0.48438,-1.76563 -0.48437,-0.59375 -1.17187,-0.59375 -0.67188,0 -1.1875,0.625 -0.51563,0.625 -0.51563,1.82813 z m 9.79883,3.07812 V 211.929 q -0.73437,1.0625 -1.98437,1.0625 -0.54688,0 -1.03125,-0.20313 -0.46875,-0.21875 -0.70313,-0.53125 -0.23437,-0.32812 -0.32812,-0.79687 -0.0625,-0.29688 -0.0625,-0.98438 v -3.84375 h 1.0625 v 3.45313 q 0,0.8125 0.0625,1.10937 0.0937,0.40625 0.40625,0.65625 0.32812,0.23438 0.8125,0.23438 0.46875,0 0.875,-0.23438 0.42187,-0.25 0.59375,-0.67187 0.1875,-0.42188 0.1875,-1.21875 v -3.32813 h 1.04687 v 6.21875 z m 4.89258,-0.9375 0.15625,0.92188 q -0.45312,0.0937 -0.79687,0.0937 -0.57813,0 -0.89063,-0.17188 -0.3125,-0.1875 -0.45312,-0.48437 -0.125,-0.29688 -0.125,-1.25 v -3.57813 h -0.76563 v -0.8125 h 0.76563 v -1.54687 l 1.04687,-0.625 v 2.17187 h 1.0625 v 0.8125 h -1.0625 v 3.64063 q 0,0.45312 0.0469,0.57812 0.0625,0.125 0.1875,0.20313 0.125,0.0781 0.35937,0.0781 0.1875,0 0.46875,-0.0312 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="state-3"
     d="m 467.42902,81.90589 v 0 c 0,-3.766045 3.05298,-6.819031 6.81903,-6.819031 h 27.27533 v 0 c 1.8085,0 3.54297,0.71843 4.82178,1.997246 1.27881,1.278816 1.99725,3.013267 1.99725,4.821785 v 78.86587 c 0,3.76605 -3.05301,6.81903 -6.81903,6.81903 h -27.27533 c -3.76605,0 -6.81903,-3.05298 -6.81903,-6.81903 z"
     inkscape:label="#path33" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path35"
     d="m 467.42902,81.90589 v 0 c 0,-3.766045 3.05298,-6.819031 6.81903,-6.819031 h 27.27533 v 0 c 1.8085,0 3.54297,0.71843 4.82178,1.997246 1.27881,1.278816 1.99725,3.013267 1.99725,4.821785 v 78.86587 c 0,3.76605 -3.05301,6.81903 -6.81903,6.81903 h -27.27533 c -3.76605,0 -6.81903,-3.05298 -6.81903,-6.81903 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path37"
     d="m 467.37534,101.24934 -87.93701,0.12599" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-prompt"
     d="m 461.37534,101.25794 -81.93701,0.11739"
     inkscape:label="#path39" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path41"
     d="m 461.37772,102.90967 4.53571,-1.65823 -4.54047,-1.645229 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path43"
     d="m 391.7599,73.883446 h 67.84253 V 97.379509 H 391.7599 Z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path45"
     d="m 400.7599,94.544075 2.48438,-8.875 h 0.84375 l -2.48438,8.875 z m 4.13086,2.25 V 88.1847 h 0.95312 v 0.796875 q 0.34375,-0.46875 0.76563,-0.703125 0.4375,-0.234375 1.04687,-0.234375 0.79688,0 1.40625,0.40625 0.60938,0.40625 0.90625,1.15625 0.3125,0.75 0.3125,1.640625 0,0.953125 -0.34375,1.71875 -0.32812,0.765625 -0.98437,1.171875 -0.65625,0.40625 -1.375,0.40625 -0.53125,0 -0.95313,-0.21875 -0.42187,-0.234375 -0.6875,-0.5625 v 3.03125 z m 0.95312,-5.46875 q 0,1.203125 0.48438,1.78125 0.48437,0.5625 1.17187,0.5625 0.70313,0 1.20313,-0.59375 0.5,-0.59375 0.5,-1.84375 0,-1.1875 -0.48438,-1.765625 -0.48437,-0.59375 -1.17187,-0.59375 -0.67188,0 -1.1875,0.625 -0.51563,0.625 -0.51563,1.828125 z m 5.70508,3.078125 V 88.1847 h 0.95313 v 0.9375 q 0.35937,-0.65625 0.65625,-0.859375 0.3125,-0.21875 0.6875,-0.21875 0.53125,0 1.07812,0.328125 l -0.35937,0.984375 q -0.39063,-0.234375 -0.76563,-0.234375 -0.35937,0 -0.64062,0.21875 -0.26563,0.203125 -0.375,0.578125 -0.1875,0.5625 -0.1875,1.21875 v 3.265625 z m 3.6211,-3.109375 q 0,-1.734375 0.95312,-2.5625 0.79688,-0.6875 1.95313,-0.6875 1.28125,0 2.09375,0.84375 0.82812,0.828125 0.82812,2.3125 0,1.203125 -0.35937,1.890625 -0.35938,0.6875 -1.0625,1.078125 -0.6875,0.375 -1.5,0.375 -1.29688,0 -2.10938,-0.828125 -0.79687,-0.84375 -0.79687,-2.421875 z m 1.07812,0 q 0,1.1875 0.51563,1.78125 0.53125,0.59375 1.3125,0.59375 0.79687,0 1.3125,-0.59375 0.51562,-0.59375 0.51562,-1.8125 0,-1.15625 -0.53125,-1.75 -0.51562,-0.59375 -1.29687,-0.59375 -0.78125,0 -1.3125,0.59375 -0.51563,0.578125 -0.51563,1.78125 z m 5.98633,3.109375 V 88.1847 h 0.9375 v 0.875 q 0.29687,-0.46875 0.78125,-0.734375 0.48437,-0.28125 1.10937,-0.28125 0.6875,0 1.125,0.28125 0.45313,0.28125 0.625,0.796875 0.75,-1.078125 1.92188,-1.078125 0.9375,0 1.42187,0.515625 0.5,0.5 0.5,1.578125 v 4.265625 h -1.04687 v -3.921875 q 0,-0.625 -0.10938,-0.90625 -0.0937,-0.28125 -0.35937,-0.453125 -0.26563,-0.171875 -0.64063,-0.171875 -0.65625,0 -1.09375,0.4375 -0.42187,0.4375 -0.42187,1.40625 v 3.609375 h -1.0625 v -4.046875 q 0,-0.703125 -0.26563,-1.046875 -0.25,-0.359375 -0.82812,-0.359375 -0.45313,0 -0.82813,0.234375 -0.375,0.234375 -0.54687,0.6875 -0.17188,0.453125 -0.17188,1.296875 v 3.234375 z m 9.99609,2.390625 V 88.1847 h 0.95313 v 0.796875 q 0.34375,-0.46875 0.76562,-0.703125 0.4375,-0.234375 1.04688,-0.234375 0.79687,0 1.40625,0.40625 0.60937,0.40625 0.90625,1.15625 0.3125,0.75 0.3125,1.640625 0,0.953125 -0.34375,1.71875 -0.32813,0.765625 -0.98438,1.171875 -0.65625,0.40625 -1.375,0.40625 -0.53125,0 -0.95312,-0.21875 -0.42188,-0.234375 -0.6875,-0.5625 v 3.03125 z m 0.95313,-5.46875 q 0,1.203125 0.48437,1.78125 0.48438,0.5625 1.17188,0.5625 0.70312,0 1.20312,-0.59375 0.5,-0.59375 0.5,-1.84375 0,-1.1875 -0.48437,-1.765625 -0.48438,-0.59375 -1.17188,-0.59375 -0.67187,0 -1.1875,0.625 -0.51562,0.625 -0.51562,1.828125 z m 8.01758,2.140625 0.15625,0.921875 q -0.45313,0.09375 -0.79688,0.09375 -0.57812,0 -0.89062,-0.171875 -0.3125,-0.1875 -0.45313,-0.484375 -0.125,-0.296875 -0.125,-1.25 V 88.9972 h -0.76562 v -0.8125 h 0.76562 v -1.546875 l 1.04688,-0.625 V 88.1847 h 1.0625 v 0.8125 h -1.0625 v 3.640625 q 0,0.453125 0.0469,0.578125 0.0625,0.125 0.1875,0.203125 0.125,0.07813 0.35938,0.07813 0.1875,0 0.46875,-0.03125 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path47"
     d="m 389.18277,102.63082 h 81.85828 v 23.49606 h -81.85828 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path49"
     d="m 400.62027,123.15083 h -1.64063 v -6.21875 h 1.53125 v 0.875 q 0.39063,-0.625 0.70313,-0.8125 0.3125,-0.20313 0.70312,-0.20313 0.5625,0 1.09375,0.3125 l -0.51562,1.42188 q -0.42188,-0.26563 -0.76563,-0.26563 -0.35937,0 -0.59375,0.20313 -0.23437,0.1875 -0.375,0.6875 -0.14062,0.48437 -0.14062,2.07812 z m 6.70117,-1.98438 1.64063,0.28125 q -0.3125,0.90625 -1,1.375 -0.6875,0.46875 -1.70313,0.46875 -1.625,0 -2.40625,-1.0625 -0.625,-0.84375 -0.625,-2.14062 0,-1.54688 0.8125,-2.42188 0.8125,-0.875 2.04688,-0.875 1.39062,0 2.1875,0.92188 0.8125,0.90625 0.76562,2.79687 h -4.125 q 0.0312,0.73438 0.40625,1.14063 0.375,0.40625 0.95313,0.40625 0.375,0 0.64062,-0.20313 0.26563,-0.21875 0.40625,-0.6875 z m 0.0937,-1.65625 q -0.0156,-0.71875 -0.375,-1.09375 -0.34375,-0.375 -0.85937,-0.375 -0.53125,0 -0.89063,0.39063 -0.34375,0.40625 -0.34375,1.07812 z m 2.39258,1.85938 1.65625,-0.25 q 0.10938,0.48437 0.42188,0.73437 0.32812,0.25 0.90625,0.25 0.64062,0 0.95312,-0.23437 0.21875,-0.17188 0.21875,-0.4375 0,-0.1875 -0.10937,-0.3125 -0.125,-0.125 -0.54688,-0.21875 -2,-0.4375 -2.53125,-0.79688 -0.73437,-0.51562 -0.73437,-1.40625 0,-0.8125 0.625,-1.35937 0.64062,-0.54688 1.98437,-0.54688 1.28125,0 1.90625,0.42188 0.625,0.40625 0.85938,1.21875 l -1.5625,0.28125 q -0.0937,-0.35938 -0.375,-0.54688 -0.28125,-0.20312 -0.79688,-0.20312 -0.64062,0 -0.92187,0.1875 -0.1875,0.125 -0.1875,0.32812 0,0.1875 0.15625,0.3125 0.21875,0.15625 1.53125,0.45313 1.32812,0.29687 1.84375,0.73437 0.51562,0.4375 0.51562,1.21875 0,0.85938 -0.71875,1.48438 -0.70312,0.60937 -2.10937,0.60937 -1.26563,0 -2.01563,-0.51562 -0.73437,-0.51563 -0.96875,-1.40625 z m 7.20508,-4.4375 h 1.53125 v 0.90625 q 0.3125,-0.46875 0.8125,-0.75 0.51562,-0.29688 1.14062,-0.29688 1.07813,0 1.82813,0.84375 0.76562,0.84375 0.76562,2.375 0,1.54688 -0.76562,2.42188 -0.76563,0.85937 -1.84375,0.85937 -0.51563,0 -0.9375,-0.20312 -0.42188,-0.20313 -0.875,-0.70313 v 3.14063 h -1.65625 z m 1.625,3 q 0,1.04687 0.42187,1.54687 0.42188,0.5 1.01563,0.5 0.57812,0 0.95312,-0.45312 0.375,-0.46875 0.375,-1.51563 0,-0.96875 -0.39062,-1.4375 -0.39063,-0.48437 -0.96875,-0.48437 -0.60938,0 -1.01563,0.46875 -0.39062,0.46875 -0.39062,1.375 z m 5.37695,0.0156 q 0,-0.8125 0.40625,-1.57812 0.40625,-0.78125 1.14063,-1.17188 0.73437,-0.40625 1.65625,-0.40625 1.40625,0 2.3125,0.92188 0.90625,0.90625 0.90625,2.3125 0,1.40625 -0.92188,2.34375 -0.90625,0.92187 -2.28125,0.92187 -0.85937,0 -1.64062,-0.39062 -0.76563,-0.39063 -1.17188,-1.125 -0.40625,-0.75 -0.40625,-1.82813 z m 1.6875,0.0937 q 0,0.92188 0.4375,1.42188 0.4375,0.48437 1.07813,0.48437 0.65625,0 1.07812,-0.48437 0.4375,-0.5 0.4375,-1.4375 0,-0.90625 -0.4375,-1.39063 -0.42187,-0.5 -1.07812,-0.5 -0.64063,0 -1.07813,0.5 -0.4375,0.48438 -0.4375,1.40625 z m 11.67383,3.10938 h -1.64063 v -3.17188 q 0,-1.01562 -0.10937,-1.3125 -0.0937,-0.29687 -0.34375,-0.45312 -0.23438,-0.17188 -0.5625,-0.17188 -0.4375,0 -0.78125,0.23438 -0.32813,0.23437 -0.45313,0.625 -0.125,0.39062 -0.125,1.4375 v 2.8125 h -1.65625 v -6.21875 h 1.53125 v 0.90625 q 0.8125,-1.04688 2.0625,-1.04688 0.53125,0 0.98438,0.20313 0.45312,0.1875 0.6875,0.5 0.23437,0.29687 0.3125,0.6875 0.0937,0.375 0.0937,1.09375 z m 7.37695,0 h -1.51562 v -0.92188 q -0.39063,0.54688 -0.90625,0.8125 -0.51563,0.25 -1.04688,0.25 -1.07812,0 -1.84375,-0.85937 -0.75,-0.875 -0.75,-2.42188 0,-1.57812 0.73438,-2.39062 0.75,-0.82813 1.89062,-0.82813 1.03125,0 1.79688,0.85938 v -3.09375 h 1.64062 z m -4.39062,-3.25 q 0,1 0.28125,1.4375 0.39062,0.65625 1.10937,0.65625 0.5625,0 0.95313,-0.48438 0.40625,-0.48437 0.40625,-1.45312 0,-1.0625 -0.39063,-1.53125 -0.375,-0.48438 -0.98437,-0.48438 -0.57813,0 -0.98438,0.46875 -0.39062,0.46875 -0.39062,1.39063 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path51"
     d="m 467.37534,129.75066 -87.65356,0.12599" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-respond"
     d="m 467.37534,129.75066 -81.65356,0.11736"
     inkscape:label="#path53" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path55"
     d="m 385.7194,128.2163 -4.53571,1.65825 4.54047,1.6452 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="state-1"
     d="m 79.83723,81.90589 v 0 c 0,-3.766045 3.052986,-6.819031 6.819038,-6.819031 h 27.275312 v 0 c 1.80853,0 3.54297,0.71843 4.82179,1.997246 1.27881,1.278816 1.99725,3.013267 1.99725,4.821785 v 154.64539 c 0,3.76605 -3.05299,6.81905 -6.81904,6.81905 H 86.656268 c -3.766052,0 -6.819038,-3.053 -6.819038,-6.81905 z"
     inkscape:label="#path57" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path59"
     d="m 79.83723,81.90589 v 0 c 0,-3.766045 3.052986,-6.819031 6.819038,-6.819031 h 27.275312 v 0 c 1.80853,0 3.54297,0.71843 4.82179,1.997246 1.27881,1.278816 1.99725,3.013267 1.99725,4.821785 v 154.64539 c 0,3.76605 -3.05299,6.81905 -6.81904,6.81905 H 86.656268 c -3.766052,0 -6.819038,-3.053 -6.819038,-6.81905 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path61"
     d="m 202.15942,157.14264 h 70.99213 v 23.49606 h -70.99213 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path63"
     d="m 211.15942,177.80325 2.48437,-8.875 h 0.84375 l -2.48437,8.875 z m 8.38086,-2.14063 1.09375,0.125 q -0.25,0.95313 -0.95313,1.48438 -0.70312,0.53125 -1.78125,0.53125 -1.35937,0 -2.17187,-0.84375 -0.79688,-0.84375 -0.79688,-2.35938 0,-1.5625 0.8125,-2.42187 0.8125,-0.875 2.09375,-0.875 1.25,0 2.03125,0.84375 0.79688,0.84375 0.79688,2.39062 0,0.0937 0,0.28125 h -4.64063 q 0.0625,1.03125 0.57813,1.57813 0.51562,0.53125 1.29687,0.53125 0.57813,0 0.98438,-0.29688 0.42187,-0.3125 0.65625,-0.96875 z m -3.45313,-1.70312 h 3.46875 q -0.0625,-0.79688 -0.39062,-1.1875 -0.51563,-0.60938 -1.3125,-0.60938 -0.73438,0 -1.23438,0.48438 -0.48437,0.48437 -0.53125,1.3125 z m 5.86133,3.70312 v -6.21875 h 0.95313 v 0.9375 q 0.35937,-0.65625 0.65625,-0.85937 0.3125,-0.21875 0.6875,-0.21875 0.53125,0 1.07812,0.32812 l -0.35937,0.98438 q -0.39063,-0.23438 -0.76563,-0.23438 -0.35937,0 -0.64062,0.21875 -0.26563,0.20313 -0.375,0.57813 -0.1875,0.5625 -0.1875,1.21875 v 3.26562 z m 3.9961,0 v -6.21875 h 0.95312 v 0.9375 q 0.35938,-0.65625 0.65625,-0.85937 0.3125,-0.21875 0.6875,-0.21875 0.53125,0 1.07813,0.32812 l -0.35938,0.98438 q -0.39062,-0.23438 -0.76562,-0.23438 -0.35938,0 -0.64063,0.21875 -0.26562,0.20313 -0.375,0.57813 -0.1875,0.5625 -0.1875,1.21875 v 3.26562 z m 3.62109,-3.10937 q 0,-1.73438 0.95312,-2.5625 0.79688,-0.6875 1.95313,-0.6875 1.28125,0 2.09375,0.84375 0.82812,0.82812 0.82812,2.3125 0,1.20312 -0.35937,1.89062 -0.35938,0.6875 -1.0625,1.07813 -0.6875,0.375 -1.5,0.375 -1.29688,0 -2.10938,-0.82813 -0.79687,-0.84375 -0.79687,-2.42187 z m 1.07812,0 q 0,1.1875 0.51563,1.78125 0.53125,0.59375 1.3125,0.59375 0.79687,0 1.3125,-0.59375 0.51562,-0.59375 0.51562,-1.8125 0,-1.15625 -0.53125,-1.75 -0.51562,-0.59375 -1.29687,-0.59375 -0.78125,0 -1.3125,0.59375 -0.51563,0.57812 -0.51563,1.78125 z m 5.97071,3.10937 v -6.21875 h 0.95312 v 0.9375 q 0.35938,-0.65625 0.65625,-0.85937 0.3125,-0.21875 0.6875,-0.21875 0.53125,0 1.07813,0.32812 l -0.35938,0.98438 q -0.39062,-0.23438 -0.76562,-0.23438 -0.35938,0 -0.64063,0.21875 -0.26562,0.20313 -0.375,0.57813 -0.1875,0.5625 -0.1875,1.21875 v 3.26562 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path65"
     d="m 338.58798,156.91757 -217.63782,-0.0315" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-failure"
     d="m 338.58798,156.91757 -211.63782,-0.0306"
     inkscape:label="#path67" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path69"
     d="m 126.95041,155.23521 -4.53834,1.65108 4.53787,1.65239 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path71"
     d="m 198.3491,129.38345 h 67.84251 v 23.49606 H 198.3491 Z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path73"
     d="m 207.3491,150.04407 2.48437,-8.875 h 0.84375 l -2.48437,8.875 z m 4.38086,-0.14063 v -5.40625 h -0.9375 v -0.8125 h 0.9375 v -0.67187 q 0,-0.625 0.10937,-0.92188 0.15625,-0.42187 0.53125,-0.67187 0.39063,-0.25 1.07813,-0.25 0.45312,0 0.98437,0.10937 l -0.15625,0.90625 q -0.32812,-0.0469 -0.625,-0.0469 -0.48437,0 -0.6875,0.20312 -0.1875,0.20313 -0.1875,0.76563 v 0.57812 h 1.21875 v 0.8125 h -1.21875 v 5.40625 z m 7.14648,-0.76562 q -0.59375,0.5 -1.14062,0.70312 -0.53125,0.20313 -1.15625,0.20313 -1.03125,0 -1.57813,-0.5 -0.54687,-0.5 -0.54687,-1.28125 0,-0.45313 0.20312,-0.82813 0.20313,-0.39062 0.54688,-0.60937 0.34375,-0.23438 0.76562,-0.34375 0.29688,-0.0937 0.9375,-0.17188 1.26563,-0.14062 1.875,-0.35937 0,-0.21875 0,-0.26563 0,-0.65625 -0.29687,-0.92187 -0.40625,-0.34375 -1.20313,-0.34375 -0.73437,0 -1.09375,0.26562 -0.35937,0.25 -0.53125,0.90625 l -1.03125,-0.14062 q 0.14063,-0.65625 0.46875,-1.0625 0.32813,-0.40625 0.9375,-0.625 0.60938,-0.21875 1.40625,-0.21875 0.79688,0 1.29688,0.1875 0.5,0.1875 0.73437,0.46875 0.23438,0.28125 0.32813,0.71875 0.0469,0.26562 0.0469,0.96875 v 1.40625 q 0,1.46875 0.0625,1.85937 0.0781,0.39063 0.28125,0.75 h -1.10937 q -0.15625,-0.32812 -0.20313,-0.76562 z m -0.0937,-2.35938 q -0.57812,0.23438 -1.71875,0.40625 -0.65625,0.0937 -0.92187,0.21875 -0.26563,0.10938 -0.42188,0.32813 -0.14062,0.21875 -0.14062,0.5 0,0.42187 0.3125,0.70312 0.32812,0.28125 0.9375,0.28125 0.60937,0 1.07812,-0.26562 0.48438,-0.26563 0.70313,-0.73438 0.17187,-0.35937 0.17187,-1.04687 z m 2.70508,-4.25 v -1.21875 h 1.0625 v 1.21875 z m 0,7.375 v -6.21875 h 1.0625 v 6.21875 z m 2.63477,0 v -8.59375 h 1.0625 v 8.59375 z m 6.77539,0 v -0.92187 q -0.73438,1.0625 -1.98438,1.0625 -0.54687,0 -1.03125,-0.20313 -0.46875,-0.21875 -0.70312,-0.53125 -0.23438,-0.32812 -0.32813,-0.79687 -0.0625,-0.29688 -0.0625,-0.98438 v -3.84375 h 1.0625 v 3.45313 q 0,0.8125 0.0625,1.10937 0.0937,0.40625 0.40625,0.65625 0.32813,0.23438 0.8125,0.23438 0.46875,0 0.875,-0.23438 0.42188,-0.25 0.59375,-0.67187 0.1875,-0.42188 0.1875,-1.21875 v -3.32813 h 1.04688 v 6.21875 z m 2.58008,0 v -6.21875 h 0.95312 v 0.9375 q 0.35938,-0.65625 0.65625,-0.85937 0.3125,-0.21875 0.6875,-0.21875 0.53125,0 1.07813,0.32812 l -0.35938,0.98438 q -0.39062,-0.23438 -0.76562,-0.23438 -0.35938,0 -0.64063,0.21875 -0.26562,0.20313 -0.375,0.57813 -0.1875,0.5625 -0.1875,1.21875 v 3.26562 z m 8.26172,-2 1.09375,0.125 q -0.25,0.95313 -0.95313,1.48438 -0.70312,0.53125 -1.78125,0.53125 -1.35937,0 -2.17187,-0.84375 -0.79688,-0.84375 -0.79688,-2.35938 0,-1.5625 0.8125,-2.42187 0.8125,-0.875 2.09375,-0.875 1.25,0 2.03125,0.84375 0.79688,0.84375 0.79688,2.39062 0,0.0937 0,0.28125 h -4.64063 q 0.0625,1.03125 0.57813,1.57813 0.51562,0.53125 1.29687,0.53125 0.57813,0 0.98438,-0.29688 0.42187,-0.3125 0.65625,-0.96875 z m -3.45313,-1.70312 h 3.46875 q -0.0625,-0.79688 -0.39062,-1.1875 -0.51563,-0.60938 -1.3125,-0.60938 -0.73438,0 -1.23438,0.48438 -0.48437,0.48437 -0.53125,1.3125 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path75"
     d="m 178.32155,102.88345 h 104.88188 v 23.49606 H 178.32155 Z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path77"
     d="m 187.32155,123.54408 2.48437,-8.875 h 0.84375 l -2.48437,8.875 z m 3.70898,-2 1.03125,-0.15625 q 0.0937,0.625 0.48438,0.95312 0.40625,0.32813 1.14062,0.32813 0.71875,0 1.0625,-0.28125 0.35938,-0.29688 0.35938,-0.70313 0,-0.35937 -0.3125,-0.5625 -0.21875,-0.14062 -1.07813,-0.35937 -1.15625,-0.29688 -1.60937,-0.5 -0.4375,-0.21875 -0.67188,-0.59375 -0.23437,-0.375 -0.23437,-0.84375 0,-0.40625 0.1875,-0.76563 0.1875,-0.35937 0.51562,-0.59375 0.25,-0.17187 0.67188,-0.29687 0.42187,-0.125 0.92187,-0.125 0.71875,0 1.26563,0.21875 0.5625,0.20312 0.82812,0.5625 0.26563,0.35937 0.35938,0.95312 l -1.03125,0.14063 q -0.0625,-0.46875 -0.40625,-0.73438 -0.32813,-0.28125 -0.95313,-0.28125 -0.71875,0 -1.03125,0.25 -0.3125,0.23438 -0.3125,0.5625 0,0.20313 0.125,0.35938 0.14063,0.17187 0.40625,0.28125 0.15625,0.0625 0.9375,0.26562 1.125,0.3125 1.5625,0.5 0.4375,0.1875 0.6875,0.54688 0.25,0.35937 0.25,0.90625 0,0.53125 -0.3125,1 -0.29687,0.45312 -0.875,0.71875 -0.57812,0.25 -1.3125,0.25 -1.21875,0 -1.85937,-0.5 -0.625,-0.51563 -0.79688,-1.5 z m 10.5,1.85937 v -0.92187 q -0.73437,1.0625 -1.98437,1.0625 -0.54688,0 -1.03125,-0.20313 -0.46875,-0.21875 -0.70313,-0.53125 -0.23437,-0.32812 -0.32812,-0.79687 -0.0625,-0.29688 -0.0625,-0.98438 v -3.84375 h 1.0625 v 3.45313 q 0,0.8125 0.0625,1.10937 0.0937,0.40625 0.40625,0.65625 0.32812,0.23438 0.8125,0.23438 0.46875,0 0.875,-0.23438 0.42187,-0.25 0.59375,-0.67187 0.1875,-0.42188 0.1875,-1.21875 v -3.32813 h 1.04687 v 6.21875 z m 6.65821,-2.28125 1.03125,0.14063 q -0.17188,1.0625 -0.875,1.67187 -0.70313,0.60938 -1.71875,0.60938 -1.28125,0 -2.0625,-0.82813 -0.76563,-0.84375 -0.76563,-2.40625 0,-1 0.32813,-1.75 0.34375,-0.76562 1.01562,-1.14062 0.6875,-0.375 1.5,-0.375 1,0 1.64063,0.51562 0.65625,0.5 0.84375,1.45313 l -1.03125,0.15625 q -0.14063,-0.625 -0.51563,-0.9375 -0.375,-0.32813 -0.90625,-0.32813 -0.79687,0 -1.29687,0.57813 -0.5,0.5625 -0.5,1.79687 0,1.26563 0.48437,1.82813 0.48438,0.5625 1.25,0.5625 0.625,0 1.03125,-0.375 0.42188,-0.375 0.54688,-1.17188 z m 6,0 1.03125,0.14063 q -0.17188,1.0625 -0.875,1.67187 -0.70313,0.60938 -1.71875,0.60938 -1.28125,0 -2.0625,-0.82813 -0.76563,-0.84375 -0.76563,-2.40625 0,-1 0.32813,-1.75 0.34375,-0.76562 1.01562,-1.14062 0.6875,-0.375 1.5,-0.375 1,0 1.64063,0.51562 0.65625,0.5 0.84375,1.45313 l -1.03125,0.15625 q -0.14063,-0.625 -0.51563,-0.9375 -0.375,-0.32813 -0.90625,-0.32813 -0.79687,0 -1.29687,0.57813 -0.5,0.5625 -0.5,1.79687 0,1.26563 0.48437,1.82813 0.48438,0.5625 1.25,0.5625 0.625,0 1.03125,-0.375 0.42188,-0.375 0.54688,-1.17188 z m 6.1875,0.28125 1.09375,0.125 q -0.25,0.95313 -0.95313,1.48438 -0.70312,0.53125 -1.78125,0.53125 -1.35937,0 -2.17187,-0.84375 -0.79688,-0.84375 -0.79688,-2.35938 0,-1.5625 0.8125,-2.42187 0.8125,-0.875 2.09375,-0.875 1.25,0 2.03125,0.84375 0.79688,0.84375 0.79688,2.39062 0,0.0937 0,0.28125 h -4.64063 q 0.0625,1.03125 0.57813,1.57813 0.51562,0.53125 1.29687,0.53125 0.57813,0 0.98438,-0.29688 0.42187,-0.3125 0.65625,-0.96875 z m -3.45313,-1.70312 h 3.46875 q -0.0625,-0.79688 -0.39062,-1.1875 -0.51563,-0.60938 -1.3125,-0.60938 -0.73438,0 -1.23438,0.48438 -0.48437,0.48437 -0.53125,1.3125 z m 5.45508,1.84375 1.03125,-0.15625 q 0.0937,0.625 0.48438,0.95312 0.40625,0.32813 1.14062,0.32813 0.71875,0 1.0625,-0.28125 0.35938,-0.29688 0.35938,-0.70313 0,-0.35937 -0.3125,-0.5625 -0.21875,-0.14062 -1.07813,-0.35937 -1.15625,-0.29688 -1.60937,-0.5 -0.4375,-0.21875 -0.67188,-0.59375 -0.23437,-0.375 -0.23437,-0.84375 0,-0.40625 0.1875,-0.76563 0.1875,-0.35937 0.51562,-0.59375 0.25,-0.17187 0.67188,-0.29687 0.42187,-0.125 0.92187,-0.125 0.71875,0 1.26563,0.21875 0.5625,0.20312 0.82812,0.5625 0.26563,0.35937 0.35938,0.95312 l -1.03125,0.14063 q -0.0625,-0.46875 -0.40625,-0.73438 -0.32813,-0.28125 -0.95313,-0.28125 -0.71875,0 -1.03125,0.25 -0.3125,0.23438 -0.3125,0.5625 0,0.20313 0.125,0.35938 0.14063,0.17187 0.40625,0.28125 0.15625,0.0625 0.9375,0.26562 1.125,0.3125 1.5625,0.5 0.4375,0.1875 0.6875,0.54688 0.25,0.35937 0.25,0.90625 0,0.53125 -0.3125,1 -0.29687,0.45312 -0.875,0.71875 -0.57812,0.25 -1.3125,0.25 -1.21875,0 -1.85937,-0.5 -0.625,-0.51563 -0.79688,-1.5 z m 6,0 1.03125,-0.15625 q 0.0937,0.625 0.48438,0.95312 0.40625,0.32813 1.14062,0.32813 0.71875,0 1.0625,-0.28125 0.35938,-0.29688 0.35938,-0.70313 0,-0.35937 -0.3125,-0.5625 -0.21875,-0.14062 -1.07813,-0.35937 -1.15625,-0.29688 -1.60937,-0.5 -0.4375,-0.21875 -0.67188,-0.59375 -0.23437,-0.375 -0.23437,-0.84375 0,-0.40625 0.1875,-0.76563 0.1875,-0.35937 0.51562,-0.59375 0.25,-0.17187 0.67188,-0.29687 0.42187,-0.125 0.92187,-0.125 0.71875,0 1.26563,0.21875 0.5625,0.20312 0.82812,0.5625 0.26563,0.35937 0.35938,0.95312 l -1.03125,0.14063 q -0.0625,-0.46875 -0.40625,-0.73438 -0.32813,-0.28125 -0.95313,-0.28125 -0.71875,0 -1.03125,0.25 -0.3125,0.23438 -0.3125,0.5625 0,0.20313 0.125,0.35938 0.14063,0.17187 0.40625,0.28125 0.15625,0.0625 0.9375,0.26562 1.125,0.3125 1.5625,0.5 0.4375,0.1875 0.6875,0.54688 0.25,0.35937 0.25,0.90625 0,0.53125 -0.3125,1 -0.29687,0.45312 -0.875,0.71875 -0.57812,0.25 -1.3125,0.25 -1.21875,0 -1.85937,-0.5 -0.625,-0.51563 -0.79688,-1.5 z m 8.4375,4.39062 q -0.875,-1.10937 -1.48437,-2.57812 -0.59375,-1.48438 -0.59375,-3.0625 0,-1.39063 0.4375,-2.67188 0.53125,-1.48437 1.64062,-2.95312 h 0.75 q -0.70312,1.21875 -0.9375,1.73437 -0.35937,0.8125 -0.5625,1.6875 -0.25,1.09375 -0.25,2.20313 0,2.82812 1.75,5.64062 z m 2.23047,-2.53125 v -5.40625 h -0.9375 v -0.8125 h 0.9375 v -0.67187 q 0,-0.625 0.10937,-0.92188 0.15625,-0.42187 0.53125,-0.67187 0.39063,-0.25 1.07813,-0.25 0.45312,0 0.98437,0.10937 l -0.15625,0.90625 q -0.32812,-0.0469 -0.625,-0.0469 -0.48437,0 -0.6875,0.20312 -0.1875,0.20313 -0.1875,0.76563 v 0.57812 h 1.21875 v 0.8125 h -1.21875 v 5.40625 z m 7.14648,-0.76562 q -0.59375,0.5 -1.14062,0.70312 -0.53125,0.20313 -1.15625,0.20313 -1.03125,0 -1.57813,-0.5 -0.54687,-0.5 -0.54687,-1.28125 0,-0.45313 0.20312,-0.82813 0.20313,-0.39062 0.54688,-0.60937 0.34375,-0.23438 0.76562,-0.34375 0.29688,-0.0937 0.9375,-0.17188 1.26563,-0.14062 1.875,-0.35937 0,-0.21875 0,-0.26563 0,-0.65625 -0.29687,-0.92187 -0.40625,-0.34375 -1.20313,-0.34375 -0.73437,0 -1.09375,0.26562 -0.35937,0.25 -0.53125,0.90625 l -1.03125,-0.14062 q 0.14063,-0.65625 0.46875,-1.0625 0.32813,-0.40625 0.9375,-0.625 0.60938,-0.21875 1.40625,-0.21875 0.79688,0 1.29688,0.1875 0.5,0.1875 0.73437,0.46875 0.23438,0.28125 0.32813,0.71875 0.0469,0.26562 0.0469,0.96875 v 1.40625 q 0,1.46875 0.0625,1.85937 0.0781,0.39063 0.28125,0.75 h -1.10937 q -0.15625,-0.32812 -0.20313,-0.76562 z m -0.0937,-2.35938 q -0.57812,0.23438 -1.71875,0.40625 -0.65625,0.0937 -0.92187,0.21875 -0.26563,0.10938 -0.42188,0.32813 -0.14062,0.21875 -0.14062,0.5 0,0.42187 0.3125,0.70312 0.32812,0.28125 0.9375,0.28125 0.60937,0 1.07812,-0.26562 0.48438,-0.26563 0.70313,-0.73438 0.17187,-0.35937 0.17187,-1.04687 z m 2.67383,3.125 v -8.59375 h 1.0625 v 8.59375 z m 2.27539,-1.85937 1.03125,-0.15625 q 0.0937,0.625 0.48438,0.95312 0.40625,0.32813 1.14062,0.32813 0.71875,0 1.0625,-0.28125 0.35938,-0.29688 0.35938,-0.70313 0,-0.35937 -0.3125,-0.5625 -0.21875,-0.14062 -1.07813,-0.35937 -1.15625,-0.29688 -1.60937,-0.5 -0.4375,-0.21875 -0.67188,-0.59375 -0.23437,-0.375 -0.23437,-0.84375 0,-0.40625 0.1875,-0.76563 0.1875,-0.35937 0.51562,-0.59375 0.25,-0.17187 0.67188,-0.29687 0.42187,-0.125 0.92187,-0.125 0.71875,0 1.26563,0.21875 0.5625,0.20312 0.82812,0.5625 0.26563,0.35937 0.35938,0.95312 l -1.03125,0.14063 q -0.0625,-0.46875 -0.40625,-0.73438 -0.32813,-0.28125 -0.95313,-0.28125 -0.71875,0 -1.03125,0.25 -0.3125,0.23438 -0.3125,0.5625 0,0.20313 0.125,0.35938 0.14063,0.17187 0.40625,0.28125 0.15625,0.0625 0.9375,0.26562 1.125,0.3125 1.5625,0.5 0.4375,0.1875 0.6875,0.54688 0.24999,0.35937 0.24999,0.90625 0,0.53125 -0.31249,1 -0.29687,0.45312 -0.875,0.71875 -0.57812,0.25 -1.3125,0.25 -1.21875,0 -1.85937,-0.5 -0.625,-0.51563 -0.79688,-1.5 z m 10.67186,-0.14063 1.09375,0.125 q -0.25,0.95313 -0.95312,1.48438 -0.70313,0.53125 -1.78125,0.53125 -1.35938,0 -2.17188,-0.84375 -0.79687,-0.84375 -0.79687,-2.35938 0,-1.5625 0.8125,-2.42187 0.8125,-0.875 2.09375,-0.875 1.25,0 2.03125,0.84375 0.79687,0.84375 0.79687,2.39062 0,0.0937 0,0.28125 h -4.64062 q 0.0625,1.03125 0.57812,1.57813 0.51563,0.53125 1.29688,0.53125 0.57812,0 0.98437,-0.29688 0.42188,-0.3125 0.65625,-0.96875 z m -3.45312,-1.70312 h 3.46875 q -0.0625,-0.79688 -0.39063,-1.1875 -0.51562,-0.60938 -1.3125,-0.60938 -0.73437,0 -1.23437,0.48438 -0.48438,0.48437 -0.53125,1.3125 z m 6.56445,6.23437 h -0.75 q 1.75,-2.8125 1.75,-5.64062 0,-1.09375 -0.25,-2.1875 -0.20312,-0.875 -0.5625,-1.6875 -0.23437,-0.51563 -0.9375,-1.75 h 0.75 q 1.09375,1.46875 1.625,2.95312 0.45313,1.28125 0.45313,2.67188 0,1.57812 -0.60938,3.0625 -0.60937,1.46875 -1.46875,2.57812 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path79"
     d="M 338.06534,129.88124 H 120.96297" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-success-false"
     d="M 338.06534,129.88124 H 126.96297"
     inkscape:label="#path81" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path83"
     d="m 126.96297,128.2295 -4.53809,1.65173 4.53809,1.65172 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path85"
     d="M 338.66934,184.87952 H 120.08665" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-error"
     d="M 338.66934,184.87952 H 126.08665"
     inkscape:label="#path87" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path89"
     d="m 126.08665,183.22778 -4.53809,1.65173 4.53809,1.65174 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path91"
     d="m 206.78107,74.3782 h 70.99213 v 27.49606 h -70.99213 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path93"
     d="m 217.87482,90.570076 -1.5,-0.265625 q 0.25,-0.90625 0.85937,-1.328125 0.625,-0.4375 1.84375,-0.4375 1.09375,0 1.625,0.265625 0.54688,0.25 0.76563,0.65625 0.21875,0.390625 0.21875,1.46875 l -0.0156,1.921875 q 0,0.828125 0.0781,1.21875 0.0781,0.375 0.29687,0.828125 h -1.625 q -0.0625,-0.171875 -0.15625,-0.484375 -0.0469,-0.15625 -0.0625,-0.203125 -0.42187,0.421875 -0.90625,0.625 -0.46875,0.203125 -1.01562,0.203125 -0.96875,0 -1.53125,-0.515625 -0.54688,-0.53125 -0.54688,-1.328125 0,-0.53125 0.25,-0.9375 0.26563,-0.40625 0.71875,-0.625 0.45313,-0.234375 1.3125,-0.390625 1.14063,-0.21875 1.59375,-0.40625 v -0.15625 q 0,-0.484375 -0.23437,-0.6875 -0.23438,-0.203125 -0.89063,-0.203125 -0.4375,0 -0.6875,0.171875 -0.23437,0.171875 -0.39062,0.609375 z m 2.20312,1.34375 q -0.3125,0.09375 -1,0.25 -0.6875,0.140625 -0.90625,0.28125 -0.3125,0.234375 -0.3125,0.578125 0,0.34375 0.25,0.609375 0.26563,0.25 0.65625,0.25 0.45313,0 0.85938,-0.296875 0.29687,-0.21875 0.39062,-0.546875 0.0625,-0.203125 0.0625,-0.796875 z m 2.65821,1.203125 1.65625,-0.25 q 0.10937,0.484375 0.42187,0.734375 0.32813,0.25 0.90625,0.25 0.64063,0 0.95313,-0.234375 0.21875,-0.171875 0.21875,-0.4375 0,-0.1875 -0.10938,-0.3125 -0.125,-0.125 -0.54687,-0.21875 -2,-0.4375 -2.53125,-0.796875 -0.73438,-0.515625 -0.73438,-1.40625 0,-0.8125 0.625,-1.359375 0.64063,-0.546875 1.98438,-0.546875 1.28125,0 1.90625,0.421875 0.625,0.40625 0.85937,1.21875 l -1.5625,0.28125 q -0.0937,-0.359375 -0.375,-0.546875 -0.28125,-0.203125 -0.79687,-0.203125 -0.64063,0 -0.92188,0.1875 -0.1875,0.125 -0.1875,0.328125 0,0.1875 0.15625,0.3125 0.21875,0.15625 1.53125,0.453125 1.32813,0.296875 1.84375,0.734375 0.51563,0.4375 0.51563,1.21875 0,0.859375 -0.71875,1.484375 -0.70313,0.609375 -2.10938,0.609375 -1.26562,0 -2.01562,-0.515625 -0.73438,-0.515625 -0.96875,-1.40625 z m 7.18945,1.78125 v -8.59375 h 1.65625 v 4.5625 l 1.92188,-2.1875 h 2.03125 l -2.125,2.265625 2.28125,3.953125 h -1.78125 l -1.5625,-2.796875 -0.76563,0.796875 v 2 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path95"
     d="m 338.45297,101.63078 -217.54332,-0.0945" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-ask"
     d="m 332.45297,101.62818 -211.54332,-0.0919"
     inkscape:label="#path97" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path99"
     d="m 332.45224,103.27991 4.53882,-1.64976 -4.53739,-1.653707 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="state-4"
     d="m 193.7088,209.21298 v 0 c 0,-3.77475 3.06004,-6.83478 6.83479,-6.83478 h 27.33831 v 0 c 1.81269,0 3.55114,0.72009 4.83291,2.00186 1.28177,1.28177 2.00186,3.02022 2.00186,4.83292 v 78.83438 c 0,3.77475 -3.06002,6.83478 -6.83477,6.83478 h -27.33831 c -3.77475,0 -6.83479,-3.06003 -6.83479,-6.83478 z"
     inkscape:label="#path101" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path103"
     d="m 193.7088,209.21298 v 0 c 0,-3.77475 3.06004,-6.83478 6.83479,-6.83478 h 27.33831 v 0 c 1.81269,0 3.55114,0.72009 4.83291,2.00186 1.28177,1.28177 2.00186,3.02022 2.00186,4.83292 v 78.83438 c 0,3.77475 -3.06002,6.83478 -6.83477,6.83478 h -27.33831 c -3.77475,0 -6.83479,-3.06003 -6.83479,-6.83478 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path105"
     d="M 243.38414,192.38083 H 346.1243 v 23.49606 H 243.38414 Z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path107"
     d="m 252.38414,213.04144 2.48437,-8.875 h 0.84375 l -2.48437,8.875 z m 3.709,-2 1.03125,-0.15625 q 0.0937,0.625 0.48437,0.95312 0.40625,0.32813 1.14063,0.32813 0.71875,0 1.0625,-0.28125 0.35937,-0.29688 0.35937,-0.70313 0,-0.35937 -0.3125,-0.5625 -0.21875,-0.14062 -1.07812,-0.35937 -1.15625,-0.29688 -1.60938,-0.5 -0.4375,-0.21875 -0.67187,-0.59375 -0.23438,-0.375 -0.23438,-0.84375 0,-0.40625 0.1875,-0.76563 0.1875,-0.35937 0.51563,-0.59375 0.25,-0.17187 0.67187,-0.29687 0.42188,-0.125 0.92188,-0.125 0.71875,0 1.26562,0.21875 0.5625,0.20312 0.82813,0.5625 0.26562,0.35937 0.35937,0.95312 l -1.03125,0.14063 q -0.0625,-0.46875 -0.40625,-0.73438 -0.32812,-0.28125 -0.95312,-0.28125 -0.71875,0 -1.03125,0.25 -0.3125,0.23438 -0.3125,0.5625 0,0.20313 0.125,0.35938 0.14062,0.17187 0.40625,0.28125 0.15625,0.0625 0.9375,0.26562 1.125,0.3125 1.5625,0.5 0.4375,0.1875 0.6875,0.54688 0.25,0.35937 0.25,0.90625 0,0.53125 -0.3125,1 -0.29688,0.45312 -0.875,0.71875 -0.57813,0.25 -1.3125,0.25 -1.21875,0 -1.85938,-0.5 -0.625,-0.51563 -0.79687,-1.5 z m 10.5,1.85937 v -0.92187 q -0.73438,1.0625 -1.98438,1.0625 -0.54687,0 -1.03125,-0.20313 -0.46875,-0.21875 -0.70312,-0.53125 -0.23438,-0.32812 -0.32813,-0.79687 -0.0625,-0.29688 -0.0625,-0.98438 v -3.84375 h 1.0625 v 3.45313 q 0,0.8125 0.0625,1.10937 0.0937,0.40625 0.40625,0.65625 0.32813,0.23438 0.8125,0.23438 0.46875,0 0.875,-0.23438 0.42188,-0.25 0.59375,-0.67187 0.1875,-0.42188 0.1875,-1.21875 v -3.32813 h 1.04688 v 6.21875 z m 6.6582,-2.28125 1.03125,0.14063 q -0.17187,1.0625 -0.875,1.67187 -0.70312,0.60938 -1.71875,0.60938 -1.28125,0 -2.0625,-0.82813 -0.76562,-0.84375 -0.76562,-2.40625 0,-1 0.32812,-1.75 0.34375,-0.76562 1.01563,-1.14062 0.6875,-0.375 1.5,-0.375 1,0 1.64062,0.51562 0.65625,0.5 0.84375,1.45313 l -1.03125,0.15625 q -0.14062,-0.625 -0.51562,-0.9375 -0.375,-0.32813 -0.90625,-0.32813 -0.79688,0 -1.29688,0.57813 -0.5,0.5625 -0.5,1.79687 0,1.26563 0.48438,1.82813 0.48437,0.5625 1.25,0.5625 0.625,0 1.03125,-0.375 0.42187,-0.375 0.54687,-1.17188 z m 6,0 1.03125,0.14063 q -0.17187,1.0625 -0.875,1.67187 -0.70312,0.60938 -1.71875,0.60938 -1.28125,0 -2.0625,-0.82813 -0.76562,-0.84375 -0.76562,-2.40625 0,-1 0.32812,-1.75 0.34375,-0.76562 1.01563,-1.14062 0.6875,-0.375 1.5,-0.375 1,0 1.64062,0.51562 0.65625,0.5 0.84375,1.45313 l -1.03125,0.15625 q -0.14062,-0.625 -0.51562,-0.9375 -0.375,-0.32813 -0.90625,-0.32813 -0.79688,0 -1.29688,0.57813 -0.5,0.5625 -0.5,1.79687 0,1.26563 0.48438,1.82813 0.48437,0.5625 1.25,0.5625 0.625,0 1.03125,-0.375 0.42187,-0.375 0.54687,-1.17188 z m 6.1875,0.28125 1.09375,0.125 q -0.25,0.95313 -0.95312,1.48438 -0.70313,0.53125 -1.78125,0.53125 -1.35938,0 -2.17188,-0.84375 -0.79687,-0.84375 -0.79687,-2.35938 0,-1.5625 0.8125,-2.42187 0.8125,-0.875 2.09375,-0.875 1.25,0 2.03125,0.84375 0.79687,0.84375 0.79687,2.39062 0,0.0937 0,0.28125 h -4.64062 q 0.0625,1.03125 0.57812,1.57813 0.51563,0.53125 1.29688,0.53125 0.57812,0 0.98437,-0.29688 0.42188,-0.3125 0.65625,-0.96875 z m -3.45312,-1.70312 h 3.46875 q -0.0625,-0.79688 -0.39063,-1.1875 -0.51562,-0.60938 -1.3125,-0.60938 -0.73437,0 -1.23437,0.48438 -0.48438,0.48437 -0.53125,1.3125 z m 5.45508,1.84375 1.03125,-0.15625 q 0.0937,0.625 0.48437,0.95312 0.40625,0.32813 1.14063,0.32813 0.71875,0 1.0625,-0.28125 0.35937,-0.29688 0.35937,-0.70313 0,-0.35937 -0.3125,-0.5625 -0.21875,-0.14062 -1.07812,-0.35937 -1.15625,-0.29688 -1.60938,-0.5 -0.4375,-0.21875 -0.67187,-0.59375 -0.23438,-0.375 -0.23438,-0.84375 0,-0.40625 0.1875,-0.76563 0.1875,-0.35937 0.51563,-0.59375 0.25,-0.17187 0.67187,-0.29687 0.42188,-0.125 0.92188,-0.125 0.71875,0 1.26562,0.21875 0.5625,0.20312 0.82813,0.5625 0.26562,0.35937 0.35937,0.95312 l -1.03125,0.14063 q -0.0625,-0.46875 -0.40625,-0.73438 -0.32812,-0.28125 -0.95312,-0.28125 -0.71875,0 -1.03125,0.25 -0.3125,0.23438 -0.3125,0.5625 0,0.20313 0.125,0.35938 0.14062,0.17187 0.40625,0.28125 0.15625,0.0625 0.9375,0.26562 1.125,0.3125 1.5625,0.5 0.4375,0.1875 0.6875,0.54688 0.25,0.35937 0.25,0.90625 0,0.53125 -0.3125,1 -0.29688,0.45312 -0.875,0.71875 -0.57813,0.25 -1.3125,0.25 -1.21875,0 -1.85938,-0.5 -0.625,-0.51563 -0.79687,-1.5 z m 6,0 1.03125,-0.15625 q 0.0937,0.625 0.48437,0.95312 0.40625,0.32813 1.14063,0.32813 0.71875,0 1.0625,-0.28125 0.35937,-0.29688 0.35937,-0.70313 0,-0.35937 -0.3125,-0.5625 -0.21875,-0.14062 -1.07812,-0.35937 -1.15625,-0.29688 -1.60938,-0.5 -0.4375,-0.21875 -0.67187,-0.59375 -0.23438,-0.375 -0.23438,-0.84375 0,-0.40625 0.1875,-0.76563 0.1875,-0.35937 0.51563,-0.59375 0.25,-0.17187 0.67187,-0.29687 0.42188,-0.125 0.92188,-0.125 0.71875,0 1.26562,0.21875 0.5625,0.20312 0.82813,0.5625 0.26562,0.35937 0.35937,0.95312 l -1.03125,0.14063 q -0.0625,-0.46875 -0.40625,-0.73438 -0.32812,-0.28125 -0.95312,-0.28125 -0.71875,0 -1.03125,0.25 -0.3125,0.23438 -0.3125,0.5625 0,0.20313 0.125,0.35938 0.14062,0.17187 0.40625,0.28125 0.15625,0.0625 0.9375,0.26562 1.125,0.3125 1.5625,0.5 0.4375,0.1875 0.6875,0.54688 0.25,0.35937 0.25,0.90625 0,0.53125 -0.3125,1 -0.29688,0.45312 -0.875,0.71875 -0.57813,0.25 -1.3125,0.25 -1.21875,0 -1.85938,-0.5 -0.625,-0.51563 -0.79687,-1.5 z m 8.4375,4.39062 q -0.875,-1.10937 -1.48438,-2.57812 -0.59375,-1.48438 -0.59375,-3.0625 0,-1.39063 0.4375,-2.67188 0.53125,-1.48437 1.64063,-2.95312 h 0.75 q -0.70313,1.21875 -0.9375,1.73437 -0.35938,0.8125 -0.5625,1.6875 -0.25,1.09375 -0.25,2.20313 0,2.82812 1.75,5.64062 z m 4.27734,-3.46875 0.15625,0.92188 q -0.45313,0.0937 -0.79688,0.0937 -0.57812,0 -0.89062,-0.17188 -0.3125,-0.1875 -0.45313,-0.48437 -0.125,-0.29688 -0.125,-1.25 v -3.57813 h -0.76562 v -0.8125 h 0.76562 v -1.54687 l 1.04688,-0.625 v 2.17187 h 1.0625 v 0.8125 h -1.0625 v 3.64063 q 0,0.45312 0.0469,0.57812 0.0625,0.125 0.1875,0.20313 0.125,0.0781 0.35938,0.0781 0.1875,0 0.46875,-0.0312 z m 1.02148,0.9375 v -6.21875 h 0.95313 v 0.9375 q 0.35937,-0.65625 0.65625,-0.85937 0.3125,-0.21875 0.6875,-0.21875 0.53125,0 1.07812,0.32812 l -0.35937,0.98438 q -0.39063,-0.23438 -0.76563,-0.23438 -0.35937,0 -0.64062,0.21875 -0.26563,0.20313 -0.375,0.57813 -0.1875,0.5625 -0.1875,1.21875 v 3.26562 z m 8.08985,0 v -0.92187 q -0.73438,1.0625 -1.98438,1.0625 -0.54687,0 -1.03125,-0.20313 -0.46875,-0.21875 -0.70312,-0.53125 -0.23438,-0.32812 -0.32813,-0.79687 -0.0625,-0.29688 -0.0625,-0.98438 v -3.84375 h 1.0625 v 3.45313 q 0,0.8125 0.0625,1.10937 0.0937,0.40625 0.40625,0.65625 0.32813,0.23438 0.8125,0.23438 0.46875,0 0.875,-0.23438 0.42188,-0.25 0.59375,-0.67187 0.1875,-0.42188 0.1875,-1.21875 v -3.32813 h 1.04688 v 6.21875 z m 6.8457,-2 1.09375,0.125 q -0.25,0.95313 -0.95312,1.48438 -0.70313,0.53125 -1.78125,0.53125 -1.35938,0 -2.17188,-0.84375 -0.79687,-0.84375 -0.79687,-2.35938 0,-1.5625 0.8125,-2.42187 0.8125,-0.875 2.09375,-0.875 1.25,0 2.03125,0.84375 0.79687,0.84375 0.79687,2.39062 0,0.0937 0,0.28125 h -4.64062 q 0.0625,1.03125 0.57812,1.57813 0.51563,0.53125 1.29688,0.53125 0.57812,0 0.98437,-0.29688 0.42188,-0.3125 0.65625,-0.96875 z m -3.45312,-1.70312 h 3.46875 q -0.0625,-0.79688 -0.39063,-1.1875 -0.51562,-0.60938 -1.3125,-0.60938 -0.73437,0 -1.23437,0.48438 -0.48438,0.48437 -0.53125,1.3125 z m 6.56445,6.23437 h -0.75 q 1.75,-2.8125 1.75,-5.64062 0,-1.09375 -0.25,-2.1875 -0.20313,-0.875 -0.5625,-1.6875 -0.23438,-0.51563 -0.9375,-1.75 h 0.75 q 1.09375,1.46875 1.625,2.95312 0.45312,1.28125 0.45312,2.67188 0,1.57812 -0.60937,3.0625 -0.60938,1.46875 -1.46875,2.57812 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path109"
     d="M 338.557,220.3791 H 234.99795" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-success-true"
     d="M 338.557,220.3791 H 240.99795"
     inkscape:label="#path111" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path113"
     d="m 240.99796,218.72737 -4.5381,1.65173 4.5381,1.65174 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path115"
     d="m 264.05698,221.6883 h 64.28348 v 23.49606 h -64.28348 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path117"
     d="m 279.5726,242.2083 h -1.64062 v -3.17188 q 0,-1.01562 -0.10938,-1.3125 -0.0937,-0.29687 -0.34375,-0.45312 -0.23437,-0.17188 -0.5625,-0.17188 -0.4375,0 -0.78125,0.23438 -0.32812,0.23437 -0.45312,0.625 -0.125,0.39062 -0.125,1.4375 v 2.8125 h -1.65625 v -6.21875 h 1.53125 v 0.90625 q 0.8125,-1.04688 2.0625,-1.04688 0.53125,0 0.98437,0.20313 0.45313,0.1875 0.6875,0.5 0.23438,0.29687 0.3125,0.6875 0.0937,0.375 0.0937,1.09375 z m 5.2832,-1.98438 1.64063,0.28125 q -0.3125,0.90625 -1,1.375 -0.6875,0.46875 -1.70313,0.46875 -1.625,0 -2.40625,-1.0625 -0.625,-0.84375 -0.625,-2.14062 0,-1.54688 0.8125,-2.42188 0.8125,-0.875 2.04688,-0.875 1.39062,0 2.1875,0.92188 0.8125,0.90625 0.76562,2.79687 h -4.125 q 0.0312,0.73438 0.40625,1.14063 0.375,0.40625 0.95313,0.40625 0.375,0 0.64062,-0.20313 0.26563,-0.21875 0.40625,-0.6875 z m 0.0937,-1.65625 q -0.0156,-0.71875 -0.375,-1.09375 -0.34375,-0.375 -0.85937,-0.375 -0.53125,0 -0.89063,0.39063 -0.34375,0.40625 -0.34375,1.07812 z m 2.18946,3.64063 2.23437,-3.20313 -2.14062,-3.01562 h 2 l 1.10937,1.70312 1.15625,-1.70312 h 1.9375 l -2.10937,2.9375 2.29687,3.28125 h -2.01562 l -1.26563,-1.92188 -1.28125,1.92188 z m 10.31445,-6.21875 v 1.3125 h -1.125 v 2.5 q 0,0.76562 0.0312,0.89062 0.0312,0.125 0.14062,0.21875 0.125,0.0781 0.28125,0.0781 0.23438,0 0.65625,-0.17188 l 0.14063,1.28125 q -0.5625,0.25 -1.29688,0.25 -0.4375,0 -0.79687,-0.14062 -0.35938,-0.15625 -0.53125,-0.39063 -0.15625,-0.25 -0.23438,-0.64062 -0.0469,-0.29688 -0.0469,-1.17188 v -2.70312 h -0.75 v -1.3125 h 0.75 v -1.23438 l 1.65625,-0.96875 v 2.20313 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path119"
     d="M 337.9245,249.08253 H 234.61742" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-next"
     d="M 331.9245,249.08253 H 234.61742"
     inkscape:label="#path121" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path123"
     d="m 331.9245,250.73427 4.53809,-1.65173 -4.53809,-1.65174 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path125"
     d="m 126.02627,191.99237 h 104.88189 v 23.49606 H 126.02627 Z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path127"
     d="m 135.30751,210.73112 1.65625,-0.25 q 0.10937,0.48437 0.42187,0.73437 0.32813,0.25 0.90625,0.25 0.64063,0 0.95313,-0.23437 0.21875,-0.17188 0.21875,-0.4375 0,-0.1875 -0.10938,-0.3125 -0.125,-0.125 -0.54687,-0.21875 -2,-0.4375 -2.53125,-0.79688 -0.73438,-0.51562 -0.73438,-1.40625 0,-0.8125 0.625,-1.35937 0.64063,-0.54688 1.98438,-0.54688 1.28125,0 1.90625,0.42188 0.625,0.40625 0.85937,1.21875 l -1.5625,0.28125 q -0.0937,-0.35938 -0.375,-0.54688 -0.28125,-0.20312 -0.79687,-0.20312 -0.64063,0 -0.92188,0.1875 -0.1875,0.125 -0.1875,0.32812 0,0.1875 0.15625,0.3125 0.21875,0.15625 1.53125,0.45313 1.32813,0.29687 1.84375,0.73437 0.51563,0.4375 0.51563,1.21875 0,0.85938 -0.71875,1.48438 -0.70313,0.60937 -2.10938,0.60937 -1.26562,0 -2.01562,-0.51562 -0.73438,-0.51563 -0.96875,-1.40625 z m 10.11133,-4.4375 v 1.3125 h -1.125 v 2.5 q 0,0.76562 0.0312,0.89062 0.0312,0.125 0.14062,0.21875 0.125,0.0781 0.28125,0.0781 0.23438,0 0.65625,-0.17188 l 0.14063,1.28125 q -0.5625,0.25 -1.29688,0.25 -0.4375,0 -0.79687,-0.14062 -0.35938,-0.15625 -0.53125,-0.39063 -0.15625,-0.25 -0.23438,-0.64062 -0.0469,-0.29688 -0.0469,-1.17188 v -2.70312 h -0.75 v -1.3125 h 0.75 v -1.23438 l 1.65625,-0.96875 v 2.20313 z m 0.76172,3.01562 q 0,-0.8125 0.40625,-1.57812 0.40625,-0.78125 1.14062,-1.17188 0.73438,-0.40625 1.65625,-0.40625 1.40625,0 2.3125,0.92188 0.90625,0.90625 0.90625,2.3125 0,1.40625 -0.92187,2.34375 -0.90625,0.92187 -2.28125,0.92187 -0.85938,0 -1.64063,-0.39062 -0.76562,-0.39063 -1.17187,-1.125 -0.40625,-0.75 -0.40625,-1.82813 z m 1.6875,0.0937 q 0,0.92188 0.4375,1.42188 0.4375,0.48437 1.07812,0.48437 0.65625,0 1.07813,-0.48437 0.4375,-0.5 0.4375,-1.4375 0,-0.90625 -0.4375,-1.39063 -0.42188,-0.5 -1.07813,-0.5 -0.64062,0 -1.07812,0.5 -0.4375,0.48438 -0.4375,1.40625 z m 5.9707,-3.10937 h 1.53125 v 0.90625 q 0.3125,-0.46875 0.8125,-0.75 0.51562,-0.29688 1.14062,-0.29688 1.07813,0 1.82813,0.84375 0.76562,0.84375 0.76562,2.375 0,1.54688 -0.76562,2.42188 -0.76563,0.85937 -1.84375,0.85937 -0.51563,0 -0.9375,-0.20312 -0.42188,-0.20313 -0.875,-0.70313 v 3.14063 h -1.65625 z m 1.625,3 q 0,1.04687 0.42187,1.54687 0.42188,0.5 1.01563,0.5 0.57812,0 0.95312,-0.45312 0.375,-0.46875 0.375,-1.51563 0,-0.96875 -0.39062,-1.4375 -0.39063,-0.48437 -0.96875,-0.48437 -0.60938,0 -1.01563,0.46875 -0.39062,0.46875 -0.39062,1.375 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path129"
     d="m 160.35634,212.653 2.48437,-8.875 h 0.84375 l -2.48437,8.875 z m 3.70898,-2 1.03125,-0.15625 q 0.0937,0.625 0.48438,0.95312 0.40625,0.32813 1.14062,0.32813 0.71875,0 1.0625,-0.28125 0.35938,-0.29688 0.35938,-0.70313 0,-0.35937 -0.3125,-0.5625 -0.21875,-0.14062 -1.07813,-0.35937 -1.15625,-0.29688 -1.60937,-0.5 -0.4375,-0.21875 -0.67188,-0.59375 -0.23437,-0.375 -0.23437,-0.84375 0,-0.40625 0.1875,-0.76563 0.1875,-0.35937 0.51562,-0.59375 0.25,-0.17187 0.67188,-0.29687 0.42187,-0.125 0.92187,-0.125 0.71875,0 1.26563,0.21875 0.5625,0.20312 0.82812,0.5625 0.26563,0.35937 0.35938,0.95312 l -1.03125,0.14063 q -0.0625,-0.46875 -0.40625,-0.73438 -0.32813,-0.28125 -0.95313,-0.28125 -0.71875,0 -1.03125,0.25 -0.3125,0.23438 -0.3125,0.5625 0,0.20313 0.125,0.35938 0.14063,0.17187 0.40625,0.28125 0.15625,0.0625 0.9375,0.26562 1.125,0.3125 1.5625,0.5 0.4375,0.1875 0.6875,0.54688 0.25,0.35937 0.25,0.90625 0,0.53125 -0.3125,1 -0.29687,0.45312 -0.875,0.71875 -0.57812,0.25 -1.3125,0.25 -1.21875,0 -1.85937,-0.5 -0.625,-0.51563 -0.79688,-1.5 z m 8.71875,0.92187 0.15625,0.92188 q -0.45312,0.0937 -0.79687,0.0937 -0.57813,0 -0.89063,-0.17188 -0.3125,-0.1875 -0.45312,-0.48437 -0.125,-0.29688 -0.125,-1.25 v -3.57813 h -0.76563 v -0.8125 h 0.76563 v -1.54687 l 1.04687,-0.625 v 2.17187 h 1.0625 v 0.8125 h -1.0625 v 3.64063 q 0,0.45312 0.0469,0.57812 0.0625,0.125 0.1875,0.20313 0.125,0.0781 0.35937,0.0781 0.1875,0 0.46875,-0.0312 z m 0.64649,-2.17187 q 0,-1.73438 0.95312,-2.5625 0.79688,-0.6875 1.95313,-0.6875 1.28125,0 2.09375,0.84375 0.82812,0.82812 0.82812,2.3125 0,1.20312 -0.35937,1.89062 -0.35938,0.6875 -1.0625,1.07813 -0.6875,0.375 -1.5,0.375 -1.29688,0 -2.10938,-0.82813 -0.79687,-0.84375 -0.79687,-2.42187 z m 1.07812,0 q 0,1.1875 0.51563,1.78125 0.53125,0.59375 1.3125,0.59375 0.79687,0 1.3125,-0.59375 0.51562,-0.59375 0.51562,-1.8125 0,-1.15625 -0.53125,-1.75 -0.51562,-0.59375 -1.29687,-0.59375 -0.78125,0 -1.3125,0.59375 -0.51563,0.57812 -0.51563,1.78125 z m 5.98633,5.5 v -8.60938 h 0.95313 v 0.79688 q 0.34375,-0.46875 0.76562,-0.70313 0.4375,-0.23437 1.04688,-0.23437 0.79687,0 1.40625,0.40625 0.60937,0.40625 0.90625,1.15625 0.3125,0.75 0.3125,1.64062 0,0.95313 -0.34375,1.71875 -0.32813,0.76563 -0.98438,1.17188 -0.65625,0.40625 -1.375,0.40625 -0.53125,0 -0.95312,-0.21875 -0.42188,-0.23438 -0.6875,-0.5625 v 3.03125 z m 0.95313,-5.46875 q 0,1.20312 0.48437,1.78125 0.48438,0.5625 1.17188,0.5625 0.70312,0 1.20312,-0.59375 0.5,-0.59375 0.5,-1.84375 0,-1.1875 -0.48437,-1.76563 -0.48438,-0.59375 -1.17188,-0.59375 -0.67187,0 -1.1875,0.625 -0.51562,0.625 -0.51562,1.82813 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path131"
     d="M 193.07877,220.77321 H 121.14176" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-stop"
     d="M 193.07877,220.77321 H 127.14176"
     inkscape:label="#path133" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path135"
     d="m 127.14175,219.12148 -4.5381,1.65173 4.5381,1.65174 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path137"
     d="m 589.5729,169.03986 v 0 c 0,-6.48827 5.14697,-11.74803 11.49603,-11.74803 v 0 c 3.04895,0 5.97303,1.23773 8.12897,3.44092 2.15594,2.20318 3.36713,5.19134 3.36713,8.30711 v 0 c 0,6.48825 -5.14698,11.74803 -11.4961,11.74803 v 0 c -6.34906,0 -11.49603,-5.25978 -11.49603,-11.74803 z" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path139"
     d="m 589.5729,169.03986 v 0 c 0,-6.48827 5.14697,-11.74803 11.49603,-11.74803 v 0 c 3.04895,0 5.97303,1.23773 8.12897,3.44092 2.15594,2.20318 3.36713,5.19134 3.36713,8.30711 v 0 c 0,6.48825 -5.14698,11.74803 -11.4961,11.74803 v 0 c -6.34906,0 -11.49603,-5.25978 -11.49603,-11.74803 z" />
  <path
     style="fill:#000000;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path141"
     d="m 594.78467,169.0233 v 0 c 0,-3.60072 2.91895,-6.51968 6.51965,-6.51968 v 0 c 1.72913,0 3.38745,0.6869 4.61011,1.90957 1.22272,1.22267 1.90961,2.88098 1.90961,4.61011 v 0 c 0,3.60072 -2.91895,6.5197 -6.51972,6.5197 v 0 c -3.6007,0 -6.51965,-2.91898 -6.51965,-6.5197 z" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path143"
     d="m 594.78467,169.0233 v 0 c 0,-3.60072 2.91895,-6.51968 6.51965,-6.51968 v 0 c 1.72913,0 3.38745,0.6869 4.61011,1.90957 1.22272,1.22267 1.90961,2.88098 1.90961,4.61011 v 0 c 0,3.60072 -2.91895,6.5197 -6.51972,6.5197 v 0 c -3.6007,0 -6.51965,-2.91898 -6.51965,-6.5197 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path145"
     d="m 520.7664,169.03937 h 68.81891" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-exit"
     d="m 520.7664,169.03937 h 62.81891"
     inkscape:label="#path147" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path149"
     d="m 583.5853,170.6911 4.53809,-1.65173 -4.53809,-1.65174 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path151"
     d="m 521.40686,141.03394 h 77.82678 v 36 h -77.82678 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path153"
     d="m 534.8756,159.56956 1.64062,0.28125 q -0.3125,0.90625 -1,1.375 -0.6875,0.46875 -1.70312,0.46875 -1.625,0 -2.40625,-1.0625 -0.625,-0.84375 -0.625,-2.14063 0,-1.54687 0.8125,-2.42187 0.8125,-0.875 2.04687,-0.875 1.39063,0 2.1875,0.92187 0.8125,0.90625 0.76563,2.79688 h -4.125 q 0.0312,0.73437 0.40625,1.14062 0.375,0.40625 0.95312,0.40625 0.375,0 0.64063,-0.20312 0.26562,-0.21875 0.40625,-0.6875 z m 0.0937,-1.65625 q -0.0156,-0.71875 -0.375,-1.09375 -0.34375,-0.375 -0.85938,-0.375 -0.53125,0 -0.89062,0.39062 -0.34375,0.40625 -0.34375,1.07813 z m 2.18945,3.64062 2.23438,-3.20312 -2.14063,-3.01563 h 2 l 1.10938,1.70313 1.15625,-1.70313 h 1.9375 l -2.10938,2.9375 2.29688,3.28125 h -2.01563 l -1.26562,-1.92187 -1.28125,1.92187 z m 7.45508,-7.0625 v -1.53125 h 1.65625 v 1.53125 z m 0,7.0625 v -6.21875 h 1.65625 v 6.21875 z m 6.19336,-6.21875 v 1.3125 h -1.125 v 2.5 q 0,0.76563 0.0312,0.89063 0.0312,0.125 0.14063,0.21875 0.125,0.0781 0.28125,0.0781 0.23437,0 0.65625,-0.17187 l 0.14062,1.28125 q -0.5625,0.25 -1.29687,0.25 -0.4375,0 -0.79688,-0.14063 -0.35937,-0.15625 -0.53125,-0.39062 -0.15625,-0.25 -0.23437,-0.64063 -0.0469,-0.29687 -0.0469,-1.17187 v -2.70313 h -0.75 v -1.3125 h 0.75 v -1.23437 l 1.65625,-0.96875 v 2.20312 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path155"
     d="m 551.0846,161.69456 2.48438,-8.875 h 0.84375 l -2.48438,8.875 z m 8.38086,-2.14063 1.09375,0.125 q -0.25,0.95313 -0.95313,1.48438 -0.70312,0.53125 -1.78125,0.53125 -1.35937,0 -2.17187,-0.84375 -0.79688,-0.84375 -0.79688,-2.35938 0,-1.5625 0.8125,-2.42187 0.8125,-0.875 2.09375,-0.875 1.25,0 2.03125,0.84375 0.79688,0.84375 0.79688,2.39062 0,0.0937 0,0.28125 h -4.64063 q 0.0625,1.03125 0.57813,1.57813 0.51562,0.53125 1.29687,0.53125 0.57813,0 0.98438,-0.29688 0.42187,-0.3125 0.65625,-0.96875 z m -3.45313,-1.70312 h 3.46875 q -0.0625,-0.79688 -0.39062,-1.1875 -0.51563,-0.60938 -1.3125,-0.60938 -0.73438,0 -1.23438,0.48438 -0.48437,0.48437 -0.53125,1.3125 z m 5.17383,3.70312 2.26563,-3.23437 -2.09375,-2.98438 h 1.3125 l 0.95312,1.45313 q 0.26563,0.42187 0.4375,0.70312 0.25,-0.39062 0.46875,-0.6875 l 1.04688,-1.46875 h 1.26562 l -2.15625,2.92188 2.3125,3.29687 h -1.28125 l -1.28125,-1.9375 -0.34375,-0.51562 -1.64062,2.45312 z m 6.70313,-7.375 v -1.21875 h 1.0625 v 1.21875 z m 0,7.375 v -6.21875 h 1.0625 v 6.21875 z m 4.96289,-0.9375 0.15625,0.92188 q -0.45313,0.0937 -0.79688,0.0937 -0.57812,0 -0.89062,-0.17188 -0.3125,-0.1875 -0.45313,-0.48437 -0.125,-0.29688 -0.125,-1.25 v -3.57813 h -0.76562 v -0.8125 h 0.76562 v -1.54687 l 1.04688,-0.625 v 2.17187 h 1.0625 v 0.8125 h -1.0625 v 3.64063 q 0,0.45312 0.0469,0.57812 0.0625,0.125 0.1875,0.20313 0.125,0.0781 0.35938,0.0781 0.1875,0 0.46875,-0.0312 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path157"
     d="m 100.41991,30.740404 -0.12598,44.34646" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="d-abort"
     d="m 100.41991,30.740404 -0.10893,38.34648"
     inkscape:label="#path159" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path161"
     d="m 98.65924,69.08219 1.63883,4.54277 1.66462,-4.533386 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path163"
     d="m 96.91599,32.484493 h 86.01575 V 59.980556 H 96.91599 Z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path165"
     d="m 108.00974,48.67637 -1.5,-0.265625 q 0.25,-0.90625 0.85937,-1.328125 0.625,-0.4375 1.84375,-0.4375 1.09375,0 1.625,0.265625 0.54688,0.25 0.76563,0.65625 0.21875,0.390625 0.21875,1.46875 l -0.0156,1.921875 q 0,0.828125 0.0781,1.21875 0.0781,0.375 0.29687,0.828125 h -1.625 q -0.0625,-0.171875 -0.15625,-0.484375 -0.0469,-0.15625 -0.0625,-0.203125 -0.42187,0.421875 -0.90625,0.625 -0.46875,0.203125 -1.01562,0.203125 -0.96875,0 -1.53125,-0.515625 -0.54688,-0.53125 -0.54688,-1.328125 0,-0.53125 0.25,-0.9375 0.26563,-0.40625 0.71875,-0.625 0.45313,-0.234375 1.3125,-0.390625 1.14063,-0.21875 1.59375,-0.40625 v -0.15625 q 0,-0.484375 -0.23437,-0.6875 -0.23438,-0.203125 -0.89063,-0.203125 -0.4375,0 -0.6875,0.171875 -0.23437,0.171875 -0.39062,0.609375 z m 2.20312,1.34375 q -0.3125,0.09375 -1,0.25 -0.6875,0.140625 -0.90625,0.28125 -0.3125,0.234375 -0.3125,0.578125 0,0.34375 0.25,0.609375 0.26563,0.25 0.65625,0.25 0.45313,0 0.85938,-0.296875 0.29687,-0.21875 0.39062,-0.546875 0.0625,-0.203125 0.0625,-0.796875 z m 3.17383,2.984375 v -8.59375 h 1.64063 v 3.09375 q 0.76562,-0.859375 1.8125,-0.859375 1.125,0 1.875,0.828125 0.75,0.8125 0.75,2.359375 0,1.59375 -0.76563,2.453125 -0.76562,0.859375 -1.84375,0.859375 -0.53125,0 -1.04687,-0.265625 -0.51563,-0.265625 -0.89063,-0.796875 v 0.921875 z m 1.625,-3.25 q 0,0.96875 0.3125,1.4375 0.42188,0.65625 1.14063,0.65625 0.53125,0 0.92187,-0.46875 0.39063,-0.46875 0.39063,-1.46875 0,-1.0625 -0.39063,-1.53125 -0.39062,-0.484375 -1,-0.484375 -0.57812,0 -0.98437,0.46875 -0.39063,0.453125 -0.39063,1.390625 z m 5.39258,0.04687 q 0,-0.8125 0.40625,-1.578125 0.40625,-0.78125 1.14063,-1.171875 0.73437,-0.40625 1.65625,-0.40625 1.40625,0 2.3125,0.921875 0.90625,0.90625 0.90625,2.3125 0,1.40625 -0.92188,2.34375 -0.90625,0.921875 -2.28125,0.921875 -0.85937,0 -1.64062,-0.390625 -0.76563,-0.390625 -1.17188,-1.125 -0.40625,-0.75 -0.40625,-1.828125 z m 1.6875,0.09375 q 0,0.921875 0.4375,1.421875 0.4375,0.484375 1.07813,0.484375 0.65625,0 1.07812,-0.484375 0.4375,-0.5 0.4375,-1.4375 0,-0.90625 -0.4375,-1.390625 -0.42187,-0.5 -1.07812,-0.5 -0.64063,0 -1.07813,0.5 -0.4375,0.484375 -0.4375,1.40625 z m 7.59571,3.109375 h -1.64062 v -6.21875 h 1.53125 v 0.875 q 0.39062,-0.625 0.70312,-0.8125 0.3125,-0.203125 0.70313,-0.203125 0.5625,0 1.09375,0.3125 l -0.51563,1.421875 q -0.42187,-0.265625 -0.76562,-0.265625 -0.35938,0 -0.59375,0.203125 -0.23438,0.1875 -0.375,0.6875 -0.14063,0.484375 -0.14063,2.078125 z m 5.95117,-6.21875 v 1.3125 h -1.125 v 2.5 q 0,0.765625 0.0312,0.890625 0.0312,0.125 0.14063,0.21875 0.125,0.07813 0.28125,0.07813 0.23437,0 0.65625,-0.171875 l 0.14062,1.28125 q -0.5625,0.25 -1.29687,0.25 -0.4375,0 -0.79688,-0.140625 -0.35937,-0.15625 -0.53125,-0.390625 -0.15625,-0.25 -0.23437,-0.640625 -0.0469,-0.296875 -0.0469,-1.171875 v -2.703125 h -0.75 v -1.3125 h 0.75 V 45.55137 l 1.65625,-0.96875 v 2.203125 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path167"
     d="m 135.916,53.14512 2.48437,-8.875 h 0.84375 l -2.48437,8.875 z m 8.19336,-0.90625 q -0.59375,0.5 -1.14063,0.703125 -0.53125,0.203125 -1.15625,0.203125 -1.03125,0 -1.57812,-0.5 -0.54688,-0.5 -0.54688,-1.28125 0,-0.453125 0.20313,-0.828125 0.20312,-0.390625 0.54687,-0.609375 0.34375,-0.234375 0.76563,-0.34375 0.29687,-0.09375 0.9375,-0.171875 1.26562,-0.140625 1.875,-0.359375 0,-0.21875 0,-0.265625 0,-0.65625 -0.29688,-0.921875 -0.40625,-0.34375 -1.20312,-0.34375 -0.73438,0 -1.09375,0.265625 -0.35938,0.25 -0.53125,0.90625 l -1.03125,-0.140625 q 0.14062,-0.65625 0.46875,-1.0625 0.32812,-0.40625 0.9375,-0.625 0.60937,-0.21875 1.40625,-0.21875 0.79687,0 1.29687,0.1875 0.5,0.1875 0.73438,0.46875 0.23437,0.28125 0.32812,0.71875 0.0469,0.265625 0.0469,0.96875 v 1.40625 q 0,1.46875 0.0625,1.859375 0.0781,0.390625 0.28125,0.75 h -1.10938 q -0.15625,-0.328125 -0.20312,-0.765625 z m -0.0937,-2.359375 q -0.57813,0.234375 -1.71875,0.40625 -0.65625,0.09375 -0.92188,0.21875 -0.26562,0.109375 -0.42187,0.328125 -0.14063,0.21875 -0.14063,0.5 0,0.421875 0.3125,0.703125 0.32813,0.28125 0.9375,0.28125 0.60938,0 1.07813,-0.265625 0.48437,-0.265625 0.70312,-0.734375 0.17188,-0.359375 0.17188,-1.046875 z m 3.67383,3.125 h -0.98438 v -8.59375 h 1.0625 v 3.0625 q 0.67188,-0.828125 1.70313,-0.828125 0.57812,0 1.07812,0.234375 0.51563,0.21875 0.84375,0.640625 0.34375,0.421875 0.53125,1.015625 0.1875,0.59375 0.1875,1.265625 0,1.59375 -0.79687,2.46875 -0.79688,0.875 -1.89063,0.875 -1.10937,0 -1.73437,-0.921875 z m -0.0156,-3.15625 q 0,1.109375 0.3125,1.609375 0.5,0.8125 1.34375,0.8125 0.6875,0 1.1875,-0.59375 0.51563,-0.59375 0.51563,-1.796875 0,-1.21875 -0.48438,-1.796875 -0.48437,-0.578125 -1.17187,-0.578125 -0.6875,0 -1.20313,0.609375 -0.5,0.59375 -0.5,1.734375 z m 5.33008,0.04687 q 0,-1.734375 0.95313,-2.5625 0.79687,-0.6875 1.95312,-0.6875 1.28125,0 2.09375,0.84375 0.82813,0.828125 0.82813,2.3125 0,1.203125 -0.35938,1.890625 -0.35937,0.6875 -1.0625,1.078125 -0.6875,0.375 -1.5,0.375 -1.29687,0 -2.10937,-0.828125 -0.79688,-0.84375 -0.79688,-2.421875 z m 1.07813,0 q 0,1.1875 0.51562,1.78125 0.53125,0.59375 1.3125,0.59375 0.79688,0 1.3125,-0.59375 0.51563,-0.59375 0.51563,-1.8125 0,-1.15625 -0.53125,-1.75 -0.51563,-0.59375 -1.29688,-0.59375 -0.78125,0 -1.3125,0.59375 -0.51562,0.578125 -0.51562,1.78125 z m 5.9707,3.109375 v -6.21875 h 0.95312 v 0.9375 q 0.35938,-0.65625 0.65625,-0.859375 0.3125,-0.21875 0.6875,-0.21875 0.53125,0 1.07813,0.328125 l -0.35938,0.984375 q -0.39062,-0.234375 -0.76562,-0.234375 -0.35938,0 -0.64063,0.21875 -0.26562,0.203125 -0.375,0.578125 -0.1875,0.5625 -0.1875,1.21875 v 3.265625 z m 6.30859,-0.9375 0.15625,0.921875 q -0.45312,0.09375 -0.79687,0.09375 -0.57813,0 -0.89063,-0.171875 -0.3125,-0.1875 -0.45312,-0.484375 -0.125,-0.296875 -0.125,-1.25 V 47.59824 h -0.76563 v -0.8125 h 0.76563 v -1.54687 l 1.04687,-0.625 v 2.171875 h 1.0625 v 0.8125 h -1.0625 v 3.640625 q 0,0.453125 0.0469,0.578125 0.0625,0.125 0.1875,0.203125 0.125,0.07813 0.35937,0.07813 0.1875,0 0.46875,-0.03125 z" />
  <path
     style="fill:#000000;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path169"
     d="m 54.13259,72.84834 v 0 c 0,-3.600723 2.918964,-6.519684 6.519684,-6.519684 v 0 c 1.72913,0 3.387436,0.68689 4.610115,1.909569 1.222679,1.222679 1.909569,2.880989 1.909569,4.610115 v 0 c 0,3.600723 -2.918961,6.519684 -6.519684,6.519684 v 0 c -3.60072,0 -6.519684,-2.918961 -6.519684,-6.519684 z" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path171"
     d="m 54.13259,72.84834 v 0 c 0,-3.600723 2.918964,-6.519684 6.519684,-6.519684 v 0 c 1.72913,0 3.387436,0.68689 4.610115,1.909569 1.222679,1.222679 1.909569,2.880989 1.909569,4.610115 v 0 c 0,3.600723 -2.918961,6.519684 -6.519684,6.519684 v 0 c -3.60072,0 -6.519684,-2.918961 -6.519684,-6.519684 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path173"
     d="M 61.630394,77.469734 79.866615,95.705955" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path175"
     d="M 61.630394,77.469734 75.623978,91.463318" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path177"
     d="m 74.456024,92.63126 4.376869,2.04097 -2.04097,-4.376869 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path179"
     d="m 199.30186,225.41402 h 30.29921 v 74.26771 h -30.29921 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path181"
     d="m 213.72115,248.92174 v -7.875 h 1.59375 v 7.875 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path183"
     d="m 211.40054,254.04674 h 2.90625 q 0.98437,0 1.5,0.15625 0.6875,0.20312 1.17187,0.71875 0.5,0.51562 0.75,1.28123 0.26563,0.75 0.26563,1.85938 0,0.96875 -0.23438,1.67187 -0.29687,0.85938 -0.84375,1.39063 -0.42187,0.40625 -1.125,0.625 -0.51562,0.17187 -1.40625,0.17187 h -2.98437 z m 1.59375,1.32812 v 5.21874 h 1.1875 q 0.65625,0 0.95312,-0.0781 0.39063,-0.0937 0.64063,-0.3125 0.26562,-0.23437 0.42187,-0.76562 0.15625,-0.53125 0.15625,-1.45313 0,-0.90625 -0.15625,-1.39062 -0.15625,-0.5 -0.45312,-0.76561 -0.29688,-0.28125 -0.73438,-0.375 -0.32812,-0.0781 -1.3125,-0.0781 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path185"
     d="m 212.04059,274.92172 v -7.8125 h 1.59375 v 6.48437 h 3.95312 v 1.32813 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path187"
     d="m 211.69452,287.92172 v -7.875 h 5.84375 v 1.32812 h -4.25 v 1.75 h 3.95312 v 1.32813 h -3.95312 v 2.14062 h 4.40625 v 1.32813 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path189"
     d="m 84.6785,93.29077 h 30.29921 v 83.37009 H 84.6785 Z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path191"
     d="m 99.09778,125.90085 v -7.875 h 1.59375 v 7.875 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path193"
     d="m 96.777176,131.02585 h 2.90625 q 0.984374,0 1.500004,0.15625 0.6875,0.20312 1.17187,0.71875 0.5,0.51562 0.75,1.28125 0.26563,0.75 0.26563,1.85937 0,0.96875 -0.23438,1.67188 -0.29687,0.85937 -0.84375,1.39062 -0.42187,0.40625 -1.125,0.625 -0.51562,0.17188 -1.406249,0.17188 h -2.984375 z m 1.59375,1.32812 v 5.21875 h 1.1875 q 0.656254,0 0.953124,-0.0781 0.39063,-0.0937 0.64063,-0.3125 0.26562,-0.23438 0.42187,-0.76563 0.15625,-0.53125 0.15625,-1.45312 0,-0.90625 -0.15625,-1.39063 -0.15625,-0.5 -0.45312,-0.76562 -0.29688,-0.28125 -0.73438,-0.375 -0.32812,-0.0781 -1.312499,-0.0781 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path195"
     d="m 97.41722,151.90085 v -7.8125 h 1.59375 v 6.48437 h 3.95313 v 1.32813 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path197"
     d="m 97.07116,164.90085 v -7.875 h 5.84375 v 1.32812 h -4.25 v 1.75 h 3.95313 v 1.32813 h -3.95313 v 2.14062 h 4.40625 v 1.32813 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path199"
     d="m 343.53543,71.43279 h 30.29922 v 146.07874 h -30.29922 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path201"
     d="m 355.57797,127.75153 -1.89063,-7.875 h 1.64063 l 1.1875,5.40625 1.4375,-5.40625 h 1.89062 l 1.375,5.5 1.20313,-5.5 h 1.60937 l -1.92187,7.875 h -1.6875 l -1.5625,-5.89062 -1.5625,5.89062 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path203"
     d="m 355.02502,136.86092 q 0,-1.20313 0.35937,-2.01563 0.26563,-0.60937 0.71875,-1.07812 0.46875,-0.48438 1.03125,-0.71875 0.73438,-0.3125 1.6875,-0.3125 1.75,0 2.78125,1.09375 1.04688,1.07812 1.04688,3 0,1.90625 -1.03125,2.98437 -1.03125,1.07813 -2.76563,1.07813 -1.76562,0 -2.79687,-1.07813 -1.03125,-1.07812 -1.03125,-2.95312 z m 1.625,-0.0469 q 0,1.32813 0.625,2.03125 0.625,0.6875 1.5625,0.6875 0.95312,0 1.5625,-0.6875 0.60937,-0.6875 0.60937,-2.0625 0,-1.34375 -0.59375,-2.01562 -0.59375,-0.67188 -1.57812,-0.67188 -0.98438,0 -1.59375,0.6875 -0.59375,0.67188 -0.59375,2.03125 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path205"
     d="m 355.64975,153.75154 v -7.875 h 3.34375 q 1.26562,0 1.82812,0.21875 0.57813,0.20312 0.92188,0.75 0.34375,0.54687 0.34375,1.23437 0,0.89063 -0.53125,1.46875 -0.51563,0.57813 -1.54688,0.73438 0.51563,0.29687 0.84375,0.65625 0.34375,0.35937 0.90625,1.28125 l 0.96875,1.53125 h -1.90625 l -1.15625,-1.71875 q -0.60937,-0.90625 -0.84375,-1.14063 -0.21875,-0.25 -0.46875,-0.32812 -0.25,-0.0937 -0.79687,-0.0937 h -0.32813 v 3.28125 z m 1.57812,-4.54688 h 1.1875 q 1.14063,0 1.42188,-0.0937 0.28125,-0.0937 0.4375,-0.32812 0.17187,-0.23438 0.17187,-0.59375 0,-0.40625 -0.21875,-0.64063 -0.20312,-0.25 -0.59375,-0.3125 -0.1875,-0.0312 -1.15625,-0.0312 h -1.25 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path207"
     d="m 355.66537,166.75154 v -7.875 h 1.57812 v 3.5 l 3.21875,-3.5 h 2.14063 l -2.96875,3.0625 3.125,4.8125 h -2.0625 l -2.15625,-3.70313 -1.29688,1.32813 v 2.375 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path209"
     d="m 357.9547,179.75154 v -7.875 h 1.59375 v 7.875 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path211"
     d="m 355.64975,192.75154 v -7.875 h 1.54687 l 3.23438,5.26562 v -5.26562 h 1.46875 v 7.875 H 360.306 l -3.17188,-5.14063 v 5.14063 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path213"
     d="m 359.0094,202.86092 v -1.32813 h 3.42188 v 3.14063 q -0.5,0.46875 -1.45313,0.84375 -0.9375,0.375 -1.92187,0.375 -1.23438,0 -2.15625,-0.51563 -0.90625,-0.53125 -1.375,-1.48437 -0.45313,-0.96875 -0.45313,-2.10938 0,-1.21875 0.51563,-2.17187 0.51562,-0.96875 1.5,-1.46875 0.76562,-0.40625 1.89062,-0.40625 1.46875,0 2.28125,0.625 0.82813,0.60937 1.0625,1.70312 l -1.57812,0.29688 q -0.15625,-0.59375 -0.625,-0.92188 -0.45313,-0.34375 -1.14063,-0.34375 -1.04687,0 -1.65625,0.67188 -0.60937,0.65625 -0.60937,1.95312 0,1.40625 0.60937,2.10938 0.625,0.70312 1.64063,0.70312 0.5,0 1,-0.1875 0.5,-0.20312 0.85937,-0.48437 v -1 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path215"
     d="m 473.15753,89.824425 h 30.29919 V 173.1945 h -30.29919 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path217"
     d="m 487.5768,122.4345 v -7.875 h 1.59375 v 7.875 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path219"
     d="m 485.2562,127.5595 h 2.90625 q 0.98437,0 1.5,0.15625 0.6875,0.20313 1.17187,0.71874 0.5,0.51563 0.75,1.28125 0.26563,0.75 0.26563,1.85938 0,0.96875 -0.23438,1.67187 -0.29687,0.85938 -0.84375,1.39063 -0.42187,0.40625 -1.125,0.625 -0.51562,0.17187 -1.40625,0.17187 h -2.98437 z m 1.59375,1.32812 v 5.21875 h 1.1875 q 0.65625,0 0.95312,-0.0781 0.39063,-0.0937 0.64063,-0.3125 0.26562,-0.23437 0.42187,-0.76562 0.15625,-0.53125 0.15625,-1.45313 0,-0.90625 -0.15625,-1.39062 -0.15625,-0.5 -0.45312,-0.76563 -0.29688,-0.28125 -0.73438,-0.375 -0.32812,-0.0781 -1.3125,-0.0781 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path221"
     d="m 485.89624,148.4345 v -7.8125 h 1.59375 v 6.48438 h 3.95312 v 1.32812 z" />
  <path
     style="fill:#1155cc;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path223"
     d="m 485.55017,161.4345 v -7.875 h 5.84375 v 1.32813 h -4.25 v 1.75 h 3.95312 v 1.32812 h -3.95312 v 2.14063 h 4.40625 v 1.32812 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path225"
     d="m 341.56674,78.78215 h 37.44879 v 37.57481 h -37.44879 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path227"
     d="m 350.92612,99.6434 2.0625,-0.3125 q 0.125,0.59375 0.53125,0.90625 0.40625,0.3125 1.125,0.3125 0.79688,0 1.20313,-0.29687 0.26562,-0.20313 0.26562,-0.54688 0,-0.234375 -0.14062,-0.390625 -0.15625,-0.140625 -0.6875,-0.265625 -2.48438,-0.546875 -3.15625,-1 -0.92188,-0.640625 -0.92188,-1.75 0,-1.015625 0.79688,-1.703125 0.79687,-0.6875 2.46875,-0.6875 1.60937,0 2.375,0.515625 0.78125,0.515625 1.07812,1.546875 L 355.973,96.3309 q -0.125,-0.453125 -0.46875,-0.6875 -0.34375,-0.25 -0.98438,-0.25 -0.8125,0 -1.17187,0.21875 -0.23438,0.15625 -0.23438,0.421875 0,0.21875 0.20313,0.375 0.28125,0.203125 1.92187,0.578125 1.65625,0.375 2.29688,0.90625 0.65625,0.5625 0.65625,1.53125 0,1.07813 -0.90625,1.84375 -0.89063,0.76563 -2.64063,0.76563 -1.59375,0 -2.51562,-0.64063 -0.92188,-0.64062 -1.20313,-1.75 z m 15.38547,0.3125 v 1.90625 h -7.21875 q 0.10937,-1.07812 0.6875,-2.046875 0.59375,-0.984375 2.32812,-2.578125 1.39063,-1.296875 1.70313,-1.765625 0.42187,-0.640625 0.42187,-1.25 0,-0.6875 -0.375,-1.0625 -0.35937,-0.375 -1.01562,-0.375 -0.64063,0 -1.03125,0.390625 -0.375,0.390625 -0.42188,1.296875 l -2.0625,-0.21875 q 0.1875,-1.6875 1.15625,-2.421875 0.96875,-0.75 2.42188,-0.75 1.57812,0 2.48437,0.859375 0.92188,0.859375 0.92188,2.125 0,0.734375 -0.26563,1.390625 -0.26562,0.65625 -0.82812,1.359375 -0.375,0.484375 -1.34375,1.375 -0.96875,0.890625 -1.23438,1.1875 -0.26562,0.296875 -0.42187,0.578125 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path229"
     d="m 470.44324,78.28346 h 37.44882 v 33.10236 h -37.44882 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path231"
     d="m 479.8026,99.144714 2.0625,-0.3125 q 0.125,0.59375 0.53125,0.90625 0.40625,0.312496 1.125,0.312496 0.79687,0 1.20312,-0.296871 0.26563,-0.203125 0.26563,-0.546875 0,-0.234375 -0.14063,-0.390625 -0.15625,-0.140625 -0.6875,-0.265625 -2.48437,-0.546875 -3.15625,-1 -0.92187,-0.640625 -0.92187,-1.75 0,-1.015625 0.79687,-1.703125 0.79688,-0.6875 2.46875,-0.6875 1.60938,0 2.375,0.515625 0.78125,0.515625 1.07813,1.546875 l -1.95313,0.359375 q -0.125,-0.453125 -0.46875,-0.6875 -0.34375,-0.25 -0.98437,-0.25 -0.8125,0 -1.17188,0.21875 -0.23437,0.15625 -0.23437,0.421875 0,0.21875 0.20312,0.375 0.28125,0.203125 1.92188,0.578125 1.65625,0.375 2.29687,0.90625 0.65625,0.5625 0.65625,1.53125 0,1.078126 -0.90625,1.843746 -0.89062,0.76563 -2.64062,0.76563 -1.59375,0 -2.51563,-0.64063 -0.92187,-0.64062 -1.20312,-1.749996 z m 8.35425,-0.625 2,-0.25 q 0.0937,0.765625 0.5,1.171875 0.42187,0.390625 1.01562,0.390625 0.64063,0 1.07813,-0.46875 0.4375,-0.484375 0.4375,-1.3125 0,-0.78125 -0.42188,-1.234375 -0.42187,-0.453125 -1.01562,-0.453125 -0.40625,0 -0.95313,0.15625 l 0.23438,-1.671875 q 0.82812,0.01563 1.26562,-0.359375 0.45313,-0.390625 0.45313,-1.03125 0,-0.53125 -0.32813,-0.859375 -0.32812,-0.328125 -0.85937,-0.328125 -0.53125,0 -0.90625,0.375 -0.35938,0.359375 -0.45313,1.0625 l -1.89062,-0.3125 q 0.20312,-0.984375 0.59375,-1.5625 0.40625,-0.578125 1.10937,-0.90625 0.71875,-0.34375 1.60938,-0.34375 1.51562,0 2.42187,0.96875 0.76563,0.78125 0.76563,1.78125 0,1.421875 -1.54688,2.265625 0.92188,0.1875 1.46875,0.875 0.5625,0.6875 0.5625,1.671875 0,1.40625 -1.04687,2.406246 -1.03125,1 -2.5625,1 -1.45313,0 -2.42188,-0.84375 -0.95312,-0.843746 -1.10937,-2.187496 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path233"
     d="m 197.05923,202.92651 h 37.44882 v 33.10236 h -37.44882 z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path235"
     d="m 206.41861,223.78777 2.0625,-0.3125 q 0.125,0.59375 0.53125,0.90625 0.40625,0.3125 1.125,0.3125 0.79687,0 1.20312,-0.29688 0.26563,-0.20312 0.26563,-0.54687 0,-0.23438 -0.14063,-0.39063 -0.15625,-0.14062 -0.6875,-0.26562 -2.48437,-0.54688 -3.15625,-1 -0.92187,-0.64063 -0.92187,-1.75 0,-1.01563 0.79687,-1.70313 0.79688,-0.6875 2.46875,-0.6875 1.60938,0 2.375,0.51563 0.78125,0.51562 1.07813,1.54687 l -1.95313,0.35938 q -0.125,-0.45313 -0.46875,-0.6875 -0.34375,-0.25 -0.98437,-0.25 -0.8125,0 -1.17188,0.21875 -0.23437,0.15625 -0.23437,0.42187 0,0.21875 0.20312,0.375 0.28125,0.20313 1.92188,0.57813 1.65625,0.375 2.29687,0.90625 0.65625,0.5625 0.65625,1.53125 0,1.07812 -0.90625,1.84375 -0.89062,0.76562 -2.64062,0.76562 -1.59375,0 -2.51563,-0.64062 -0.92187,-0.64063 -1.20312,-1.75 z m 12.46361,2.21875 v -2.15625 h -4.39063 v -1.8125 l 4.65625,-6.8125 h 1.73438 v 6.8125 h 1.32812 v 1.8125 h -1.32812 v 2.15625 z m 0,-3.96875 v -3.67188 l -2.46875,3.67188 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path237"
     d="m 82.85262,78.50131 h 37.44882 v 33.10236 H 82.85262 Z" />
  <path
     style="fill:#000000;fill-rule:nonzero"
     inkscape:connector-curvature="0"
     id="path239"
     d="m 92.212,99.362564 2.0625,-0.3125 q 0.125,0.59375 0.53125,0.90625 0.40625,0.312496 1.125,0.312496 0.796875,0 1.203125,-0.296871 0.265625,-0.203125 0.265625,-0.546875 0,-0.234375 -0.140625,-0.390625 -0.15625,-0.140625 -0.6875,-0.265625 -2.484375,-0.546875 -3.15625,-1 -0.921875,-0.640625 -0.921875,-1.75 0,-1.015625 0.796875,-1.703125 0.796875,-0.6875 2.46875,-0.6875 1.609375,0 2.375,0.515625 0.78125,0.515625 1.078125,1.546875 l -1.953125,0.359375 q -0.125,-0.453125 -0.46875,-0.6875 -0.34375,-0.25 -0.984375,-0.25 -0.8125,0 -1.171875,0.21875 -0.234375,0.15625 -0.234375,0.421875 0,0.21875 0.203125,0.375 0.28125,0.203125 1.921875,0.578125 1.65625,0.375 2.296875,0.90625 0.65625,0.5625 0.65625,1.53125 0,1.078126 -0.90625,1.843746 -0.890625,0.76563 -2.640625,0.76563 -1.59375,0 -2.515625,-0.64063 Q 92.49325,100.47194 92.212,99.362564 Z m 13.69798,2.218746 h -2.0625 v -7.749996 q -1.125,1.046875 -2.65625,1.546875 v -1.859375 q 0.8125,-0.265625 1.75,-1 0.9375,-0.734375 1.29688,-1.71875 h 1.67187 z" />
  <path
     style="fill:#000000;fill-opacity:0;fill-rule:evenodd"
     inkscape:connector-curvature="0"
     id="path241"
     d="m 389.64304,249.45932 -9.92127,-0.063" />
  <path
     style="fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round"
     inkscape:connector-curvature="0"
     id="path243"
     d="m 389.64304,249.45932 -3.92139,-0.0249" />
  <path
     style="fill:#000000;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:butt"
     inkscape:connector-curvature="0"
     id="path245"
     d="m 385.73215,247.78271 -4.54849,1.62289 4.52752,1.68052 z" />
</svg>


<p>
    Web Prolog comes with a set of built-in predicates that allows a client to spawn a local or remote pengine (<code>pengine_spawn/1-2</code>), and to send the messages in bold to it (<code>pengine_ask/2-3</code>, <code>pengine_next/1-2</code>, <code>pengine_stop/1</code>, <code>pengine_respond/2</code>, <code>pengine_abort/1</code> and <code>pengine_exit/1</code>). Under the hood, these predicates are using <code>!/2</code> and <code>receive/1-2</code> to do their thing so the predicates are mostly there for convenience.  
Here's how to spawn a local pengine:
</p>

<pre id="pengine-simple1">
?- pengine_spawn(Pid).
</pre>

<p>
  <button onclick='enter("#pengine-simple1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    The pengine is now initialised and the protocol is in state <em>s1</em>. Here's how to ask the pengine a query:
</p>

<pre id="pengine-simple2">
?- pengine_ask($Pid, member(_X,[a,b,c])),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-simple2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    This took the protocol to state <em>s2</em> and then to state <em>s4</em>. A <code>success</code> message was emitted during the transition.
</p>

<p>
    Here's how to use <code>pengine_next/1</code> to request the next solution to our query:
</p>

<pre id="pengine-simple3">
?- pengine_next($Pid),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-simple3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    The protocol transitioned first to state <em>s2</em>, and then back to <em>s4</em> again. When we don't need more answers, we call <code>pengine_stop/1</code>:
</p>

<pre id="pengine-simple4">
?- pengine_stop($Pid),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-simple4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
	We are back to state <em>s1</em> and the pengine is ready to accept new queries. Now, let's try this:
</p>

<pre id="pengine-output1">
?- pengine_ask($Pid, pengine_output(p(a))),
   receive({output($Pid, p(X)) -> true}),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-output1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    This took the protocol to state <em>s2</em> and then took a lap over the transition with the label /output and back to state <em>s2</em> and then to <em>s1</em> again. Note that <code>pengine_output/1</code> "wrote" a complex term and that we were able to use a receive that tries to match it.
</p>


<p>
    Finally, let's try this:
</p>

<pre id="pengine-input1">
?- pengine_ask($Pid, pengine_input(myprompt, _Answer)),
   receive({prompt($Pid, Prompt) -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-input1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    This took the protocol to state <em>s2</em> and then directly to state <em>s3</em> while it emitted a prompt term. It now waits in state <em>s3</em>. 
</p>

<p>
    This is how we can respond to the prompt:
</p>

<pre id="pengine-input2">
?- pengine_respond($Pid, hello),
   receive({Answer -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-input2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    This took the protocol to state <em>s2</em> and then directly to state <em>s1</em> while it emitted a success term.
</p>


<p>
	Having spawned a process running a goal, it sometimes happens that it loops indefinitely, so that we may 
  	need to terminate it by force.
</p>

<p>To see how, let's ask a query that takes a while to terminate ...</p>

<pre id="pengine-abort1">
?- pengine_ask($Pid, forall(between(1,30, _N), (io:writeln(_N), sleep(1)))).
</pre>

<p>
  <button onclick='enter("#pengine-abort1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>... just to be able to show how to abort it:</p>

<pre id="pengine-abort2">
?- pengine_abort($Pid),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-abort2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<div class="alert alert-danger">
  <strong>BUG!</strong> The abort generated the wrong response. Should have been
  <code>abort(&lt;pid&gt;)</code>.
</div>

<p>
  Note that aborting the running query doesn't kill the pengine. It's still 
  alive, ready to accept new queries. To kill a pengine from the outside, you'd
  need to call <code>pengine_exit/2</code> (or just <code>exit/2</code>). To do it from the inside, you would need to use <code>pengine_exit/1</code> (or just <code>exit/2</code>). More on this later.
</p>

<h3>Pengines deferring messages</h3>

<p>
    One consequence of the message deferring behaviour of <code>receive/1-2</code> that was described earlier is that messages, to some extent, are allowed to arrive to a mailbox in the "wrong" order. Let's look at an example where we first spawn a new pengine:
</p>

<pre id="pengine-deferred1">
?- pengine_spawn(Pid).
</pre>

<p>
  <button onclick='enter("#pengine-deferred1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>Now, let's make a deliberate "mistake" and call <code>pengine_next/1</code> to request the next solution to a query that hasn't yet been asked:</p>

<pre id="pengine-deferred2">
?- pengine_next($Pid).
</pre>

<p>
  <button onclick='enter("#pengine-deferred2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>We use <code>flush/0</code> to inspect the result:</p>

<pre id="pengine-deferred3">
?- flush.
</pre>

<p>
  <button onclick='enter("#pengine-deferred3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

    <div class="row">
        <div class="col-xs-9">
            <p>
  Look ma, there's nothing there! The protocol obviously wasn't in a state where it could react on the <code>next</code> message. The message was therefore deferred and it's not until <code>pengine_ask/3</code> is called and the protocol changes states that the message <code>next</code> can have an effect. Let's now ask the pengine a query ...
            </p> 
        </div>
        <div class="col-xs-2">
            <img src="img/no-mail.png">
        </div>
    </div>        



<pre id="pengine-deferred4">
?- pengine_ask($Pid, member(_X,[a,b,c])).
</pre>

<p>
  <button onclick='enter("#pengine-deferred4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>... and use <code>flush/0</code> to inspect the result:</p>

<pre id="pengine-deferred5">
?- flush.
</pre>

<p>
  <button onclick='enter("#pengine-deferred5")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    Yes, that's right &ndash; now two messages appeared in the mailbox!
</p>


<h3>Pengines and options</h3>

<p>
    The predicate <code>pengine_spawn/2</code> inherits all its options from
    <code>spawn/3</code>. Here's how to use some of them when creating a
    monitored session running remotely:
</p>

<pre id="pengine-advanced1">
?- pengine_spawn(Pid, [
       monitor(true),
       node('{{host}}'),
       src_text("p(a). p(b). p(c). p(d). p(e)."),
       src_list([p(f), p(g), p(h), p(i), p(j)])
   ]).
</pre>

<p>
  <button onclick='enter("#pengine-advanced1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    The predicate <code>pengine_ask/3</code> introduces two new options,
    <code>template</code> and <code>limit</code>. Here's how they may be used
    when querying the pengine just created:
</p>

<pre id="pengine-advanced2">
?- pengine_ask($Pid, p(_X), [
       template(_X),
       limit(2)
   ]),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-advanced2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    The predicate <code>pengine_next/2</code> is used for retrieving more
    solutions, and will get two of them this time too, just because the previous
    call to <code>pengine_ask/3</code> set that limit:
</p>

<pre id="pengine-advanced3">
?- pengine_next($Pid),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-advanced3")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    But <code>pengine_next/2</code> supports the option <code>limit</code> as 
    well, so that we are allowed to increase (or decrease) the number of 
    solutions that we would like to get:
</p>

<pre id="pengine-advanced4">
?- pengine_next($Pid, [
       limit(4)
   ]),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-advanced4")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<div class="alert alert-danger">
  <strong>Serious BUG!</strong> The answers are wrong!
</div>

<p>
	At some point, we may want to terminate the session. This is where the
	<code>exit/2</code> predicate comes in. Since our pengine is monitored we can expect a <code>down</code> message to appear in our top-level mailbox:
</p>

<pre id="pengine-advanced5">
?- exit($Pid, normal),
   receive({Message -> true}).
</pre>

<p>
  <button onclick='enter("#pengine-advanced5")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>



<h3>Pengines and input/output</h3>

<p>
    This is how I/O works in a pengine:
</p>

<pre id="pengines-io1">
?- pengine_spawn(Pid),
   pengine_ask(Pid, io:writeln(hello)),
   pengine_ask(Pid, pengine_output(goodbye)).
</pre>

<p>
  <button onclick='enter("#pengines-io1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>Let's flush the top-level mailbox:</p>

<pre id="pengines-io2">
?- flush.
</pre>

<p>
  <button onclick='enter("#pengines-io2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<div class="alert alert-success">
  <strong>Web Prolog is an agent programming language</strong> The notion of an agent is rather fuzzy but there are at least three properties that most theorists would agree that a software agent must possess: it must be a process of a sort, only loosely connected to other processes, it must be stateful, thus have a kind of memory of its own, and it must be capable of interacting with the world external to it. Note that under this definition, any stateful actor would qualify as an agent, and even Erlang might be seen as an agent programming language. A pengine is a kind of actor which in addition to the properties listed above has two other traits that we intuitively tend to associate with agenthood: it's capable of reasoning and capable of giving answers to queries &ndash; answers that follow logically from what it believes. So if Erlang is an agent programming language, then this must certainly be true of Web Prolog as well.
</div>

<h2>Remote procedure calls</h2>

Web Prolog supports to kinds of predicate APIs for derived RPC, one which is synchronous and very easy to use, and one which is asynchronous and somewhat harder to use.

<h3>Non-deterministic RPC</h3>

<p>
    Web Prolog offers a predicate <code>rpc/2-3</code> capable of non-deterministic remote procedure 
	calls. Simplifying somewhat, it's implemented like so:
</p>

<pre>
rpc(URI, Query) :-
    rpc(URI, Query, []).
	
rpc(URI, Query, Options) :-
    pengine_spawn(Pid, [
         node(URI),
         exit(true),
         monitor(false)
       | Options
    ]),
    pengine_ask(Pid, Query, Options),
    wait_answer(Query, Pid).

wait_answer(Query, Pid) :-
    receive({
        failure(Pid) -> fail;            
        error(Pid, Exception) -> 
            throw(Exception);                  
        success(Pid, Solutions, true) -> 
            (   member(Query, Solutions)
            ;   pengine_next(Pid), 
                wait_answer(Query, Pid)
            );
        success(Pid, Solutions, false) -> 
            member(Query, Solutions)
    }).
</pre>

<p>
    Here's how we can test it:
</p>

<pre id="rpc-http">
?- rpc('{{host}}', member(X,[a,b,c])).
</pre>

<p>
  <button onclick='enter("#rpc-http")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    The following example shows that the first (slow) solution isn't recomputed when we ask for the second one:
</p>

<pre id="rpc-http2">
?- rpc('{{host}}', (sleep(1), X=a; X=b)).
</pre>

<p>
  <button onclick='enter("#rpc-http2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    By default, <code>rpc/2-3</code> uses the RESTful HTTP transport. The <code>transport</code> option allows us to use the WebSocket transport instead. In order to inject code into the process, the option <code>src_text</code> (inherited from
    <code>pengine_spawn/2</code> which in turn inherited it from <code>spawn/3</code>) may be passed:
</p>

<pre id="rpc-ws">
?- rpc('{{host}}', p(X), [
       transport(ws),
       src_text('p(a). p(b). p(c).')
   ]).
</pre>

<p>
  <button onclick='enter("#rpc-ws")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    The special purpose URI <code>localnode</code> serves as the default value of the <code>node</code> option for both <code>spawn/3</code> and <code>pengine_spawn/2</code>. Thus it follows, perhaps a bit counter-intuitively, that in combination with the <code>src_uri</code> option <code>rpc/3</code> can also be used to "bring data to the code":
</p>

<pre id="rpc-localnode">
?- rpc(localnode, p(X), [
       src_uri('https://gist.githubusercontent.com/torbjornlager/21583e7238dc855f94f6b5f2f48788bb/raw/p.pl')
   ]).
</pre>

<p>
  <button onclick='enter("#rpc-localnode")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    For the purpose of reducing the number of network roundtrips, the option 
    <code>limit</code> (inherited from <code>pengine_ask/3</code>) may be passed:
</p>

<pre id="rpc-limit">
?- rpc('{{host}}', between(1, 12, N), [
       limit(5)
   ]).
</pre>

<p>
  <button onclick='enter("#rpc-limit")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    As the above example tries to convey, although the call only makes three network roundtrips 
	in order to generate all twelve solutions, the behaviour of the call, as seen from the point 
    of view of the client, doesn't change. Indeed, the <code>limit</code> option serves as a
    performance optimisation only, and hasn'thing to with logic and the declarative reading
    of the query.
</p>


<h3>Promises (asynchronous RPC)</h3>
            
<p>
    A <em>promise</em> is a type of RPC method that doesn't suspend the caller until the result is 
    computed. Instead, a reference is immediately returned, which can later be used by <code>yield/2-3</code> 
    to collect the answer. The reference can be viewed as a promise to deliver the 
    answer.
</p>

<pre id="promise">
?- promise('{{host}}', (sleep(2),_X=done), Reference).
</pre>

<p>
  <button onclick='enter("#promise")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p> 
            
<p>
    <code>yield/2-3</code> returns the promised answer from a previous call to <code>promise/3-4</code>. 
    If the answer is available, it's returned immediately. Otherwise, the calling
    process is suspended until the answer arrives from the node that was called.
    Note that this predicate must be called by the same process from
    which the previous call to <code>promise/3-4</code> was made.</p>

<pre id="yield-timeout">
?- yield($Reference, Answer, [timeout(4)]).
</pre>

<p>
  <button onclick='enter("#yield-timeout")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
    To get the behaviour when no answer is available, you may want to click Enter again ...
</p>

<p>The above use of <code>promise/3-4</code> and <code>yield/3</code> only gave the first answer to the query. To produce other answers, we can pass an option <code>offset</code>. The <code>limit</code> option is also available, allowing us to ask for more than one answer at a time:</p>

<pre id="promise-offset1">
?- promise('{{host}}', member(_X,[a,b,c,d]), Reference, [
       template(_X),
       offset(1),
       limit(2)
   ]).
</pre>
            
<p>
  <button onclick='enter("#promise-offset1")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p> 
            
<p>Let's call <code>yield/3</code> again:</p>

<pre id="promise-offset2">
?- yield($Reference, Answer, [timeout(0.5)]).
</pre>

<p>
  <button onclick='enter("#promise-offset2")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p>

<p>
	Note that if we would now request the remaining answers by re-running the call to <code>promise/4</code> with 
	<code>offset</code> set to <code>3</code> this time, it's likely (but not guaranteed) that the work that generated the three first solutions does not have to be repeated. An anonymous pengine running on the node serves as a form of cache.
</p>


<h2>Using the Web APIs</h2>

<p>
    A Web Prolog runtime system &ndash; or what we have referred to as a <i>node</i> &ndash; is equipped with a comprehensive set of web APIs, using both WebSocket and HTTP as transport protocols, over which a client can run Web Prolog programs defined by the owner of the client, the owner of the node, or a combination of both. In this section we will take a closer look at the web APIs and also demonstrate how they can be used.
</p>
<p>
    The web APIs are not an afterthought. They are extremely important. Indeed, if we did not use HTTP or WebSocket, we would not be on the Web. We use both, and the whole distribution layer of Web Prolog depends on them, for openness, as well as for security. The web APIs must be capable of everything that the predicate APIs are capable of, and vice versa. Otherwise they would not be able to support the distributed programming model of Web Prolog. 
</p>

<h3>Using the WebSocket API</h3>

<p>
    A Web Prolog node supports a comprehensive asynchronous and stateful web API that relies on the WebSocket transport. Offering an almost unlimited control over a pengine it currently serves the shell (which despite its apparent simplicity is a fairly demanding web application) as well as the predicate API with its <code>node</code> option and network transparent send primitive <code>!/2</code>. (We write "almost" here since the owner of the node on which the actor is running always has the ultimate say when it comes to how much resources will be allocated to the running of an actor.)
</p>

<p>
    For an example of how the WebSocket API can be used, you need to look no further than towards end of the source of the shell. it's a bit to messy though. (The implementation relies a lot on a library called <a href="http://terminal.jcubic.pl">jQuery Terminal</a>. Without that, it would have been a lot messier.)
</p>

<p>
	To make it easier, we have prepared two much simpler (but useless) applications that you can try by selecting the links below. Upon page load, the first application will create a WebSocket connection to the tutorial node, spawn a pengine there, and (when having received a pid) ask the query <code>ancestor_decendant(mike, Who)</code>. For demonstration purposes, the <code>limit</code> option will be set to <code>2</code>. Here's the complete HTML and JavaScript source code for this application:
</p>

<pre>
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
    &lt;title&gt;Example 1&lt;/title&gt;
    &lt;script&gt;
      var ws = new WebSocket('ws://localhost:3060/ws','pcp-0.2');
      ws.onopen = function (message) {
        ws.send(JSON.stringify({
          command: 'pengine_spawn'
        }));
      };
      ws.onmessage = function (message) {
        var event = JSON.parse(message.data);
        if (event.type == 'spawned') {
          ws.send(JSON.stringify({
            command: 'pengine_ask',
            pid: event.pid,
            query: 'ancestor_decendant(mike, Who)',
            options: '[limit(2)]'
          }));
        } else if (event.type == 'success') {
          document.getElementById(&quot;output&quot;).innerHTML += 
              JSON.stringify(event.data) + &quot;&lt;br/&gt;&quot;;
          if (event.more) {
            ws.send(JSON.stringify({
              command: 'pengine_next',
              pid: event.pid
            }));
          }
        }
      };   
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;output&quot;&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;  
</pre>

<p>
	To see the example in action, select the link below. A page will open in a new window or tab and show the output in the upper left corner. (Note that you can also use "View Page Source" to inspect the source code.)
</p>

<p>
	<a target="_blank" href="/apps/swish/ws-example-1.html">
    	&nbsp;<code>{{host}}/apps/swish/ws-example-1.html</code>
    </a>
</p>

<p>
	Our second example will inject the source code for a simple echo program in the spawned pengine and invite you to input Prolog terms to be echoed to the page. Here's the HTML and JavaScript source code for the second application:
</p>

<pre>
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
    &lt;title&gt;Example 2&lt;/title&gt;
    &lt;script&gt;
      var ws = new WebSocket('ws://localhost:3060/ws','pcp-0.2');
      var program = 
         `echo :-
              pengine_input('Input a term!', Something),
              (   Something == null
              -&gt;  true
              ;   pengine_output(Something),
                  echo
              ).`;
      ws.onopen = function (message) {
        ws.send(JSON.stringify({
          command: 'pengine_spawn',
          options: '[src_text(&quot;' + program + '&quot;)]'
        }));
      };
      ws.onmessage = function (message) {
        var event = JSON.parse(message.data);
        if (event.type == 'spawned') {
          ws.send(JSON.stringify({
            command: 'pengine_ask',
            pid: event.pid,
            query: 'echo'
          }));
        } else if (event.type == 'prompt') {
          var response = prompt(event.data);
          ws.send(JSON.stringify({
            command: 'pengine_respond',
            pid: event.pid,
            term: response
          }));
        } else if (event.type == 'output') {
          document.getElementById(&quot;output&quot;).innerHTML += 
              JSON.stringify(event.data) + &quot;&lt;br/&gt;&quot;;
        }
      };
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;output&quot;&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;    
</pre>

<p>
	Again, to see what the example does, select the link below, then enter Prolog terms in the widget that pops up and watch them being echoed to the page.
</p>

<p>
	<a target="_blank" href="/apps/swish/ws-example-2.html">
    	&nbsp;<code>{{host}}/apps/swish/ws-example-2.html</code>
    </a>
</p>


<h3>Using the HTTP ask API</h3>

<p>
    As a complement to the asynchronous and stateful API described above, a Web Prolog node also offers a synchronous and stateless web API. Alternatively, although this isn't a term we like to use since it's so vague, it can be described as <a target="_blank" href="https://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a>. In any case, statelessness is definitely part of being RESTful.
</p>

<p>
    To be considered stateless, as soon a node has returned a response to a query, it should be able to (as it were) "forget" everything about the previous request, and the next request to the node should be formed as if the previous one never occurred.
</p>

<p>
    [Explain RESTful] Eg. no cookies are involved.
</p>

<p>
    <code>{{host}}/ask?query=ancestor_decendant(mike,Who)</code>
</p>

<p>In addition to parameters such as <code>query</code>, <code>template</code>, <code>limit</code> and <code>format</code>, the API also supports an <code>offset</code> parameter. The challenge here has been to make this efficient in the presence of queries with more than one solution, i.e when backtracking over HTTP is called for.</p>

<p>
	<a target="_blank" href="/ask?query=ancestor_decendant(mike, Who)">
    	&nbsp;<code>{{host}}/ask?query=ancestor_decendant(mike, Who)</code>
    </a>
</p>

<p>
	Note that if we would now request the remaining answers by making the following request:
</p>

<p>
	<a target="_blank" href="/ask?query=ancestor_decendant(mike, Who)&amp;offset=1&amp;limit=2">
    	&nbsp;<code>{{host}}/ask?query=ancestor_decendant(mike, Who)&amp;offset=1&amp;limit=2</code>
    </a>
</p>

<p>    
    i.e. with 
	<code>offset</code> set to <code>1</code> this time, then it's likely (but not guaranteed) that the work that generated the first solution does not have to be repeated. Pengine are involved here too, but they are <i>anonymous</i>. An anonymous pengine running on the node serves as a form of <i>Prolog state cache</i>. The cached state can only be used once though, and there's a possibility that another client made use of it before you had a chance to do so. If so, no real harm is done.
</p>   

<p>
	Note that we, as a way to avoid making too many network roundtrips, can use the <code>limit</code> parameter in an HTTP request too:
</p>

<p>
	In a real web browser application, <a target="_blank" href="https://en.wikipedia.org/wiki/XMLHttpRequest">XMLHttpRequest</a> would be used.
</p>

<p>
    This API doesn't support I/O, and is therefore only suitable for applications in need of a "logic server". Nor does it support uses of assert and retract.
</p>



<h3>Using the HTTP send API</h3>

<p><code>{{host}}/send</code></p>

<p>
    By means of this API, and given a pid or a registered name, you are able to send a message to the "named" actor. To demonstrate this, we ask you to once again subscribe to the publish-subscribe service:
</p>

<pre id="pubsub10">
?- self(Self),
   pubsub_service ! subscribe(Self),
   repeat,
   io:write("Waiting for a message ..."),
   receive({
       msg(Message) ->
           io:format("Received: ~p", [Message]),
           fail
   }).
</pre>

<p>
  <button onclick='enter("#pubsub10")' class="btn btn-xs btn-primary" type="button">Enter</button>
</p> 

<p>
    Here's a link making an API request that will publish the term <code>hello</code> to the service which will then forward it to all subscribers:
</p>

<p>
	<a target="_blank" href="/send?name=pubsub_service&amp;message=publish(hello)">
    	&nbsp;<code>{{host}}/send?name=pubsub_service&amp;message=publish(hello)</code>
    </a>
</p>

<p>
    Such a request can be made by any client that knows the name of the service.
</p>

<div class="alert alert-danger">
  <strong>BUG!</strong> Not really a bug... but this needs to work with a POST request as well.
</div>


<h2>What should we use for distribution?</h2>

<p>
  Web Prolog supports no less than four ways to do distributed programming:
</p>

<ol>
    <li>
        Use <code>spawn/3</code> with the <code>node</code> option set to a URI value pointing to a remote node. This is the simplest approach to distribution and closely mirrors how one would use the related Erlang primitives. The communication with the remote actor is asynchronous. It also allows you to run several actors concurrently. The WebSocket transport is used in the communication with the remote node.
    </li>

    <li>
        Use <code>pengine_spawn/2</code> with the <code>node</code> option set to a URI value pointing to a remote node. This gives us a first-class Prolog top-level running on the remote node and is the obvious choice when dealing with queries with more than one solution. The communication with the remote pengine is asynchronous. It also allows you to run several pengines concurrently. The <code>limit</code> option allows you to implement pagination of solutions. This predicate uses the WebSocket transport in its communication with the remote node.
    </li>

    <li>
        Use <code>rpc/2-3</code>. This implements non-deterministic remote procedure calls. When the client is Prolog-based (i.e. when it's also a Web Prolog node), this is by far the easiest way to make a remote call. It doesn't involve any concurrency, however, and it's a synchronous construct. You may choose transport &ndash; HTTP (default) or WebSocket &ndash; and the <code>limit</code> option allows you to limit the number of network roundtrips needed to run a query to completion.
    </li>

    <li>
        Use <code>promise/3-4</code> in combination with <code>yield/2-3</code>. Since <code>promise/3-4</code> doesn't wait for the answer to arrive, it's an asynchronous alternative to <code>rpc/2-3</code>. The waiting is instead done by <code>yield/2-3</code>. This predicate uses the HTTP transport in its communication with the remote node. Should WebSocket be available, you may want to use <code>pengine_spawn/2</code> as another asynchronous alternative to <code>rpc/2-3</code>. 
    </li>
</ol>

<p>
  Some of the complexity is due to the fact that we are in the process of defining a profile of Web Prolog that only accepts the use of HTTP as the underlying transport. A Prolog client will then only be able to use <code>rpc/2-3</code> (with transport set to the default HTTP) or <code>promise/3-4</code> in its communication with such a node.
</p>


<h2>Web Prolog and the programmable Prolog Web</h2>

<p>
    The traditional Web is distributed, decentralised and open. These are traits that we want the Prolog Web to also possess. Whereas distribution is nicely conceptualised in the actor model, and nicely handled by an actor programming language such as Erlang, decentralisation and openness require features that we must rely on the Web as such to contribute. Erlang and most other platforms for distributed programming are not open in the sense that we require. They usually rely on TCP for transport and are, for reasons of security,  assumed to be operating in a closed, trusted environment where we directly control the machines that we are operating.
</p>

<p>
    Compare "Erlang cluster" with "Prolog Web".
</p>


<h2>An implementation in Erlang</h2>

</p>
    An implementation of a Web Prolog node in Erlang would be interesting since it would most probably have a performance profile different from the implementation in SWI-Prolog. The basic Prolog machinery (e.g. unification, backtracking and clause indexing) is likely to be slower in Erlang compared to (say) SWI-Prolog, whereas the super fast lightweight processes of Erlang have other advantages, making it scale better to very many simultaneous users on a network.  
</p>

</p>
    Interestingly, there is <a target="_blank" href="https://github.com/rvirding/erlog"><em>Erlog</em></a> &ndash; an implementation of Prolog in Erlang, written by Robert Virding, which might serve as a nice point of departure. One approach might be to use Prolog in order to transpile Web Prolog source code into something that Erlang and Erlog can work with. 
</p>

</p>
    For the networking part, we note that Erlang is particularly famous for extremely efficient implementations of web-related technologies such as web servers (e.g. Yaws and Cowboy). 
</p>

<p>
    <a href="mailto:torbjorn.lager@gmail.com?subject=subject">Give feedback</a>
</p>

<h2>How the shell works</h2>

<p>
    By selecting Toggle JSON trace from the Shell menu, it's possible to inspect the JSON traffic
    between the shell and the node. This should give you a good idea of how the shell works. (The
    implementation relies a lot on a library called <a href="http://terminal.jcubic.pl">jQuery Terminal</a>.)
</p>

<div class="alert alert-success">
  <p>
    <strong>An alternative IDE.</strong> Want to try a more sophisticated online Prolog IDE? Head over to <a target="_blank" href="https://swish.swi-prolog.org">SWISH</a>, a mature web-based IDE to Prolog, featuring semantic source code colouring, Prolog notebooks, tools for collaboration, etc.
    Please understand, though, that the present version of SWISH doesn't implement Web Prolog, but something slightly different.   
  </p>
  <p>
      In September 2017, SWISH had been online for three years. It
is extensively being used for Prolog education. At the time of writing this, the main server now has
35,420 programs stored with 68,806 revisions. Usage is strongly
correlated with academic holidays, ranging from 36,415 queries per week
(July 31 - August 6, 2017) to 125,946 (May 7-14, 2017). Google link
search (\verb$link:swish.swi-prolog.org$) reports 8,490 links. The
popularity of the Github repository, 198 stars and 48 forks compared to
the main SWI-Prolog repository with 223 stars and 53 forks is another
indication of the impact. (To be compared with Erlang's 6,374 stars and 1,708 forks.)
  </p>
  <p>
    In the future, we plan to integrate Web Prolog with SWISH. Syntax colouring would need to be adapted. The traditional shell will be one of the tools on offer, selectable from a tool bar. This tutorial will be rewritten as a Prolog notebook. But SWISH has a large number of users already, so it wouldn't make sense to change the underlying language until all problems have been sorted out.
  </p>
</div>


<p>
    We take it as obvious that all sorts of windows to the Prolog Web can be written using the PCP protocol. But all applications are not in need of all this.
</p>


<div class="alert alert-success">
  <strong>What's next?</strong> 
  <ol>
      <li>Show this tutorial to interested parties.</li>
      <li>Make revisions and improvements based on feedback.</li>
      <li>Users.</li>
      <li>Write applications.</li>
      <li>Create a W3C standard.</li>
      <li>ProjectP</li>
  </ol>
</div>

<div class="alert alert-success">
  <strong>Web Prolog as a teaching language</strong>
  <ol>
      <li>For teaching logic programming.</li>
      <li>For teaching actor-based programming.</li>
  </ol>
</div>

<h2>Questionnaire</h2>

</div>

<script>
    function recursiveReplaceHost(node, host) {
        if (node.nodeType == 3) { // text node
            node.nodeValue = node.nodeValue.replace(/{{host}}/g, host);
        } else if (node.nodeType == 1) { // element
            $(node).contents().each(function () {
                recursiveReplaceHost(this, host);
            });
        }
    }
    function recursiveReplacePengine(node, host) {
        if (node.nodeType == 3) { // text node
            node.nodeValue = node.nodeValue.replace(/{{pengine}}/g, host);
        } else if (node.nodeType == 1) { // element
            $(node).contents().each(function () {
                recursiveReplacePengine(this, host);
            });
        }
    }
    function consult(id) {
        if (gterm.get_prompt().trim() != "?-") {
            gterm.exec("");
        }
        setTimeout(function() {
            var val = $(id).text();
            var program = val.replace(/'/g,"\\'");
            gterm.echo("\n?- consult_text('"+id+"').");
            gterm.exec("consult_text('"+program+"').", true);
            setTimeout(gterm.enable, 0);
        }, 5)
    }
    function enter(id) {
        if (gterm.get_prompt().trim() != "?-") {
            gterm.exec("");
        }
        setTimeout(function(){ask($(id).text().slice(3).trim())}, 5);
    }
    function ask(query) {
        gterm.exec(query);
        setTimeout(gterm.enable, 0);
    }

    
    function trans(id, state) {
        $('svg [id^=state]').attr('style','fill: white');
        $('svg [id^=d]').attr('style','stroke: black');
        $('svg #state-'+state).attr('style','fill: lightcoral');
        $('svg #d-'+id).attr('style','stroke: red; stroke-width:2');
    }


</script>
    <script id="dsq-count-scr" src="//web-prolog.disqus.com/count.js" async></script>
</body>
</html>