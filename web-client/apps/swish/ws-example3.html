<html lang="en">
 <head>
  <script type="text/x-prolog">
   echo :-
       parent(Parent),
       send(Parent, prompt('Write something!')),
       receive({
           Something ->
               send(Parent, Something),
               echo
       }).
  </script>
 </head>
 <body>
  <script>
   function source() {
       var scripts = document.getElementsByTagName('script');
       var src = "";
       for (var i = 0; i < scripts.length; i++) {
           if (scripts[i].getAttribute('type') == 'text/x-prolog') {
               src += '\n' + scripts[i].textContent;
           }
       }
       return src.replace(/'/g,"\\'");;
   }
   var pid;
   ws = new WebSocket('ws://localhost:3051/chat');
   ws.onerror = function(message) {
       console.log(JSON.stringify(message));
   };
   ws.onopen = function(message) {
       ws.send("spawn(echo, [format('json-s'),src_text('"+source()+"')])");
   };
   ws.onmessage = function(message) {
       var event = JSON.parse(message.data);
       console.log(event);
       if (event.type == "create") {
           pid = event.pid;
           console.log(pid);
       } else if (event.functor == "prompt") {
           var answer = prompt(event.args[0]);
           ws.send("send('"+pid+"','"+answer+"')");
       } else {
           alert(event)
       }
   };
  </script>
 </body>
</html>

